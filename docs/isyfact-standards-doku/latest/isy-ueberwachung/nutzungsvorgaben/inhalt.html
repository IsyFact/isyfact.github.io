<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nutzungsvorgaben Überwachung: Inhalt :: IsyFact Dokumentation</title>
    <link rel="canonical" href="https://github.com/isyfact/isyfact-standards-doku/latest/isy-ueberwachung/nutzungsvorgaben/inhalt.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../../_/css/isyfact.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://github.com/isyfact">IsyFact Dokumentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="isyfact-standards-doku" data-version="2.5-SNAPSHOT">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../einstieg/vorstellung.html">IsyFact Standards</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Einstieg</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../einstieg/vorstellung.html">Vorstellung der IsyFact</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../einstieg/vorstellung/isyfact-standards.html">IsyFact-Standards</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../einstieg/vorstellung/isyfact-erweiterungen.html">IsyFact-Erweiterungen</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../einstieg/vorstellung/rahmenbedingungen.html">Rahmenbedingungen</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/erste-schritte.html">Erste Schritte</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/tutorial/master.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/whitepaper/master.html">Whitepaper</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/migrationsleitfaden-if2/master.html">Migrationsleitfaden IsyFact 2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Blaupausen</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../blaupausen/referenzarchitektur/master.html">Referenzarchitektur</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../blaupausen/referenzarchitektur-it-system/master.html">Referenzarchitektur IT-System</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-anwendungskern/master.html">Anwendungskern</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-datenzugriff/master.html">Datenzugriff</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-service/master.html">Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-web-gui/master.html">Web GUI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-batch/master.html">Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Vorgaben</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/vorgaben-architektur/master.html">Architektur</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/vorgaben-it-sicherheit/master.html">IT-Sicherheit</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Bausteine</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Datum &amp; Zeit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-datetime/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-datetime/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Fehlerbehandlung</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-exception-core/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-exception-core/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">HttpInvoker</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-serviceapi-core/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-serviceapi-core/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Konfiguration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-konfiguration/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-konfiguration/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Logging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-logging/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-logging/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Polling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-polling/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-polling/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-service-rest/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-service-rest/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Sicherheit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sicherheit/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sicherheit/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Sonderzeichen</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sonderzeichen/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sonderzeichen/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Task Scheduling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-task/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-task/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Überwachung</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Util</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-util/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Methodik</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/namenskonventionen/master.html">Namenskonventionen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/versionierung/master.html">Versionierung</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/java-programmierkonventionen/master.html">Java-Programmierkonventionen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../methodik/diagrammerstellung.html">Diagrammerstellung und Modellierung</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/diagrammerstellung/diagramsnet.html">diagrams.net</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/diagrammerstellung/enterprise-architect.html">Enterprise Architect</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../methodik/vorlagen.html">Vorlagen</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/tailoring/tailoring.html">Tailoring</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/spezifikation/datenflussdiagramme.html">Datenflussdiagramme</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Werkzeuge</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../werkzeuge/einrichtung_entwicklungsumgebung/master.html">Entwicklungsumgebung</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../werkzeuge/versionierungskontrolle/master.html">Versionierungskontrolle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../werkzeuge/handbuch_dokumentation/master.html">Dokumentation der IsyFact</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../werkzeuge/seitenvorlage.html">Seitenvorlage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../werkzeuge/kopiervorlage.html">Kopiervorlage für neue Seiten</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../changelog/changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">IsyFact Standards</span>
    <span class="version">2.5-SNAPSHOT</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../glossary/latest/glossary/master.html">Glossar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../glossary/latest/glossary/master.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../einstieg/vorstellung.html">IsyFact Standards</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../einstieg/vorstellung.html">2.5-SNAPSHOT</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../einstieg/vorstellung.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../einstieg/vorstellung.html">IsyFact Standards</a></li>
    <li><a href="inhalt.html">Nutzungsvorgaben Überwachung: Inhalt</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Inhalt" data-levels="3">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Nutzungsvorgaben Überwachung: Inhalt</h1>
<div class="sect1">
<h2 id="ueberwachung-von-anwendungen"><a class="anchor" href="#ueberwachung-von-anwendungen"></a>1. Überwachung von Anwendungen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In diesem Kapitel werden die Anforderungen an die Überwachung von Anwendungen beschrieben.
Für die Überwachung wird der Actuator von Spring Boot eingesetzt.
Actuator bringt eine Reihe von eingebauten Endpoints mit und bietet auch die Möglichkeit, eigene Endpoints hinzuzufügen.
So wird für Informationen über den Systemzustand der eingebauten Endpoint <code>health</code> angeboten und über den Endpoint <code>metrics</code> können Metriken gelesen werden.
Die bereitgestellten Metriken werden von Micrometer erfasst.
Eine nähere Beschreibung des Konzeptes findet sich im Dokument <a href="../konzept/master.html#einleitung" class="xref page">Überwachung - Konzept</a>.</p>
</div>
<div class="paragraph">
<p>Der Fokus liegt dabei auf der Schaffung von einheitlichen Administrationsschnittstellen, welche dem Betrieb eine einfache Überwachung der Anwendungen erlauben.
Alle Vorgaben sind beim Entwurf und der Realisierung von neuen Anwendungen nach IsyFact-Architektur zu berücksichtigen.
Gegebenenfalls können in Systementwürfen Verfeinerungen der hier getroffenen Vorgaben gemacht werden.
Weiterhin können die hier gemachten Vorgaben als Basis für die Beschreibung der Überwachungsschnittstelle im Betriebshandbuch der Anwendungssysteme verwendet werden.</p>
</div>
<div class="sect2">
<h3 id="designvorgaben-fuer-die-ueberwachungsschnittstelle"><a class="anchor" href="#designvorgaben-fuer-die-ueberwachungsschnittstelle"></a>1.1. Designvorgaben für die Überwachungsschnittstelle</h3>
<div class="paragraph">
<p>Dieses Kapitel beschreibt die zu verwendenden Designmuster und Konventionen für die Überwachung mit Actuator und Micrometer.</p>
</div>
<div class="paragraph">
<p>Für die Überwachbarkeit der Anwendungen werden die folgenden Festlegungen getroffen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Für die Überwachung wird Spring Boot Actuator eingesetzt.</p>
</li>
<li>
<p>Die Endpoints von Actuator werden über HTTP bereitgestellt.</p>
</li>
<li>
<p>Es werden nur die unbedingt benötigten Endpoints freigeschaltet.
Alle nicht benötigten Endpoints sind zu deaktivieren.</p>
</li>
<li>
<p>Endpoints werden nur passiv benutzt.
Die Anwendung wird nicht darüber konfiguriert.</p>
</li>
<li>
<p>Der Zugriff auf Endpoints wird mit Benutzername und Passwort abgesichert.</p>
</li>
<li>
<p>Anwendungen stellen einen definierten Satz von Überwachungsinformationen bereit.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Beispielhaft wird eine mögliche Konfiguration zur Anbindung beschrieben.</p>
</div>
<div class="sect3">
<h4 id="vorgaben-fuer-bereitgestellte-informationen"><a class="anchor" href="#vorgaben-fuer-bereitgestellte-informationen"></a>1.1.1. Vorgaben für bereitgestellte Informationen</h4>
<div class="paragraph">
<p>In diesem Kapitel werden die Informationen beschrieben, welche jede Anwendung zur Überwachung bereitstellen muss.</p>
</div>
<div class="paragraph">
<p>Für das Anbieten dieser genormten Management-Schnittstellen wird eine querschnittliche Bibliothek <code>isy-ueberwachung</code>
bereitgestellt, welche die dafür notwendigen Klassen enthält.
Die Bibliothek wird in die zu überwachende Anwendung eingebunden.
Durch das Einbinden von <code>isy-ueberwachung</code> werden auch die für Actuator und Micrometer benötigten Dritt-Bibliotheken
eingebunden.</p>
</div>
<div class="sect4">
<h5 id="allgemeine-ueberwachungsinformationen"><a class="anchor" href="#allgemeine-ueberwachungsinformationen"></a>1.1.1.1. Allgemeine Überwachungsinformationen</h5>
<div class="paragraph">
<p>Actuator stellt über den <code>metrics</code> Endpoint allgemeine Überwachungsinformationen bereit.
Die folgenden Metriken müssen durch Spring Boot automatisch registriert und bereitgestellt werden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JVM Metriken</p>
<div class="ulist">
<ul>
<li>
<p>Speicher und Puffer</p>
</li>
<li>
<p>Statistiken zur Garbage Collection</p>
</li>
<li>
<p>Nutzung von Threads</p>
</li>
<li>
<p>Anzahl der geladenen Klassen</p>
</li>
</ul>
</div>
</li>
<li>
<p>Metriken zur Prozessorauslastung</p>
</li>
<li>
<p>Metriken für Dateideskriptoren</p>
</li>
<li>
<p>Metriken zur Uptime der Anwendung</p>
</li>
<li>
<p>Tomcat-Metriken</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="informationen-von-services"><a class="anchor" href="#informationen-von-services"></a>1.1.1.2. Informationen von Services</h5>
<div class="paragraph">
<p><a href="#table-StdueberServ">Tabelle 1</a> zeigt eine Liste der zu überwachenden bzw. anzubietenden Informationen für die Services von Anwendungen.
Die dort aufgelisteten Informationen müssen für jeden Service einzeln angeboten werden.</p>
</div>
<table id="table-StdueberServ" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 1. Standard Überwachungsinformationen für Services</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Tags: anwendung = &lt;Package der Anwendung&gt;, servicestatistik = &lt;Name des Service&gt;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AnzahlAufrufeLetzteMinute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Liefert die Anzahl der in der letzten Minute erfolgten Aufrufe des Services insgesamt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AnzahlFehlerLetzteMinute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Liefert die Anzahl der in der letzten Minute erfolgten Aufrufe des Services, bei denen ein technischer Fehler aufgetreten ist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DurchschnittsDauerLetzteAufrufe</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Liefert die durchschnittliche Bearbeitungsdauer der letzten 10 Aufrufe der Services in Millisekunden (einfacher gleitender Durchschnitt).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServiceStatistic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stellt Informationen über den Dienstnamen und die Version bereit.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Die Summe der Aufrufe wird alle 60 Sekunden aktualisiert.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Da die gesammelten Informationen für alle Services identisch sind, bringt <code>isy-ueberwachung</code> eine Klasse <code>ServiceStatistik</code>
mit, die diese transparent erfasst.</p>
</div>
<div class="paragraph">
<p>Um die Informationen für mehrere Services in einer Anwendung anzubieten, wird die Klasse mehrfach als Spring-Bean konfiguriert.
Die Aktualisierung der Daten in <code>ServiceStatistik</code> wird in der Service-Fassade der jeweiligen Komponente durchgeführt.
Dazu wird per Spring ein AOP-Advice für die Service-Methoden der Komponente definiert.
Die Konfiguration für eine <code>ServiceStatistik</code>-Bean und den dazugehörigen AOP-Advice ist beispielhaft in <a href="#listing-ServiceStatistikConfig">Listing 1</a> dargestellt.</p>
</div>
<div id="listing-ServiceStatistikConfig" class="listingblock">
<div class="title">Listing 1. ServiceStatistik-Bean und AOP-Advice für die Service-Methoden der Komponente</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableAspectJAutoProxy
public class UeberwachungConfig {

    @Bean
    public MethodInterceptor verwaltungMonitor(MeterRegistry meterRegistry) {
        return new ServiceStatistik(meterRegistry, Tags.of("servicestatistik", "verwaltung"));
    }

    @Bean
    public Advisor verwaltungMonitorAdvice(@Qualifier("verwaltungMonitor") MethodInterceptor verwaltungMonitor) {
        AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();
        pointcut.setExpression("target(de.bund.bva.anwendung.service.verwaltung.VerwaltungRemoteBean)");
        DefaultPointcutAdvisor advisor = new DefaultPointcutAdvisor(pointcut, verwaltungMonitor);
        advisor.setOrder(1000);
        return advisor;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Der Advice bewirkt, dass jeder Aufruf von <code>VerwaltungRemoteBean</code> zu einem Aufruf der Methode <code>zaehleAufruf</code> in der Bean <code>verwaltungMonitor</code> führt.
Die Bean <code>verwaltungMonitor</code> ist die <code>ServiceStatistik</code>-Instanz für die <code>VerwaltungRemoteBean</code>.
Eine entsprechende Konfiguration wird also für jeden Service in die Spring-Konfiguration aufgenommen.</p>
</div>
<div class="paragraph">
<p>Für das Monitoring per AOP werden intern Datenstrukturen gespeichert, die vorhalten, an welchen Stellen Aspekte eingebracht werden.
Das kann, wenn eine große Anzahl von Service-Klassen mit vielen Methoden genutzt wird, zu einem großen Speicherverbrauch führen.
Dies muss beim Design der Services berücksichtigt werden.
Da in Anwendungen pro Komponente in der Regel ein Service angeboten wird und in Anwendung gemäß Referenzarchitektur nur eine eher kleine Anzahl von Komponenten vorhanden ist, stellt dies in der Regel kein Problem dar.</p>
</div>
</div>
<div class="sect4">
<h5 id="ueberwachung-von-caches"><a class="anchor" href="#ueberwachung-von-caches"></a>1.1.1.3. Überwachung von Caches</h5>
<div class="paragraph">
<p>Für Caches, die beim Start der Anwendung initialisiert sind, werden automatisch im Endpoint <code>metrics</code> Statistiken mit dem Präfix <code>cache.</code> geführt.
Die Art der angezeigten Statistiken ist von der verwendeten Cache-Implementierung abhängig.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="implementierung-von-eigenen-metriken"><a class="anchor" href="#implementierung-von-eigenen-metriken"></a>1.1.2. Implementierung von eigenen Metriken</h4>
<div class="paragraph">
<p>Zusätzlich zu den eingebauten Metriken kann eine Anwendung selber Metriken aufzeichnen und über Micrometer registrieren.</p>
</div>
<div class="sect4">
<h5 id="implementierung"><a class="anchor" href="#implementierung"></a>1.1.2.1. Implementierung</h5>
<div class="paragraph">
<p>Zum Einsatz von eigenen Metriken werden die von Micrometer angebotenen abstrakten <code>Meter</code> über eine <code>MeterRegistry</code> registriert und dann in der Anwendung mit Daten befüllt.</p>
</div>
<div class="paragraph">
<p>Die <code>MeterRegistriy</code> wird von Spring per Dependency Injection bereitgestellt.
Bei der Registrierung eines Meters ist ein Tag zur Unterscheidung und eine Beschreibung zu setzen.
Ein Beispiel zur Registrierung und Verwendung eines <code>Meters</code> am Beispiel eines <code>Counters</code> zeigt <a href="#listing-custommeter">Listing 2</a>.
Dort wird ein <code>Counter</code> mit dem Namen <code>eintrag.neu</code> mit einem Tag registriert, der aus einem Schlüssel <code>komponente</code> mit dem Wert <code>verwaltung</code> besteht.
Zu den Namenskonventionen bei der Vergabe von Namen und Tags siehe <a href="#ueberwachung-namenskonventionen">Namenskonventionen</a>.</p>
</div>
<div id="listing-custommeter" class="listingblock">
<div class="title">Listing 2. Registierung und Verwendung eines Counters.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
public class VerwaltungImpl implements Verwaltung {

    private final Counter neuerEintragCounter;

    ...

    public VerwaltungImpl(MeterRegistry registry) {
        neuerEintragCounter = registry.counter("eintrag.neu", "komponente", "verwaltung");
        ...
    }

    public EintragDaten neuerEintrag(...) {
        ...
        neuerEintragCounter.increment();
        ...
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ueberwachung-namenskonventionen"><a class="anchor" href="#ueberwachung-namenskonventionen"></a>1.1.2.2. Namenskonventionen</h5>
<div class="paragraph">
<p>Bei der Benennung von Metern und Tags sind Konventionen einzuhalten.</p>
</div>
<div class="sect5">
<h6 id="benennung-von-metern"><a class="anchor" href="#benennung-von-metern"></a>1.1.2.2.1. Benennung von Metern</h6>
<div class="paragraph">
<p>Die Konventionen von Micrometer bei der Vergabe von Namen sehen die Verwendung von kleingeschriebenen Wörtern vor, die durch Punkte (<code>.</code>) getrennt werden.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>registry.timer("http.server.requests");</pre>
</div>
</div>
<div class="paragraph">
<p>Verschiedene Monitoring-Systeme haben ihre eigenen Namenskonventionen, die untereinander inkompatibel sein können.
Deshalb sorgt jede Implementierung von Micrometer zur Anbindung eines Monitoring-Systems dafür, dass die Standardkonvention in die Namenskonvention des jeweiligen Monitoring-Systems übertragen werden kann.
Gleichzeitig stellt die Einhaltung der Konvention sicher, dass keine im angebundenen Monitoring-Systems verbotenen Zeichen verwendet werden und die Namen der Metriken somit möglichst portabel sind.</p>
</div>
</div>
<div class="sect5">
<h6 id="benennung-von-tags"><a class="anchor" href="#benennung-von-tags"></a>1.1.2.2.2. Bennung von Tags</h6>
<div class="paragraph">
<p>Die Benennung von Tags folgt syntaktisch dem gleichen Schema wie die Bennung von Metern.
Damit wird auch hier eine Übersetzung der Namen in die Konventionen des Monitoring-Systems möglich.
Bei der Auswahl der Bezeichner ist darauf zu achten, dass diese sprechend sind.
Das folgende Beispiel  zeigt die Verwendung von Tags.
Es sollen die Zahl der HTTP Requests und die Zahl der Datenbankzugriffe gemessen werden.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>registry.counter("database.calls", "db", "users")
registry.counter("http.requests", "uri", "/api/users")</pre>
</div>
</div>
<div class="paragraph">
<p>Damit kann man über den Namen 'database.calls' die Zahl aller Zugriffe auf Datenbank abfragen und dann über den Tag die Aufrufe nach Datenbank weiter aufschlüsseln.</p>
</div>
</div>
<div class="sect5">
<h6 id="allgemeine-tags"><a class="anchor" href="#allgemeine-tags"></a>1.1.2.2.3. Allgemeine Tags</h6>
<div class="paragraph">
<p>Allgemeine Tags werden zu jeder Metrik hinzugefügt, die im System registriert wird.
Diese werden zur Kennzeichnung der betrieblichen Systemumgebung (Anwendung, Host, Instanz, etc.) gesetzt.
Allgemeine Tags können über Properties in <code>application.properties</code> gesetzt werden.
Die Properties sind dabei nach dem Schema</p>
</div>
<div class="literalblock">
<div class="content">
<pre>management.metrics.tags.&lt;Schlüssel&gt;=&lt;Wert&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>aufgebaut.
Damit jeder Metrik ein Tag hinzugefügt wird, der den Namen der Anwendung enthält, wird die Property</p>
</div>
<div class="literalblock">
<div class="content">
<pre>management.metrics.tags.anwendung=beispielanwendung</pre>
</div>
</div>
<div class="paragraph">
<p>gesetzt.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="performance"><a class="anchor" href="#performance"></a>1.1.2.3. Performance</h5>
<div class="paragraph">
<p>Die im Konzept beschriebenen Überwachungsfunktionen dürfen keinen relevanten negativen Einfluss auf die Performance der Anwendung haben.
Dazu sind neben der Einhaltung der in dem Dokument <a href="master.html#einleitung" class="xref page">Überwachung - Konzept</a> beschriebenen Vorgaben noch einige grundlegende  Regeln zu beachten:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Da nicht auszuschließen ist, dass ein Überwachungswerkzeug sehr häufig Informationen aus den Endpoints abruft, darf das Bereitstellen der Informationen keine zeitaufwändigen Aktionen im <a href="../../../../glossary/latest/glossary/master.html#glossar-Anwendungssystem" class="xref page">Anwendungssystem</a> veranlassen.</p>
</li>
<li>
<p>Bei der Bereitstellung weiterer Überwachungsinformationen ist darauf zu achten, dass die Ermittlung der Kennzahlen keinen relevanten negativen Einfluss auf die Anwendungs-Performance hat.
Insbesondere dürfen keine fachlichen Funktionen des <a href="../../../../glossary/latest/glossary/master.html#glossar-Anwendungskern" class="xref page">Anwendungskerns</a> aufgerufen werden.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="statische-informationen-ueber-die-anwendung"><a class="anchor" href="#statische-informationen-ueber-die-anwendung"></a>1.1.3. Statische Informationen über die Anwendung</h4>
<div class="paragraph">
<p>Der Info-Endpoint liefert statische Informationen über die Anwendung und ist im Baustein Überwachung aktiviert.
Die Informationen müssen von der Anwendung explizit bereitgestellt werden.
Es können z. B. Informationen über den Build und Quellcode-Stand (Git) der Anwendung geliefert werden. Durch die
Einbindung von passenden Maven-Plugins können diese Informationen automatisch bei jedem Build erzeugt werden:</p>
</div>
<div id="listing-info-maven-config" class="listingblock">
<div class="title">Listing 3. Maven Konfiguration für Build- und GIT Informationen</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
            &lt;execution&gt;
                &lt;id&gt;build-info&lt;/id&gt;
                &lt;goals&gt;
                    &lt;goal&gt;build-info&lt;/goal&gt;
                &lt;/goals&gt;
            &lt;/execution&gt;
        &lt;/executions&gt;
&lt;/plugin&gt;
&lt;plugin&gt;
    &lt;groupId&gt;pl.project13.maven&lt;/groupId&gt;
    &lt;artifactId&gt;git-commit-id-plugin&lt;/artifactId&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bei Bedarf können weitere statische Informationen von der Anwendung bereitgestellt werden.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Weiterführende Informationen enthält die <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-Spring-Boot-Info-Endpoint" class="xref page">Dokumentation von Spring Boot zum Info-Endpoint</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="konfiguration-und-absicherung-von-endpoints"><a class="anchor" href="#konfiguration-und-absicherung-von-endpoints"></a>1.1.4. Konfiguration und Absicherung von Endpoints</h4>
<div class="paragraph">
<p>Gemäß den Vorgaben werden nicht benötigte Endpoints deaktiviert, und jeder veröffentlichte Endpoint wird durch
Authentifizierung abgesichert.</p>
</div>
<div class="sect4">
<h5 id="konfiguration-von-endpoints"><a class="anchor" href="#konfiguration-von-endpoints"></a>1.1.4.1. Konfiguration von Endpoints</h5>
<div class="paragraph">
<p>Zur Überwachung einer Anwendung werden die folgenden eingebauten Endpoints verwendet:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>health</code></p>
</li>
<li>
<p><code>metrics</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Diese sind bereits mit Standardwerten konfiguriert.
Da der Endpoint <code>health</code> seine Informationen aus einem Cache abfragt, welcher von einem Task befüllt wird, werden die in <a href="#listing-task-activation">Listing 4</a> gezeigten Properties in <code>application.properties</code> gesetzt, um das Starten der Tasks zu aktivieren.</p>
</div>
<div id="listing-task-activation" class="listingblock">
<div class="title">Listing 4. Properties zur Aktivierung des Tasks</div>
<div class="content">
<pre>isy.task.autostart=true
isy.task.default.host=</pre>
</div>
</div>
<div class="paragraph">
<p>Endpoints können einzeln aktiviert oder deaktiviert werden.
Damit wird gesteuert, ob der Endpoint erstellt wird und die dafür notwendigen Beans erzeugt werden.
Für den Zugriff von außerhalb muss der Endpoint zusätzlich über eine Schnittstelle (HTTP oder JMX) bereitgestellt werden.</p>
</div>
<div class="paragraph">
<p>Da von Spring standardmäßig fast alle Endpoints aktiviert sind, werden zunächst alle Endpoints ausgeschaltet, und anschließend die Endpoints <code>health</code> und <code>metrics</code> explizit wieder aktiviert.
Die Bereitstellung der Endpoints erfolgt nur über HTTP.</p>
</div>
<div class="paragraph">
<p>Der Task für die Aktualisierung der Informationen für den Endpoint <code>health</code> muss regelmäßig ausgeführt werden.
Durch das Caching ist gewährleistet, dass die wiederholte Abfrage des Endpoints nicht übermäßige Abfragen erzeugt, die auf andere Systeme propagieren können.</p>
</div>
<div class="paragraph">
<p>Für diese Konfiguration sind die in <a href="#listing-endpointconfig-defaults">Listing 5</a> gezeigten Properties standardmäßig gesetzt.
Diese können bei Bedarf in <code>application.properties</code> überschrieben werden.</p>
</div>
<div id="listing-endpointconfig-defaults" class="listingblock">
<div class="title">Listing 5. Properties zur Konfiguration der Endpoints</div>
<div class="content">
<pre>management.endpoints.enabled-by-default=false
management.endpoint.health.enabled=true
management.endpoint.metrics.enabled=true
management.endpoint.info.enabled=true
management.endpoints.web.exposure.include=health, metrics, info
management.endpoints.jmx.exposure.exclude=*

isy.task.tasks.isyHealthTask.ausfuehrung=FIXED_DELAY
isy.task.tasks.isyHealthTask.initial-delay=5s
isy.task.tasks.isyHealthTask.fixed-delay=30s</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="absicherung-von-endpoints"><a class="anchor" href="#absicherung-von-endpoints"></a>1.1.4.2. Absicherung von Endpoints</h5>
<div class="paragraph">
<p>Der Zugriff auf Endpoints muss mit einer Authentifizierung abgesichert werden.
Eine Konfiguration für Spring Security, die alle Endpoints mit HTTP Basic Authentication absichert,
zeigt <a href="#listing-endpointsecurityconfig">Listing 6</a>.
Der Benutzername und das Passwort werden in <code>application.properties</code> gepflegt.</p>
</div>
<div id="listing-endpointsecurityconfig" class="listingblock">
<div class="title">Listing 6. Absicherung der Endpoints mit Spring Security</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableWebSecurity
@Profile("produktion")
public class ActuatorSecurityProduktionConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    private UeberwachungSecurityConfigProperties properties;

    private static final String ENDPOINT_ROLE = "ENDPOINT_ADMIN";

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
         auth.inMemoryAuthentication()
             .withUser(properties.getUsername())
             .password(passwordEncoder().encode(properties.getPassword()))
             .roles(ENDPOINT_ROLE);
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.requestMatcher(EndpointRequest.toAnyEndpoint())
            .authorizeRequests()
            .anyRequest()
            .hasRole(ENDPOINT_ROLE)
            .and()
            .httpBasic();
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="abschalten-der-absicherung-fuer-die-entwicklung"><a class="anchor" href="#abschalten-der-absicherung-fuer-die-entwicklung"></a>1.1.4.2.1. Abschalten der Absicherung für die Entwicklung</h6>
<div class="paragraph">
<p>Um die Authentifizierung für die Endpoints bei der Entwicklung abzuschalten, kann in <a href="#listing-endpointsecurityconfig">Listing 6</a>
gezeigte Konfiguration über eine Spring-Profil (im Beispiel <code>produktion</code>) aktivert bzw. deaktiviert werden.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="vorgaben-fuer-die-pruefung-der-verfuegbarkeit"><a class="anchor" href="#vorgaben-fuer-die-pruefung-der-verfuegbarkeit"></a>1.1.5. Prüfung der Verfügbarkeit</h4>
<div class="paragraph">
<p>Anwendungen nach IsyFact-Architektur sollen Mechanismen bereitstellen, die es erlauben, die Verfügbarkeit der
Anwendung durch eine betriebliche Überwachung zu prüfen.</p>
</div>
<div class="paragraph">
<p>Grundlage dafür ist die Bereitstellung eines HealthEndpoints.</p>
</div>
<div class="sect4">
<h5 id="implementierung-von-ping-und-pruefmethoden"><a class="anchor" href="#implementierung-von-ping-und-pruefmethoden"></a>1.1.5.1. Konfiguration des Nachbarsystem-HealthIndicator</h5>
<div class="paragraph">
<p>Jede Anwendung stellt einen HealthEndpoint unter <code>/actuator/health</code> bereit. Zur Konfiguration siehe auch <a href="#konfiguration-von-endpoints">Konfiguration von Endpoints</a>.
Dieser zeigt den Status des Systems abhängig von allen vorhandenen Health-Indikatoren (<code>HealthIndicator</code>).</p>
</div>
<div class="paragraph">
<p>Isy-Ueberwachung liefert einen Nachbarsystem-Indikator mit, der den HealthEndpoint aller konfigurierten Nachbarsysteme abfragt.</p>
</div>
<div class="paragraph">
<p>Dieser lässt sich wie folgt konfigurieren:</p>
</div>
<div id="listing-nachbarsysteme" class="listingblock">
<div class="title">Listing 7. Konfiguration des NachbarsystemIndicators</div>
<div class="content">
<pre>## Konfiguration von Timeout und Retries bei der Abfrage von Nachbarsystemen
isy.ueberwachung.nachbarsystemcheck.anzahlretries=1
isy.ueberwachung.nachbarsystemcheck.timeout=2s

## Konfiguration eines Nachbarsystems, das überwacht wird
isy.ueberwachung.nachbarsysteme.beispielnachbar.systemname=Beispielnachbar
isy.ueberwachung.nachbarsysteme.beispielnachbar.healthendpoint=http(s)://example.com/actuator/health
isy.ueberwachung.nachbarsysteme.beispielnachbar.essentiell=false

# weitere Nachbarn
#isy.ueberwachung.nachbarsysteme.anderernachbar.systemname=EinAndererNachbar
#...</pre>
</div>
</div>
<div class="paragraph">
<p>Unter <code>isy.ueberwachung.nachbarsystemcheck</code> sind die Zeit bis zum Timeout einer Anfrage und die Anzahl der Wiederholungsversuche pro Abfrage konfigurierbar.
Ist nichts anderes konfiguriert, ist der Standardwert hier 3 Sekunden bis zum Timeout und ein Wiederholungsversuch.
Alle abzufragenden Nachbarsysteme sind unter <code>isy.ueberwachung.nachbarsysteme</code> zu konfigurieren.
Im Listing oben ist <code>beispielnachbar</code> ein selbst zu wählender Schlüssel.
Für jeden Schlüssel sind folgende Properties zu setzen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>systemname</code>: Wird in der Log-Ausgabe als Name des Nachbarsystems verwendet</p>
</li>
<li>
<p><code>healthendpoint</code>: Die URL, unter der der HealthEndpoint des Nachbarsystems zu erreichen ist</p>
</li>
<li>
<p><code>essentiell</code> (<code>true</code>/<code>false</code>) : Ist ein essentielles Nachbarsystem nicht erreichbar, wird der Status des Nachbarsystem-Indikators auf DOWN gesetzt und ein Error geloggt.
Nicht essentielle Nachbarsysteme beeinflussen den Status nicht und werden, falls sie nicht erreichbar sind, nur als Warning geloggt.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_korrelations_id_bei_einem_nachbarsystem_healthindicator"><a class="anchor" href="#_korrelations_id_bei_einem_nachbarsystem_healthindicator"></a>1.1.6. Korrelations-ID bei einem Nachbarsystem-HealthIndicator</h4>
<div class="paragraph">
<p>Eine Korrelations-ID muss gesetzt werden, wenn ein <code>HealthIndicator</code> ein Nachbarsystem aufruft.
Diese wird im Logging Kontext benötigt.
Konkret wird die Korrelations-ID im Task Scheduling gesetzt. <code>isy-ueberwachung</code> liefert
nur eine Default-Konfiguration für einen <code>HealthIndicator</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementierung_weiterer_eigener_health_indikatoren"><a class="anchor" href="#_implementierung_weiterer_eigener_health_indikatoren"></a>1.1.7. Implementierung weiterer eigener Health-Indikatoren</h4>
<div class="paragraph">
<p>Es können weitere Indikatoren zur Überprüfung anderer Komponenten implementiert werden.
Um einen eigenen <code>HealthIndicator</code> zu implementieren, wird eine Spring-Bean registriert, die das Interface <code>HealthIndicator</code> implementiert.
Dort wird die Methode <code>health()</code> implementiert, die eine Objekt vom Typ <code>Health</code> zurückgibt.
Diese enthält den Status der überprüften Komponente und kann optional weitere Details zur Anzeige enthalten.
<code>HealthIndicator</code> werden automatisch von Spring Boot erkannt und im <code>health</code> Endpoint bereitgestellt.</p>
</div>
<div class="paragraph">
<p>Hierfür gelten folgende Richtlinien:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Der <code>HealthIndicator</code> wird als Teil der Administrationskomponente implementiert.</p>
</li>
<li>
<p>Der <code>HealthIndicator</code> darf keine fachlich relevanten Daten verändern.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Neben den Nachbarsystemen sind weitere Überprüfungen sinnvoll:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Verfügbarkeit weiterer genutzter Ressourcen, wie beispielsweise das IAM-System oder genutzte FTP-Verzeichnisse.
Bei der Prüfung der genutzten Ressourcen ist zu beachten, dass sich die Implementierung nicht aufhängt und somit die Prüfung nicht weiterläuft.
Um dies zu vermeiden, sollte zur Prüfung der genutzten Ressourcen das Future-Pattern wie in <a href="#listing-Pruefmethode">Listing 8</a> gezeigt, verwendet werden.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Als Beispiel sei hier das IAM-System genannt.
Zur Prüfung des IAM-Systems wird in der Regel eine Beispielanfrage an den Server gesendet.
Ist vor das IAM-System ein Loadbalancer geschaltet, so kann es nach einem Fail-Over passieren, dass diese Beispielanfrage endlos läuft.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div id="listing-Pruefmethode" class="listingblock">
<div class="title">Listing 8. Demonstration Future-Pattern</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">boolean pruefeSystem() {
    ExecutorService executor = Executors.newCachedThreadPool();
    Future&lt;Boolean&gt; future = executor.submit((Callable&lt;Boolean&gt;) () -&gt; {
        if (!anwendungXYZ.isAnwendungXYZAlive()) {
            throw new AnwendungXYZNotAvailableException();
        }
        return true;
    });

    try {
        return future.get(10, TimeUnit.SECONDS);
    } catch (Exception e) {
        return false;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="anbindung-eines-monitoring-systems"><a class="anchor" href="#anbindung-eines-monitoring-systems"></a>1.2. Anbindung eines Monitoring-Systems</h3>
<div class="paragraph">
<p>Zur Anbindung eines konkreten Monitoring-Systems wird die passende Meter Registry für das Monitoring-Systems als Maven Dependency in die <code>pom.xml</code> aufgenommen.</p>
</div>
<div class="paragraph">
<p>Die Namen der Dependencies folgen dem Schema <code>micrometer-registry-&lt;Monitoring-System&gt;</code>.
Soll beispielweise <em>Prometheus</em> angebunden werden, muss die folgende Dependecy eingetragen werden.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Häufig ist keine weitere Konfiguration notwendig, da die Anbindung durch Spring Boot automatische konfiguriert wird.
Die Konfiguration für die unterstützten Monitoring-System ist in <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-Monitoring-Systeme" class="xref page">Monitoring-Systeme</a> beschrieben.</p>
</div>
</div>
<div class="sect2">
<h3 id="anwendungen-deaktivierbar-machen"><a class="anchor" href="#anwendungen-deaktivierbar-machen"></a>1.3. Anwendungen deaktivierbar machen</h3>
<div class="paragraph">
<p>Für die Durchführung von Updates beim Deployment ist es notwendig, einzelne Knoten eines Anwendungsclusters aus dem Loadbalancing herauszunehmen, so dass dieser Knoten keine Anfragen mehr vom Loadbalancer zugeteilt bekommt.</p>
</div>
<div class="sect3">
<h4 id="beschreibung-des-loadbalancer-servlets"><a class="anchor" href="#beschreibung-des-loadbalancer-servlets"></a>1.3.1. Beschreibung des Loadbalancer-Servlets</h4>
<div class="paragraph">
<p>Zur Realisierung dieser Anforderung wird als Teil jeder Webanwendung ein sog. Loadbalancer-Servlet ausgeliefert.
Das Servlet prüft beim Aufrufen seiner URL, ob eine IsAlive-Datei im Konfigurationsverzeichnis vorhanden ist.
Ist eine solche Datei vorhanden, liefert das Servlet den HTTP-Statuscode HTTP OK (200) zurück.
Falls keine IsAlive-Datei gefunden wird liefert das Servlet den Code HTTP FORBIDDEN (403) zurück.</p>
</div>
<div class="paragraph">
<p>Der Loadbalancer prüft in regelmäßigen Abständen die URL des Servlets und nimmt die entsprechende für die Anwendung den entsprechenden Server aus dem Loadbalancing heraus, falls kein HTTP OK gelesen wird.
Zu beachten ist, dass auf einem Server prinzipiell mehrere verschiedene Anwendung laufen können.
Der Loadbalancer muss daher so konfiguriert werden, dass auf dem Server nur die betreffende Anwendung deaktiviert wird, zu der das Loadbalancer-Servlet gehört.
Alle anderen Anwendungen auf dem entsprechenden Server müssen weiterhin bedient werden.</p>
</div>
</div>
<div class="sect3">
<h4 id="integration-des-loadbalancer-servlets"><a class="anchor" href="#integration-des-loadbalancer-servlets"></a>1.3.2. Integration des Loadbalancer-Servlets</h4>
<div class="paragraph">
<p>Das Loadbalancing-Servlet ist als Teil der Bibliothek <code>isy-ueberwachung</code>.
Es wird automatisch durch die Einbindung der Bibliothek als Servlet registriert.
Standardmäßig verwendet das Servlet die Datei <code>/WEB-INF/classes/config/isAlive</code> als IsAlive-Datei.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Nach dem Deployment entspricht dies der Datei <code>/etc/&lt;anwendungsname&gt;/isAlive</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Die zu suchende Datei kann bei Bedarf durch die Property <code>isy.ueberwachung.loadbalancer.isAliveFileLocation</code> in <code>application.properties</code> geändert werden.</p>
</div>
</div>
<div class="sect3">
<h4 id="nutzung-des-loadbalancing-servlets"><a class="anchor" href="#nutzung-des-loadbalancing-servlets"></a>1.3.3. Nutzung des Loadbalancing-Servlets</h4>
<div class="paragraph">
<p>Durch die oben beschriebene Konfiguration kann die gewünschte Verfügbarkeit der Anwendung über die URL <code>http(s)://&lt;serverurl&gt;/&lt;anwendungsname&gt;/Loadbalancer abgefragt werden</code>.</p>
</div>
<div class="paragraph">
<p>Zur Steuerung des Loadbalancing-Servlets muss die IsAlive-Datei im Konfigurationsverzeichnis der Anwendung durch den Betrieb angelegt bzw. entfernt werden.
Der Standardname für die IsAlive-Datei ist <code>/etc/&lt;anwendungsname&gt;/isAlive</code>.
Dieses kann der Betrieb bei Bedarf über ein Shell-Skript automatisieren.</p>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<div class="divFooter"></div>

<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/isyfact.js"></script>
  </body>
</html>
