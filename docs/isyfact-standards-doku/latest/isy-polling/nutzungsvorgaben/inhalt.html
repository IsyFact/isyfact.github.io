<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nutzungsvorgaben Polling: Inhalt :: IsyFact Dokumentation</title>
    <link rel="canonical" href="https://isyfact.github.io/isyfact-standards-doku/latest/isy-polling/nutzungsvorgaben/inhalt.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../../_/css/isyfact.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://isyfact.github.io">IsyFact Dokumentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="isyfact-standards-doku" data-version="2.5.0-SNAPSHOT">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../einstieg/einstieg.html">IsyFact Standards</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../einstieg/einstieg.html">Einstieg</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../einstieg/vorstellung.html">Vorstellung der IsyFact</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../einstieg/vorstellung/isyfact-standards.html">IsyFact-Standards</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../einstieg/vorstellung/isyfact-erweiterungen.html">IsyFact-Erweiterungen</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../einstieg/vorstellung/rahmenbedingungen.html">Rahmenbedingungen</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/erste-schritte.html">Erste Schritte</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/produkte.html">Eingesetzte Produkte</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/tutorial/master.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/whitepaper.html">Whitepaper</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/migrationsleitfaden-if2/master.html">Migrationsleitfaden IsyFact 2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../blaupausen/blaupausen.html">Blaupausen</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../blaupausen/referenzarchitektur/master.html">Referenzarchitektur</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../blaupausen/referenzarchitektur-it-system/master.html">Referenzarchitektur IT-System</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-anwendungskern/master.html">Anwendungskern</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-datenzugriff/master.html">Datenzugriff</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-service/master.html">Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-web-gui/master.html">Web GUI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-batch/master.html">Batch</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../bausteine/bausteine.html">Bausteine</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Datum &amp; Zeit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-datetime/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-datetime/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Fehlerbehandlung</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-exception-core/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-exception-core/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">HttpInvoker</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-serviceapi-core/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-serviceapi-core/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Konfiguration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-konfiguration/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-konfiguration/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Logging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-logging/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-logging/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Polling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-service-rest/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-service-rest/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Sicherheit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sicherheit/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sicherheit/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Sonderzeichen</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sonderzeichen/konzept/sonderzeichen.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sonderzeichen/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Task Scheduling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-task/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-task/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Überwachung</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-ueberwachung/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-ueberwachung/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Util</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-util/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Styleguide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../../isyfact-style-doku/latest/isy-style/styleguide.html">Styleguide</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../../isyfact-style-doku/latest/isy-style/nutzungsvorgaben/nutzungsvorgaben.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">JSF</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../../isyfact-jsf-doku/latest/isy-web/konzept/konzept.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../../isyfact-jsf-doku/latest/isy-web/nutzungsvorgaben/nutzungsvorgaben.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../plattform/plattform.html">Plattform</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../methodik/methodik.html">Methodik</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/namenskonventionen/master.html">Namenskonventionen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/versionierung/master.html">Versionierung</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/java-programmierkonventionen/master.html">Java-Programmierkonventionen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../methodik/diagrammerstellung.html">Diagrammerstellung und Modellierung</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/diagrammerstellung/diagramsnet.html">diagrams.net</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/diagrammerstellung/enterprise-architect.html">Enterprise Architect</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../methodik/vorlagen.html">Vorlagen</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/vorlagen/bearbeitung.html">Bearbeitung der AsciiDoc-Vorlagen</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../werkzeuge/werkzeuge.html">Werkzeuge</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../werkzeuge/dokumentation/einleitung/einfuehrung.html">Dokumentation gemäß IsyFact</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../werkzeuge/dokumentation/master-antora.html">Projektseite mit Antora (empfohlen)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../werkzeuge/seitenvorlage.html">Seitenvorlage</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../werkzeuge/kopiervorlage.html">Kopiervorlage für neue Seiten</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../werkzeuge/dokumentation/master-asciidoctorJ.html">Dokumente mit AsciidoctorJ Extensions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../werkzeuge/entwicklungsumgebung/master.html">Entwicklungsumgebung</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../werkzeuge/versionierungskontrolle/master.html">Versionierungskontrolle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../werkzeuge/gui-tests/gui-tests-mit-selenium.html">GUI-Tests mit Selenium</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../changelog/changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">IsyFact Standards</span>
    <span class="version">2.5 (DEV)</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../glossary/latest/glossary/master.html">Glossar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../glossary/latest/glossary/master.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../einstieg/einstieg.html">IsyFact Standards</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../einstieg/einstieg.html">2.5 (DEV)</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../isyfact-jsf-doku/latest/isy-web/konzept/konzept.html">JavaServer Faces (JSF)</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../isyfact-jsf-doku/latest/isy-web/konzept/konzept.html">5.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../isyfact-style-doku/latest/isy-style/styleguide.html">Styleguide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../isyfact-style-doku/latest/isy-style/styleguide.html">5.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../einstieg/vorstellung.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../einstieg/einstieg.html">IsyFact Standards</a></li>
    <li><a href="inhalt.html">Nutzungsvorgaben Polling: Inhalt</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Inhalt" data-levels="3">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Nutzungsvorgaben Polling: Inhalt</h1>
<div class="sect1">
<h2 id="die-bibliothek-isy-polling"><a class="anchor" href="#die-bibliothek-isy-polling"></a>1. Die Bibliothek isy-polling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Die Bibliothek <code>isy-polling</code> der IsyFact-Standards implementiert den im <a href="master.html" class="xref page">Polling - Konzept</a> dargestellten Synchronisationsmechanismus über JMX.
Die Bibliothek kann mit mehreren zu pollenden Datenquellen und beliebig vielen Instanzen der Anwendung zum Abfragen einer Datenquelle umgehen.</p>
</div>
<div class="paragraph">
<p>Zur weiteren Erläuterung der einzelnen Klassen der Bibliothek wird zunächst der Begriff „Polling-Cluster“ definiert:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Ein <strong>Polling-Cluster</strong> besteht aus einer Menge von Anwendungsinstanzen, die jeweils die gleiche Datenquelle abfragen und wird durch eine innerhalb der Anwendung eindeutige ID identifiziert.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ein Polling-Cluster wird durch die Klasse <code>PollingCluster</code> implementiert.
Diese Klasse ist dafür zuständig, die Informationen eines Polling-Clusters zu verwalten.
Hierzu zählen insbesondere der Zeitpunkt der letzten Polling-Aktivität und die Wartezeit.
Die wesentlichen Parameter eines Polling-Clusters werden über die Anwendungskonfiguration festgelegt und beim Start der Anwendung eingelesen.</p>
</div>
<div class="paragraph">
<p>Die Verwaltung des Pollings für mehrere Nachrichtenquellen erfolgt über einen Polling-Verwalter (Klasse <code>PollingVerwalter</code>).
Der Polling-Verwalter kennt und verwaltet alle PollingCluster der Anwendung.
Die Klasse <code>PollingVerwalter</code> ist die einzige Klasse der Bibliothek, die eine Anwendungsimplementierung direkt nutzt.</p>
</div>
<div class="paragraph">
<p>Die Methode <code>startePolling</code> prüft, ob die aufrufende Anwendungsinstanz das Polling durchführen darf.
Hierzu wird ihr die ID des Polling-Clusters als Argument übergeben.
Sie liefert <code>true</code>, wenn das Polling gestartet werden darf, ansonsten <code>false</code>.
Hierfür wird der seit der letzten Polling-Aktivität vergangene Zeitraum der anderen Instanzen des Polling-Clusters über JMX abgefragt und zusammen mit der im Polling-Cluster hinterlegten Wartezeit ausgewertet.</p>
</div>
<div class="paragraph">
<p>Die Methode <code>aktualisiereZeitpunktLetztePolling­Aktivitaet</code> setzt den Zeitpunkt der letzten Polling-Aktivität für den Polling-Cluster mit der übergebenen ID auf den aktuellen Systemzeitpunkt, die Methode <code>getZeitpunktLetztePollingAktivitaet</code> liefert den Zeitpunkt der letzten Polling-Aktivität für den Polling-Cluster mit der übergebenen ID.</p>
</div>
<div class="paragraph">
<p>Mit der Annotation <code>PollingAktion</code> ist es möglich, eine Methode zu annotieren, bei deren Aufruf dann der Zeitstempel für den angegebenen Polling-Cluster aktualisiert wird.
Der zugehörige Interceptor ist in der Klasse <code>PollingAktionInterceptor</code> implementiert.</p>
</div>
<div class="paragraph">
<p>Schließlich ermöglicht die Klasse <code>PollingMBean</code> den anderen Instanzen, den seit der letzten Polling-Aktivität vergangenen Zeitraum über JMX abzufragen.</p>
</div>
<div class="paragraph">
<p>In <a href="#polling-klassendiagramm">Abbildung 1</a> ist das Klassendiagramm der Bibliothek <code>isy-polling</code> dargestellt.</p>
</div>
<div id="polling-klassendiagramm" class="imageblock text-center">
<div class="content">
<img src="../_images/nutzungsvorgaben/polling-klassendiagramm.png" alt="polling klassendiagramm">
</div>
<div class="title">Abbildung 1. Klassendiagramm der Bibliothek isy-polling</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="einbinden-der-bibliothek-in-die-anwendung"><a class="anchor" href="#einbinden-der-bibliothek-in-die-anwendung"></a>2. Einbinden der Bibliothek in die Anwendung</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Polling wird in der Regel in einem Verarbeitungszyklus implementiert, der über einen Timer gestartet wird.
Der Verarbeitungszyklus kann eine oder nacheinander mehrere Datenquellen abfragen.</p>
</div>
<div class="paragraph">
<p>Das Einbinden der Bibliothek <code>isy-polling</code> in eine Anwendung erfolgt über Spring.
JMX-Verbindungen und Polling-Cluster werden über die Anwendungskonfiguration definiert.</p>
</div>
<div class="paragraph">
<p>Im Folgenden wird im Detail beschrieben, wie die Bibliothek eingebunden und genutzt wird.</p>
</div>
<div class="sect2">
<h3 id="anwendungskonfiguration"><a class="anchor" href="#anwendungskonfiguration"></a>2.1. Anwendungskonfiguration</h3>
<div class="paragraph">
<p>In der Anwendungskonfiguration werden Polling-Cluster und JMX-Verbindungsparameter definiert.
Bei der Definition der Polling-Cluster hat man die Möglichkeit einen Cluster für einen gesamten Verarbeitungszyklus oder einen Cluster für jede abzufragende Datenquelle zu definieren.
Welche der beiden Möglichkeiten gewählt wird, hängt vom konkreten Anwendungsfall ab und muss beim Entwurf der Anwendung entschieden werden.</p>
</div>
<div class="sect3">
<h4 id="lastverteilung-ueber-cluster-definition"><a class="anchor" href="#lastverteilung-ueber-cluster-definition"></a>2.1.1. Lastverteilung über Cluster-Definition</h4>
<div class="paragraph">
<p>Wird ein Polling-Cluster je zu pollender Datenquelle festgelegt, so kann eine gewisse Lastverteilung erreicht werden wie folgendes Beispiel zeigt:</p>
</div>
<div class="paragraph">
<p><span class="underline">Beispiel</span>:</p>
</div>
<div class="paragraph">
<p>In einer Anwendung ist ein Verarbeitungszyklus so realisiert, dass drei E-Mail-Konten nacheinander abgefragt werden.
Der Verarbeitungszyklus wird periodisch über einen Timer gestartet.
Es gibt zwei Instanzen der Anwendung.
Wird für jedes E-Mail-Konto ein eigener Polling-Cluster definiert, so ist der Ablauf der folgende:</p>
</div>
<div class="paragraph">
<p>Der Timer im Knoten 1 startet den Verarbeitungszyklus.
Es wird zunächst der Polling-Verwalter gefragt, ob das Polling für den Cluster 1 gestartet werden darf.
Knoten 2 hat das Polling noch nicht begonnen, so dass der Polling-Verwalter im Knoten 1 die Verarbeitung der Nachrichten aus dem E-Mail-Konto 1 erlaubt.</p>
</div>
<div class="paragraph">
<p>Zwischenzeitlich startet auch der Timer im Knoten 2 einen Verarbeitungszyklus.
Der Polling-Verwalter im Knoten 2 erkennt, dass das Polling im Knoten 1 für den Cluster 1 bereits aktiv ist und verweigert die Erlaubnis, die Nachrichten des E-Mail-Konto 1 abzuarbeiten.
Die Anwendung fragt den Polling-Verwalter daher als nächstes um Erlaubnis, das Polling für den Cluster 2 durchzuführen.
Das wird erlaubt und Knoten 2 verarbeitet die Nachrichten des E-Mail-Konto 2.</p>
</div>
<div class="paragraph">
<p>Während Knoten 2 noch mit den Nachrichten des E-Mail-Konto 2 beschäftigt ist, hat Knoten 1 alle Nachrichten aus E-Mail-Konto 1 verarbeitet.
Er fragt jetzt den Polling-Verwalter um Erlaubnis, das Polling für den Cluster 2 durchzuführen.
Die Erlaubnis wird verweigert, weil Knoten 2 bereits damit beschäftigt ist.
Daher fragt die Anwendung als nächstes um Erlaubnis, das Polling für den Cluster 3 durchzuführen.
Das wird erlaubt und Knoten 1 verarbeitet die Nachrichten aus dem E-Mail-Konto 3.</p>
</div>
<div class="paragraph">
<p>Knoten 2 ist mit der Verarbeitung des E-Mail-Konto 2 fertig und möchte nun E-Mail-Konto 3 verarbeiten, was aber verweigert wird, da Knoten 1 bereits damit beschäftigt ist.
Dies schließt den Verarbeitungszyklus im Knoten 2 ab.</p>
</div>
<div class="paragraph">
<p>Dieses Beispiel zeigt, dass E-Mail-Konten parallel von beiden Instanzen abgearbeitet werden können.</p>
</div>
</div>
<div class="sect3">
<h4 id="konfigurationsklassen"><a class="anchor" href="#konfigurationsklassen"></a>2.1.2. Konfiguration über Properties</h4>
<div class="paragraph">
<p>Polling-Cluster und JMX-Verbindungsparameter werden über Properties in <code>application.properties</code> konfiguriert.
Konfigurationsparameter einer Ausprägung haben dann das Namensschema &lt;Konfigurationsklassen-Präfix&gt;.&lt;ID der Ausprägung&gt;.&lt;Name des Konfigurationsparameters&gt;.</p>
</div>
<div class="paragraph">
<p>Das Beispiel in <a href="#listing-PollingKonfiguration">Listing 1</a> zeigt folgende Vorgaben:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Die Properties von für die Konfiguration der JMX-Verbindungen haben das Präfix <code>isy.polling.jmx.verbindungen</code>.
Das Präfix für die Cluster-Konfiguration ist <code>isy.polling.cluster</code>.</p>
</li>
<li>
<p>Für die Konfiguration der JMX-Verbindung gibt es die Konfigurationsparameter <code>host</code>, <code>port</code>, <code>benutzer</code> und <code>passwort</code>.
Für die Konfiguration der Cluster gibt es die Parameter <code>name</code>, <code>wartezeit</code>, <code>jmxverbindungen</code>.</p>
</li>
<li>
<p>Es gilt die Konvention, dass IDs für Ausprägungen großgeschrieben werden.
Damit kann an einzelnen Konfigurationseinträgen sofort erkannt werden, dass sie zu einer Konfigurationsklasse gehören.</p>
</li>
</ul>
</div>
<div id="listing-PollingKonfiguration" class="listingblock">
<div class="title">Listing 1. Polling Konfiguration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">isy.polling.jmx.verbindungen.SERVER1.host = host1
isy.polling.jmx.verbindungen.SERVER1.port = 9001
isy.polling.jmx.verbindungen.SERVER1.benutzer = userid1
isy.polling.jmx.verbindungen.SERVER1.passwort = pwd1

isy.polling.cluster.POSTFACH1_CLUSTER.name = Postfachabruf-1
isy.polling.cluster.POSTFACH1_CLUSTER.wartezeit = 600
isy.polling.cluster.POSTFACH2_CLUSTER.name = Postfachabruf-2
isy.polling.cluster.POSTFACH2_CLUSTER.wartezeit = 700
isy.polling.cluster.POSTFACH2_CLUSTER.jmxverbindungen = server1,server2</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="konfigurationsparameter"><a class="anchor" href="#konfigurationsparameter"></a>2.1.2.1. Konfigurationsparameter</h5>
<div class="paragraph">
<p>JMX-Verbindungen haben die folgenden Attribute:</p>
</div>
<div class="paragraph">
<p><code>isy.polling.jmx.verbindungen.&lt;ID&gt;.host</code>:<br>
Hostangabe für den JMX-Zugriff.</p>
</div>
<div class="paragraph">
<p><code>isy.polling.jmx.verbindungen.&lt;ID&gt;.port</code>:<br>
Portangabe für den JMX-Zugriff.</p>
</div>
<div class="paragraph">
<p><code>isy.polling.jmx.verbindungen.&lt;ID&gt;.benutzer</code>:<br>
Benutzerkennung für den JMX-Zugriff</p>
</div>
<div class="paragraph">
<p><code>isy.polling.jmx.verbindungen.&lt;ID&gt;.passwort</code>:<br>
Kennwort für den JMX-Zugriff</p>
</div>
<div class="paragraph">
<p>Polling-Cluster haben die folgenden Attribute:</p>
</div>
<div class="paragraph">
<p><code>isy.polling.cluster.&lt;ID&gt;.name</code>:<br>
Name des Polling-Clusters.
Der hier festgelegte Name wird zur MBean-Identifikation benutzt und ist in der JMX-Konsole sichtbar.</p>
</div>
<div class="paragraph">
<p><code>isy.polling.cluster.&lt;ID&gt;.wartezeit</code>:<br>
Wartezeit in Sekunden, die abgelaufen sein muss, damit diese Anwendung das Polling übernehmen kann.
Dieser Wert sollte doppelt so groß sein, wie der Delay-Wert des Timers, der den Verarbeitungszyklus auslöst.
Die Wartezeit muss mindestens 10 Sekunden betragen.</p>
</div>
<div class="paragraph">
<p><code>isy.polling.cluster.&lt;ID&gt;.jmxverbindungen</code>:<br>
Kommaseparierte Liste von IDs der Verbindungsparameter zu den übrigen Clusterservern.
Dieser Eintrag ist optional und wird in der Regel nicht benötigt.
Wird er weggelassen, so werden alle für das Polling konfigurierten JMX-Verbindungen zugeordnet.</p>
</div>
<div class="paragraph">
<p>Die JMX-Domain für den Polling-Verwalter ist in der Regel das Basispackage der Anwendung:</p>
</div>
<div class="paragraph">
<p><code>isy.polling.jmx.domain=&lt;Domäne&gt;</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="konfiguration-fuer-den-test"><a class="anchor" href="#konfiguration-fuer-den-test"></a>2.1.3. Konfiguration für den Test</h4>
<div class="paragraph">
<p>Für Tests der Anwendung, insbesondere für lokale Entwicklertests, stehen in der Regel nicht mehrere Instanzen der Anwendung zur Verfügung.
In diesem Fall kann das konfigurierte Polling die Tests behindern.</p>
</div>
<div class="paragraph">
<p>Für Tests kann der Polling-Verwalter in den Standalone-Modus versetzt werden.
In diesem Modus erkennt der Polling-Verwalter, dass keine Cluster-Partner existieren und die Polling-Aktionen werden immer zugelassen.</p>
</div>
<div class="paragraph">
<p>Der Standalone-Modus wird automatisch gesetzt, wenn in der Konfiguration der keine JMX-Verbindungen über die Property <code>isy.polling.jmx.verbindungen</code> konfiguriert werden.
Da dieses Verhalten in der Regel im Produktivbetrieb nicht erwünscht ist, wird die folgende Warnung in die Log-Ausgabe geschrieben:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Für das Polling der Anwendung wurden keine JMX-Verbindungsparameter angegeben! Der Polling-Modus wurde auf "Standalone" gesetzt!
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="beispiel-fuer-eine-polling-konfiguration"><a class="anchor" href="#beispiel-fuer-eine-polling-konfiguration"></a>2.1.4. Beispiel für eine Polling-Konfiguration</h4>
<div class="paragraph">
<p>In <a href="#listing-BeispielPollingKonfiguration">Listing 2</a> ist eine vollständige Polling-Konfiguration für einen Cluster aufgeführt, der aus insgesamt zwei Instanzen der Anwendung besteht.</p>
</div>
<div id="listing-BeispielPollingKonfiguration" class="listingblock">
<div class="title">Listing 2. Beispiel Polling Konfiguration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># -----------------------------------------------------------
# Parameter für das Polling
# -----------------------------------------------------------

# Verbindungsparameter zum anderen Knoten
# Hostangabe für den JMX-Zugriff
isy.polling.jmx.verbindungen.SERVER2.host = localhost
# Portangabe für den JMX-Zugriff
isy.polling.jmx.verbindungen.SERVER2.port = 9010
# Benutzerkennung für den JMX-Zugriff
isy.polling.jmx.verbindungen.SERVER2.benutzer = userid
# Kennwort für den JMX-Zugriff
isy.polling.jmx.verbindungen.SERVER2.passwort = pwd

# JMX-Domain; In der Regel das Basispackage der Anwendung
isy.polling.jmx.domain=de.bund.bva.domaene.anwendung

# Name des Clusters. Dieser Name wird zur Bildung der MBean-
# Identifikation verwendet.
isy.polling.cluster.MAILABRUF_CLUSTER.name = XY-Nachrichten
# Wartezeit in Sekunden, die abgelaufen sein muss, damit
# diese Anwendung das Polling übernehmen kann.
isy.polling.cluster.MAILABRUF_CLUSTER.wartezeit = 600</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cluster können nicht dynamisch nur durch die Konfiguration erzeugt werden.
Sie sind vielmehr eng mit der Anwendungslogik verknüpft und sollten daher nicht vom Betrieb geändert werden.</p>
</div>
</div>
<div class="sect3">
<h4 id="beispiel-fuer-eine-polling-konfiguration-mit-lastverteilung"><a class="anchor" href="#beispiel-fuer-eine-polling-konfiguration-mit-lastverteilung"></a>2.1.5. Beispiel für eine Polling-Konfiguration mit Lastverteilung</h4>
<div class="paragraph">
<p>In <a href="#listing-BeispielPollingKonfigurationLastverteilung">Listing 3</a> ist die Polling-Konfiguration für zwei zu pollende Datenquellen mit jeweils eigenem Polling-Cluster aufgeführt.
Die beiden Cluster bestehen jeweils aus den zwei gleichen Instanzen der Anwendung.
Wie in Kapitel <a href="master.html#lastverteilung-ueber-cluster-definition" class="xref page">Lastverteilung über Cluster Definition</a> beschrieben, kann so eine Lastverteilung erfolgen.</p>
</div>
<div id="listing-BeispielPollingKonfigurationLastverteilung" class="listingblock">
<div class="title">Listing 3. Beispiel Polling Konfiguration mit Lastverteilung</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># -----------------------------------------------------------
# Parameter für das Polling
# -----------------------------------------------------------

# Verbindungsparameter zum anderen Knoten
# Hostangabe für den JMX-Zugriff
isy.polling.jmx.verbindungen.SERVER2.host = localhost
# Portangabe für den JMX-Zugriff
isy.polling.jmx.verbindungen.SERVER2.port = 9010
# Benutzerkennung für den JMX-Zugriff
isy.polling.jmx.verbindungen.SERVER2.benutzer = userid
# Kennwort für den JMX-Zugriff
isy.polling.jmx.verbindungen.SERVER2.passwort = pwd

# JMX-Domain; In der Regel das Basispackage der Anwendung
isy.polling.jmx.domain=de.bund.bva.domaene.anwendung

# Parameter des POSTFACH1_CLUSTER
# Name des Clusters. Dieser Name wird zur Bildung der MBean-
# Identifikation verwendet.
isy.polling.cluster.POSTFACH1_CLUSTER.name = Postfachabruf-1
# Wartezeit in Sekunden, die abgelaufen sein muss, damit
# diese Anwendung das Polling übernehmen kann.
isy.polling.cluster.POSTFACH1_CLUSTER.wartezeit = 600
# Parameter des POSTFACH2_CLUSTER
# Name des Clusters. Dieser Name wird zur Bildung der MBean-
# Identifikation verwendet.
isy.polling.cluster.POSTFACH2_CLUSTER.name = Postfachabruf-2
# Wartezeit in Sekunden, die abgelaufen sein muss, damit
# diese Anwendung das Polling übernehmen kann.
isy.polling.cluster.POSTFACH2_CLUSTER.wartezeit = 600</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-konfiguration"><a class="anchor" href="#spring-konfiguration"></a>2.2. Spring-Konfiguration</h3>
<div class="paragraph">
<p>Die Bean für den Polling-Verwalter wird automatisch durch <code>isy-polling</code> konfiguriert.
Der Interceptor, der zur Verwendung der <code>@PollingAktion</code>-Annotation notwendig, wird ebenfalls automatisch konfiguriert.
Zusätzlich wird für jeden Cluster eine MBean konfiguriert (<a href="#listing-KonfigurationMBeans">Listing 4</a>).</p>
</div>
<div id="listing-KonfigurationMBeans" class="listingblock">
<div class="title">Listing 4. Konfiguration der MBeans</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
public PollingMBean mailabrufClusterMonitor(PollingVerwalter pollingVerwalter) {
    PollingMBean mBean = new PollingMBean();
    mBean.setClusterId("MAILABRUF_CLUSTER");
    mBean.setPollingVerwalter(pollingVerwalter);

    return mBean;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#listing-KonfigurationMBeans">Listing 4</a>: Die Property <code>pollingVerwalter</code> enthält die Referenz auf die Komponente „Polling-Verwalter“, die Property <code>clusterId</code> enthält die ID des Polling-Clusters, für den sie den seit der letzten Polling-Aktivität vergangenen Zeitraum liefern soll.</p>
</div>
<div class="paragraph">
<p>Die Einbindung in JMX erfolgt über den MBean-Exporter dann wie in <a href="#listing-EinbindungJMX">Listing 5</a>.</p>
</div>
<div id="listing-EinbindungJMX" class="listingblock">
<div class="title">Listing 5. Einbindung in JMX</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
public MBeanExporter mBeanExporter(@Qualifier("mailabrufClusterMonitor") PollingMBean mailabrufClusterMonitor, IsyPollingProperties isyPollingProperties) {
    MBeanExporter mBeanExporter = new MBeanExporter();
    mBeanExporter.setRegistrationPolicy(RegistrationPolicy.REPLACE_EXISTING);
    mBeanExporter.setAssembler(new MetadataMBeanInfoAssembler(new AnnotationJmxAttributeSource()));
    mBeanExporter.setAutodetect(false);

    Map&lt;String, Object&gt; mBeans = new HashMap&lt;&gt;();
    String key = "de.bund.bva.isyfact.polling:type=PollingStatus,name=\"Polling-Aktivitaet-"
        + isyPollingProperties.getCluster().get("MAILABRUF_CLUSTER").getName() + "\"";

    mBeans.put(key, mailabrufClusterMonitor);
    mBeanExporter.setBeans(mBeans);

    return mBeanExporter;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hierbei ist zu beachten, dass der Cluster-Name aus der Konfiguration hier für die Bildung des Keys für die MBeans verwendet wird.</p>
</div>
</div>
<div class="sect2">
<h3 id="nutzung-im-code"><a class="anchor" href="#nutzung-im-code"></a>2.3. Nutzung im Code</h3>
<div class="paragraph">
<p>Wie bereits erwähnt, wird Polling in der Regel in einem Verarbeitungszyklus implementiert, der über einen Timer gestartet wird.
Der Verarbeitungszyklus kann eine oder nacheinander mehrere Datenquellen abfragen, für die jeweils ein Polling-Cluster definiert sein kann.
Für jeden Polling-Cluster werden in einem Verarbeitungszyklus die folgenden Schritte ausgeführt:</p>
</div>
<div class="paragraph">
<p><a href="#listing-AbfragePollingVerwalter">Listing 6</a>, ob das Polling für den Cluster gestartet werden darf.
Ist das nicht der Fall, ist die Verarbeitung für den Cluster beendet.</p>
</div>
<div id="listing-AbfragePollingVerwalter" class="listingblock">
<div class="title">Listing 6. Abfrage des Polling-Verwalters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">if(!pollingVerwalter.startePolling("MAILABRUF_CLUSTER")) {
  LOG.info("Verarbeitung wurde nicht gestartet, da die " +
    "Wartezeit für den Cluster mit der ID " +
    "\"MAILABRUF_CLUSTER\" noch nicht " +
    "abgelaufen ist.");
  return;
}
fuehreVerarbeitungDurch();</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Durchführen der Verarbeitung für jeden Datensatz.
Am Ende der Verarbeitung eines Datensatzes wird der Zeitpunkt der letzten Polling-Aktivität aktualisiert.</p>
</li>
</ol>
</div>
<div id="listing-VerarbeitungDatensatz" class="listingblock">
<div class="title">Listing 7. Verarbeitung für jeden Datensatz</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// ...
for (Datensatz datensatz: datensaetze) {
  // Verarbeite Datensatz
  // ...
  pollingVerwalter.aktualisiereZeitpunktLetztePollingAktivitaet("MAILABRUF_CLUSTER");
}
// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>oder</p>
</div>
<div id="listing-VerarbeitungPollingAktion" class="listingblock">
<div class="title">Listing 8. Verarbeitung mit Polling-Aktion</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
* Führt eine Polling-Aktion aus
*/
@PollingAktion(pollingCluster="MAILABRUF_CLUSTER")
public void doPollingAktion () {
  // Verarbeite Datensatz
  // ...
}
// ...
  for (Datensatz datensatz: datensaetze) {
    // Verarbeite Datensatz
    // ...
    doPollingAktion();
  }
// ...</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<div class="divFooter"></div>

<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/isyfact.js"></script>
  </body>
</html>
