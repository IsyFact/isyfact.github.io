<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tutorial: Inhalt :: IsyFact Dokumentation</title>
    <link rel="canonical" href="https://isyfact.github.io/isyfact-standards-doku/latest/einstieg/tutorial/inhalt.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../../_/css/isyfact.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://isyfact.github.io">IsyFact Dokumentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="isyfact-standards-doku" data-version="2.5.0-SNAPSHOT">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../einstieg.html">IsyFact Standards</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../einstieg.html">Einstieg</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../vorstellung.html">Vorstellung der IsyFact</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../vorstellung/isyfact-standards.html">IsyFact-Standards</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../vorstellung/isyfact-erweiterungen.html">IsyFact-Erweiterungen</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../vorstellung/rahmenbedingungen.html">Rahmenbedingungen</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../erste-schritte.html">Erste Schritte</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../produkte.html">Eingesetzte Produkte</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="master.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../whitepaper.html">Whitepaper</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migrationsleitfaden-if2/master.html">Migrationsleitfaden IsyFact 2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../blaupausen/blaupausen.html">Blaupausen</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../blaupausen/referenzarchitektur/master.html">Referenzarchitektur</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../blaupausen/referenzarchitektur-it-system/master.html">Referenzarchitektur IT-System</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-anwendungskern/master.html">Anwendungskern</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-datenzugriff/master.html">Datenzugriff</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-service/master.html">Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-web-gui/master.html">Web GUI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/detailkonzept-komponente-batch/master.html">Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Vorgaben</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/vorgaben-architektur/master.html">Architektur</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../blaupausen/vorgaben-it-sicherheit/master.html">IT-Sicherheit</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../bausteine/bausteine.html">Bausteine</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Datum &amp; Zeit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-datetime/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-datetime/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Fehlerbehandlung</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-exception-core/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-exception-core/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">HttpInvoker</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-serviceapi-core/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-serviceapi-core/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Konfiguration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-konfiguration/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-konfiguration/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Logging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-logging/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-logging/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Polling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-polling/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-polling/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-service-rest/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-service-rest/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Sicherheit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sicherheit/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sicherheit/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Sonderzeichen</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sonderzeichen/konzept/sonderzeichen.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sonderzeichen/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Task Scheduling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-task/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-task/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Überwachung</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-ueberwachung/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-ueberwachung/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Util</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-util/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Styleguide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../../isyfact-style-doku/latest/isy-style/styleguide.html">Styleguide</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../../isyfact-style-doku/latest/isy-style/nutzungsvorgaben/nutzungsvorgaben.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">JSF</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../../isyfact-jsf-doku/latest/isy-web/konzept/konzept.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../../isyfact-jsf-doku/latest/isy-web/nutzungsvorgaben/nutzungsvorgaben.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../plattform/plattform.html">Plattform</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../methodik/methodik.html">Methodik</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/namenskonventionen/master.html">Namenskonventionen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/versionierung/master.html">Versionierung</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/java-programmierkonventionen/master.html">Java-Programmierkonventionen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../methodik/diagrammerstellung.html">Diagrammerstellung und Modellierung</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/diagrammerstellung/diagramsnet.html">diagrams.net</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/diagrammerstellung/enterprise-architect.html">Enterprise Architect</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../methodik/vorlagen.html">Vorlagen</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/vorlagen/bearbeitung.html">Bearbeitung der AsciiDoc-Vorlagen</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../werkzeuge/werkzeuge.html">Werkzeuge</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../werkzeuge/dokumentation/einleitung/einfuehrung.html">Dokumentation gemäß IsyFact</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../werkzeuge/dokumentation/master-antora.html">Projektseite mit Antora (empfohlen)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../werkzeuge/seitenvorlage.html">Seitenvorlage</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../werkzeuge/kopiervorlage.html">Kopiervorlage für neue Seiten</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../werkzeuge/dokumentation/master-asciidoctorJ.html">Dokumente mit AsciidoctorJ Extensions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../werkzeuge/entwicklungsumgebung/master.html">Entwicklungsumgebung</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../werkzeuge/versionierungskontrolle/master.html">Versionierungskontrolle</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../changelog/changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">IsyFact Standards</span>
    <span class="version">2.5 (DEV)</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../glossary/latest/glossary/master.html">Glossar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../glossary/latest/glossary/master.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../einstieg.html">IsyFact Standards</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../einstieg.html">2.5 (DEV)</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../isyfact-jsf-doku/latest/isy-web/konzept/konzept.html">JavaServer Faces (JSF)</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../isyfact-jsf-doku/latest/isy-web/konzept/konzept.html">5.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../isyfact-style-doku/latest/isy-style/styleguide.html">Styleguide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../isyfact-style-doku/latest/isy-style/styleguide.html">5.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../vorstellung.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../einstieg.html">IsyFact Standards</a></li>
    <li><a href="inhalt.html">Tutorial: Inhalt</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Inhalt" data-levels="3">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Tutorial: Inhalt</h1>
<div class="sect1">
<h2 id="bezug-isyfact"><a class="anchor" href="#bezug-isyfact"></a>1. Bezug und Nutzung der IsyFact</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alle Bibliotheken der IsyFact stehen über <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-maven-central" class="xref page">Maven Central</a> zum Download bereit.
Zur Nutzung der Bibliotheken in der Anwendungsentwicklung steht ein zentrales BOM (Bill Of Materials) zur Verfügung, das Teil der Maven-Konfiguration (<code>pom.xml</code>) wird:</p>
</div>
<div id="listing-if-bom" class="listingblock">
<div class="title">Listing 1. Einbindung des IsyFact-BOM</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
            &lt;artifactId&gt;isyfact-bom&lt;/artifactId&gt;
            &lt;version&gt;2.5.0-SNAPSHOT&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Somit kann zentral eine zu nutzende Version der IsyFact festgelegt werden.
Diese legt ebenfalls die Versionen aller Drittprodukte fest, die im <a href="../produkte.html#produktkatalog" class="xref page">Produktkatalog</a> der IsyFact enthalten sind.
Aktualisierungen geschehen ebenfalls zentral, durch die Erhöhung der Versionsnummer des IsyFact-BOM.</p>
</div>
<div class="paragraph">
<p>Durch die Nutzung des IsyFact-BOM ist es nicht mehr notwendig, die IsyFact-Bibliotheken mit einzelnen Versionsnummern einzubinden.
Die Versionsnummer ermittelt Maven zentral über das BOM.
Es reicht also folgender Abschnitt, um eine Bibliothek einzubinden:</p>
</div>
<div id="listing-if-bib" class="listingblock">
<div class="title">Listing 2. Einbindung einer IsyFact-Bibliothek</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-logging&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="datenhaltung"><a class="anchor" href="#datenhaltung"></a>2. Datenhaltung</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In diesem Kapitel wird die Implementierung der Datenhaltung einer Anwendung beschrieben.
Die Datenhaltung besteht im Wesentlichen aus den Entitätsklassen (Entity) und den zugehörigen Data Access Objects (DAOs).
Alle Konzepte und Vorgaben zum Thema Persistenz und Datenzugriff stehen im Dokument <a href="../../blaupausen/detailkonzept-komponente-datenzugriff/master.html" class="xref page">Detailkonzept Komponente Datenzugriff</a>.</p>
</div>
<div class="sect2">
<h3 id="designvorgaben"><a class="anchor" href="#designvorgaben"></a>2.1. Designvorgaben</h3>
<div class="ulist">
<ul>
<li>
<p>Der eigentliche Datenbankzugriff wird über die Java Persistence API (JPA) gekapselt.
Als Implementierung für die JPA wird Hibernate verwendet.</p>
</li>
<li>
<p>Das Datenbank-Mapping wird über Annotation in den Entitätsklassen festgelegt.</p>
</li>
<li>
<p>Der Zugriff auf Entitäten erfolgt immer über DAOs oder durch die Traversierung des persistenten Datenmodells.</p>
</li>
<li>
<p>DAOs stellen Zugriffsmethoden (Suchen, Schreiben, Löschen&#8230;&#8203;) für genau einen Entitätstyp bereit.</p>
</li>
<li>
<p>Datenbank-Queries werden im Normalfall aus den Methodennamen generiert.
Sonst werden sie per <code>@Query</code>-Annotation an der Methode beschrieben.</p>
</li>
<li>
<p>Entitäten werden entweder von genau einer fachlichen Komponente oder querschnittlich von der Komponente „Basisdaten“ verwaltet.</p>
</li>
<li>
<p>Der Datenzugriff erfolgt entweder über die Komponenten-Schnittstelle oder im Fall der Basisdaten direkt über die Basisdaten-DAOs.</p>
</li>
<li>
<p>Für persistente Entitäten, die über eine Komponentenschnittstelle angeboten werden, werden eigene Schnittstellenobjekte definiert, die per Deep-Copy gefüllt werden. Hierfür wird ein Bean-Mapper verwendet.
Innerhalb einer Teilanwendung dürfen persistente Entitäten allerdings über Komponentengrenzen hinweg genutzt werden.</p>
</li>
<li>
<p>DAOs und Entitätsklassen werden in einer bestimmten Paketstruktur abgelegt (siehe <a href="../../blaupausen/detailkonzept-komponente-datenzugriff/master.html" class="xref page">Detailkonzept Komponente Datenzugriff</a>).</p>
</li>
<li>
<p>Die Transaktionssteuerung wird per AOP in der Service-Schicht durchgeführt (siehe Kapitel <a href="#anbieten-von-service-schnittstellen">Anbieten von Service-Schnittstellen</a>).</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Aspect-Oriented Programming (AOP) ist ein Programmierparadigma, das anstrebt, verschiedene logische Aspekte eines Programmes getrennt voneinander zu entwerfen, zu entwickeln und zu testen.
Die getrennt entwickelten Aspekte werden dann zur endgültigen Anwendung zusammengefügt.
* Der Primärschlüssel einer Entität besteht aus genau einem Attribut.
Besteht der fachliche Schlüssel der Entität aus genau einem Attribut, so wird er auch als Primärschlüssel verwendet.
Ansonsten wird ein künstlicher technischer Primärschlüssel verwendet.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="klassendesign"><a class="anchor" href="#klassendesign"></a>2.2. Klassendesign</h3>
<div id="image-Datenhaltung" class="imageblock text-center">
<div class="content">
<img src="../_images/tutorial/Datenhaltung.png" alt="Datenhaltung">
</div>
<div class="title">Abbildung 1. Klassendesign für die Datenhaltung</div>
</div>
<table id="table-Datenhaltung" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 1. Klassenbeschreibung für die Datenhaltung</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AuskunftImpl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AuskunftImpl ist die Implementierung der Komponente Auskunft (Anwendungskern). Die Komponente verwendet die DAOs zum  Zugriff auf ihre Daten.
Während die DAOs die eigentlichen Entitätstypen anbieten, liefert die Komponente Auskunft nur nicht persistente Schnittstellenobjekte auf ihre Daten.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RegisterEintragDao</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAOs kapseln den Datenbankzugriff für spezifische Entitätstypen.
Sie stellen Methoden zum Suchen, Anlegen und Löschen dieser Typen zur Verfügung.
Zur Durchführung der Datenbank-Queries benötigt das DAO den EntityManager.
Dieser wird von Spring bereitgestellt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RegisterEintrag</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementierungsklasse für Entitäten vom Typ <code>RegisterEintrag</code>. Enthält Getter- und Setter-Methoden für alle Attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RegisterEintragDaten</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nicht persistentes Schnittstellenobjekt, das die Daten des RegisterEintrags enthält.
Wird als Deep-Copy durch Bean-Mapper erzeugt.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Im Normalfall verwenden Komponenten die Daten anderer Komponenten über deren Schnittstelle.
Der direkte Zugriff auf die DAOs ist verboten.</p>
</div>
<div class="paragraph">
<p>Entitäten, die von mehreren <a href="../../../../glossary/latest/glossary/master.html#glossar-anwendungskomponente" class="xref page">Anwendungskomponenten</a> verwendet werden, bietet die Komponente Basisdaten an.
Die Komponente Basisdaten ist keine vollständige Komponente, sie bietet keine Schnittstellen an.
Ausnahmsweise verwenden Komponenten stattdessen direkt die zugehörigen DAOs der Basisdaten.
Dieser Fall ist auch in <a href="#image-Datenhaltung">Abbildung 1</a> dargestellt.
Weitere Details können der <a href="../../blaupausen/referenzarchitektur/master.html#einleitung" class="xref page">IsyFact Referenzarchitektur</a> entnommen werden.</p>
</div>
</div>
<div class="sect2">
<h3 id="realisierung"><a class="anchor" href="#realisierung"></a>2.3. Realisierung</h3>
<div class="paragraph">
<p>Zur Realisierung der Datenhaltung müssen folgende Aktivitäten durchgeführt werden.</p>
</div>
<div class="sect3">
<h4 id="anlegen-des-datenbankschemas"><a class="anchor" href="#anlegen-des-datenbankschemas"></a>2.3.1. Anlegen des Datenbankschemas</h4>
<div class="paragraph">
<p>Das Datenbankschema muss angelegt werden.
Dazu werden die benötigten DDL-Anweisungen, wie im <a href="../../blaupausen/detailkonzept-komponente-datenzugriff/master.html" class="xref page">Detailkonzept Komponente Datenzugriff</a> beschrieben, in einem Verzeichnis abgelegt.
Die <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-vorlageanwendung" class="xref page">Vorlageanwendung</a> enthält diese Anweisungen im Verzeichnis <code>src/main/skripte/sql/terminfindung</code>.</p>
</div>
<div class="paragraph">
<p>Das initiale Datenmodell kann über das Tool <code>hbm2ddl</code> erzeugt werden.
Dieses muss anschließend noch bearbeitet werden.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
hbm2ddl ist Teil der Hibernate Tools und gehört zum Umfang der Standard-Hibernate Bibliothek.
Nutzungsdokumentation unter:
<a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-hibernate-toolset-guide" class="xref page">Hibernate Toolset Guide</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="einbinden-der-bibliotheken"><a class="anchor" href="#einbinden-der-bibliotheken"></a>2.3.2. Einbinden der Bibliotheken</h4>
<div class="paragraph">
<p>Die benötigten Bibliotheken müssen als Abhängigkeiten in die Maven-Konfiguration (<code>pom.xml</code>) aufgenommen werden:</p>
</div>
<div id="listing-bib-datenhaltung" class="listingblock">
<div class="title">Listing 3. Einbindung der Bibliotheken für das Anbieten einer Datenhaltung</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-persistence&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Eine passende Beispielkonfiguration findet sich in der Maven-Konfiguration der <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-vorlageanwendung" class="xref page">Vorlageanwendung</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementierung-der-entitaetsklassen-und-daos"><a class="anchor" href="#implementierung-der-entitaetsklassen-und-daos"></a>2.3.3. Implementierung der Entitätsklassen und DAOs</h4>
<div class="paragraph">
<p>Die Entitätsklassen und Schnittstellen-Klassen müssen implementiert werden.
In den Entitätsklassen müssen die Mapping-Informationen für JPA als Annotationen eingetragen werden.
Die Implementierung der DAOs wird automatisch generiert.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementierung-von-schnittstellen-klassen"><a class="anchor" href="#implementierung-von-schnittstellen-klassen"></a>2.3.4. Implementierung von Schnittstellen-Klassen</h4>
<div class="paragraph">
<p>Schnittstellen-Klassen dienen als eine nur Lese-Sicht auf persistente Entitäten.
Dieses wird benötigt, wenn Komponenten persistente Entitäten über ihre Schnittstelle herausgeben, um zu verhindern, dass andere Komponenten diese Daten ändern.</p>
</div>
<div class="paragraph">
<p>Schnittstellen-Klassen enthalten alle Attribute, die auch ihre persistenten Gegenstücke besitzen.
Zusätzlich besitzen sie Getter-/Settermethoden für alle Attribute.</p>
</div>
<div class="paragraph">
<p>Die Schnittstellen-Objekte werden per Deep-Copy mittels eines Bean-Mappers erzeugt und dem Aufrufer außerhalb der Teilanwendung zurückgeliefert.
So stehen dem Aufrufer alle Informationen zur Verfügung, es ist ihm aber nicht möglich, Änderungen zu persistieren.
Damit ist die Datenhoheit der Komponente gewahrt.</p>
</div>
<div class="paragraph">
<p>Im Folgenden ist ein beispielhaftes Mapping zu sehen:</p>
</div>
<div id="listing-beanmapper" class="listingblock">
<div class="title">Listing 4. Beispielhaftes Bean-Mapping</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/* Bean-Mapper */
protected MapperFacade mapper;
// Entität mappen
RegisterEintragDaten daten = mapper.map(registerEintrag, RegisterEintragDaten.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fachkomponenten-der-anwendung"><a class="anchor" href="#fachkomponenten-der-anwendung"></a>3. Fachkomponenten der Anwendung</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In diesem Kapitel wird die Realisierung von Fachkomponenten beschrieben.</p>
</div>
<div class="sect2">
<h3 id="designvorgaben-1"><a class="anchor" href="#designvorgaben-1"></a>3.1. Designvorgaben</h3>
<div class="ulist">
<ul>
<li>
<p>Alle Komponenten definieren ihre Schnittstelle über ein Java-Interface.
Eine Ausnahme bildet die Komponente Basisdaten.
Diese Komponente verwaltet gemeinsam genutzte Daten und bietet keine eigene Schnittstelle an.
Der Zugriff erfolgt hier direkt über die DAOs (siehe Kapitel <a href="#klassendesign">Klassendesign</a>).</p>
</li>
<li>
<p>Komponenten bieten an ihrer Schnittstelle eine Nur-Lese-Sicht auf ihre Daten an.
Für jeden Entitätstyp wird eine nicht-persistente Schnittstellenklasse erstellt.
Die Komponentenschnittstelle wird von einer Java-Klasse implementiert.
Diese Klasse kann die Anwendungsfälle im einfachen Fall direkt implementieren oder an Anwendungsfall-Klassen delegieren.</p>
</li>
<li>
<p>Die interne Strukturierung von Komponenten ist nicht im Detail vorgeben.
Für fachliche Komponenten wird eine Basisimplementierung in <a href="../../blaupausen/referenzarchitektur/master.html#einleitung" class="xref page">IsyFact Referenzarchitektur</a> beschrieben.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="klassendesign-1"><a class="anchor" href="#klassendesign-1"></a>3.2. Klassendesign</h3>
<div id="image-Fachliche_Komponente" class="imageblock text-center">
<div class="content">
<img src="../_images/tutorial/Fachliche_Komponente.png" alt="Fachliche Komponente">
</div>
<div class="title">Abbildung 2. Klassendesign für Fachkomponenten</div>
</div>
<table id="table-Datenhaltung1" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 2. Klassenbeschreibung für Komponenten Datenhaltung</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Auskunft</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Interfaces zur Definition der Schnittstelle der Komponente "Auskunft".<br>
Zu beachten ist, dass über die Schnittstelle keine Entitäten der Komponente herausgegeben werden.
Es darf immer nur eine Nur-Lese-Sicht (nicht-persistente Schnittstellen-Objekte) herausgegeben werden.<br>
Die Umwandlung der internen (<code>RegisterEintrag</code>) auf die externe Sicht erfolgt per Bean-Mapper.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AuskunftImpl</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementierung der Komponente <code>Auskunft</code>. Diese Klasse wird als Spring-Bean konfiguriert.
Weitere benötigte Komponenten (Spring-Beans) werden dieser Komponente per Spring-Dependency-Injection bekannt gemacht.
Alle weiteren Klassen der Komponente, z.B. AWF-Klassen werden in der <code>AuskunftImpl</code> "normal" instanziiert, und die benötigten Referenzen übergeben.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AwfLeseGesamtBestand</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Beispielklasse zur Implementierung eines Anwendungsfalls.
Diese Klassen werden explizit instanziiert, also nicht als Spring-Bean konfiguriert.
Falls ein Anwendungsfall weitere Komponenten (Konfiguration, Regelwerk) etc. benötigt, werden diese durch die instanziierende Impl-Klasse übergeben.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RegisterEintrag</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Persistente Entität für Register-Einträge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RegisterEintragDaten</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nur-Lese-Sicht auf Register-Einträge (siehe Kapitel <a href="#implementierung-von-schnittstellen-klassen">Implementierung von Schnittstellen-Klassen</a>).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="package-struktur"><a class="anchor" href="#package-struktur"></a>3.3. Package-Struktur</h3>
<div class="ulist">
<ul>
<li>
<p>Die Realisierung der Komponenten-Schnittstelle erfolgt im Package<br>
<code>&lt;organisation&gt;.&lt;domäne&gt;.&lt;system&gt;.core.&lt;komponente&gt;</code></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Für das Bundesverwaltungsamt ist dies z.B. <code>de.bund.bva</code>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Die Realisierung der Komponenten-Implementierung erfolgt im Package<br>
<code>&lt;organisation&gt;.&lt;domäne&gt;.&lt;system&gt;.core.&lt;komponente&gt;.impl.*</code></p>
</li>
<li>
<p>Die nicht-persistenten Schnittstellen-Klassen werden im Package<br>
<code>&lt;organisation&gt;.&lt;domäne&gt;.&lt;system&gt;.core.&lt;komponente&gt;.ausgabedaten.*</code><br>
implementiert.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="realisierung-1"><a class="anchor" href="#realisierung-1"></a>3.4. Realisierung</h3>
<div class="ulist">
<ul>
<li>
<p>Die Implementierungsklassen und Interfaces der Komponente werden implementiert.</p>
</li>
<li>
<p>Die Komponente mit <code>@Component</code> bzw. mit einer passenden Spezialisierung annotiert, damit sie von Spring als Bean konfiguriert wird.</p>
</li>
<li>
<p>Je nach Bedarf wird die Komponente anderen Komponenten per Dependency Injection bekannt gemacht.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="anwendungsnutzung"><a class="anchor" href="#anwendungsnutzung"></a>4. Anwendungsnutzung</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In diesem Kapitel wird die Realisierung von verschiedenen, technischen Zugangswegen zum Anwendungskern beschrieben, mit Ausnahme des GUI-Zugangs.
Das Thema umfasst das Anbieten von internen Service-Schnittstellen per HTTP Invoker, das Nutzen derselben und die Nutzung des Anwendungskerns im
Rahmen der Batch-Verarbeitung.</p>
</div>
<div id="image-RAIT" class="imageblock text-center">
<div class="content">
<img src="../_images/tutorial/RAIT.png" alt="RAIT">
</div>
<div class="title">Abbildung 3. Referenzarchitektur eines IT-Systems</div>
</div>
<div class="sect2">
<h3 id="anbieten-von-service-schnittstellen"><a class="anchor" href="#anbieten-von-service-schnittstellen"></a>4.1. Anbieten von Service-Schnittstellen</h3>
<div class="paragraph">
<p>Dieser Abschnitt beschreibt die Realisierung von HTTP Invoker Schnittstellen (siehe <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-Spring" class="xref page">Spring</a>).
HTTP Invoker Schnittstellen sind interne Service-Schnittstellen, die innerhalb der Anwendungslandschaft durch andere Anwendungen genutzt werden dürfen.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ab IsyFact 2.0 ist die Verwendung von REST-Schnittstellen erlaubt.
HTTP Invoker wird in folgenden Releases (IsyFact 2.x) als Schnittstellenformat abgelöst.
Die Verwendung von REST-Schnittstellen wird einem gesonderten Konzept erläutert.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Extern verfügbare Services sind durch WebService-Schnittstellen anzubieten, über einen ServiceGateway.</p>
</div>
<div class="sect3">
<h4 id="designvorgaben-2"><a class="anchor" href="#designvorgaben-2"></a>4.1.1. Designvorgaben</h4>
<div class="ulist">
<ul>
<li>
<p>Interne Services werden per Spring HTTP Invoker angeboten.</p>
</li>
<li>
<p>Es werden keine Komponenten des Anwendungskerns extern verfügbar gemacht: Es wird stets eine eigene Service-Schicht implementiert.
Dazu gehört auch die Definition einer Service-Schnittstelle als Java-Interface (RemoteBean).</p>
</li>
<li>
<p>Jede Service-Methode erhält einen zusätzlichen Parameter <code>AufrufKontext</code>. Im Aufrufkontext werden Informationen zum Aufrufer
(Name, Behördenkennzeichen, Rollen…) übermittelt.
Die Implementierungen verschiedener Aufrufkontext-Transportobjekte sind in der Bibliothek <code>isy-serviceapi-sst</code> enthalten.</p>
</li>
<li>
<p>Die Implementierung der Service-Schnittstelle wird in eine Exception-Fassade und die eigentliche Service-Implementierung aufgeteilt.</p>
</li>
<li>
<p>In der Service-Schnittstelle werden nur Transport-Exceptions und Transportobjekte verwendet.
Die Umwandlung der internen Exceptions und Entitäten auf Transport-Exceptions und -Objekte erfolgt in der Service-Schicht.</p>
</li>
<li>
<p>Listen von Objekten in Ein- und Ausgabeparametern werden als Arrays übertragen.
Andere <code>Collection</code>-Typen sind nicht erlaubt.</p>
</li>
<li>
<p>Beim Kompilieren der Schnittstellenprojekte muss auf die Java-Version geachtet werden.
Die Java-Version darf nicht neuer sein, als diejenige des Nutzers.
Gegebenenfalls muss die Schnittstelle auf eine ältere Version kompiliert werden.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="package-struktur-1"><a class="anchor" href="#package-struktur-1"></a>4.1.2. Package-Struktur</h4>
<div class="ulist">
<ul>
<li>
<p>Schnittstellen werden versioniert.
Die Versionsnummer wird dreistellig im Package-Namen der Service-Schnittstelle angegeben.
Beispiel: Die Version 1.0.0 der Schnittstelle der Komponente Meldung der Anwendung Vorlage-Register, wird in den folgenden
Packages implementiert:<br>
<code>de.bund.bva.cd.registercd.service.httpinvoker.v1_0_0.*</code></p>
</li>
<li>
<p>Interfaces, Transport-Exceptions und Transportobjekte werden im Package<br>
<code>&lt;organisation&gt;.&lt;domäne&gt;.&lt;system&gt;.service.httpinvoker.vX_Y_Z</code><br>
implementiert</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Das sind genau die Inhalte, die im eigenen Projekt <code>&lt;system&gt;-httpinvoker-sst</code> implementiert werden.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Die Implementierung der Service-Schnittstelle erfolgt im Package<br>
<code>&lt;organisation&gt;.&lt;domäne&gt;.&lt;system&gt;.service.httpinvoker.vX_Y_Z.impl</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="klassendesign-2"><a class="anchor" href="#klassendesign-2"></a>4.1.3. Klassendesign</h4>
<div id="image-KDServiceSS" class="imageblock text-center">
<div class="content">
<img src="../_images/tutorial/KDServiceSS.png" alt="KDServiceSS">
</div>
<div class="title">Abbildung 4. Klassendesign für HTTP Invoker Service-Schnittstellen</div>
</div>
<table id="table-KDServiceSS" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 3. Klassenbeschreibung für Service-Schnittstellen</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AuskunftRemoteBean</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Externes Interface für den Zugriff auf die Auskunft-Komponente per HTTP Invoker.
Bei Nutzung einer Service-Schnittstelle generiert Spring auf Basis dieses Interfaces einen Proxy für den Remote-Zugriff.<br>
Die Methoden dieser Komponente verwenden ausschließlich Transportobjekte und -Exceptions.<br>
Die Überwachung der Service-Aufrufe (siehe Kapitel <a href="#ueberwachung">Überwachung</a>) wird als Aspekt der RemoteBean konfiguriert.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AuskunftToException</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transport-Exception der Auskunft.
Jede Komponente darf ausschließlich Transport-Exceptions an ihrer Service-Schnittstelle werfen.
Details sind in <a href="../../isy-exception-core/konzept/master.html#einleitung" class="xref page">Konzept Fehlerbehandlung</a> nachzulesen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AufrufKontextTo</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AufrufKontext</code> der Service-Utilities mit den Informationen zum Aufrufer (Name, Passwort, Rollen…).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RegisterEintragTo</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transportobjekt für Register-Eintrag-Entitäten.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AuskunftExceptionFassade</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Die Klasse <code>AuskunftExceptionFassade</code> implementiert das <code>AuskunftRemoteBean</code>-Interface.
Die Exception-Fassade erhält damit alle Aufrufe der Auskunft-Service-Schnittstelle.
Diese werden an die Auskunft-Service-Implementierung (<code>AuskunftServiceImpl</code>) delegiert.
Die Aufgabe der Exception-Fassaden ist das Exception-Handling und -Mapping durchzuführen.<br>
Wichtig ist, einen Catch-Throwable-Block um den Aufruf der <code>AuskunftService</code>-Implementierung zu machen, um sicherzustellen, dass alle auftretenden Fehler gefangen werden.
Die Implementierung der Fehlerbehandlung wird im Detail in <a href="../../isy-exception-core/konzept/master.html#einleitung" class="xref page">Konzept Fehlerbehandlung</a> beschrieben.<br>
In der Exception-Fassade muss die Correlation-ID aus dem AufrufKontext in den Logging-Kontext gesetzt werden (siehe Kapitel <a href="#logging">Logging</a>).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AuskunftService</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internes Interface für den Auskunft-Service.
Diese Schnittstelle verwendet Transportobjekte aber noch die internen Exceptions.
Diese werden erst von der Exception-Fassade auf die eigentlichen Exceptions der AuskunftRemoteBean umgewandelt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AuskunftServiceImpl</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Implementierung des <code>AuskunftService</code>.
In Service-Implementierung müssen die folgenden Aktivitäten durchgeführt werden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Berechtigungsprüfung</p>
</li>
<li>
<p>Mappen der eingehenden Daten</p>
</li>
<li>
<p>Aufrufen des Anwendungskerns (Auskunft)</p>
</li>
<li>
<p>Mappen der ausgehenden Daten</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Das Mappen der Daten wird mit einem Bean Mapper durchgeführt.</p>
</div>
<div class="paragraph">
<p>Dies geschieht automatisiert, ohne dass man Mapping-Informationen hinterlegen muss.
Grund hierfür ist die strukturelle Gleichheit der Objekte des Anwendungskerns und der Service-Schicht.
Dadurch ist der Bean Mapper in der Lage diese Objekte generisch zu übersetzen.</p>
</div>
<div class="paragraph">
<p>In den Service-Implementierungen wird außerdem die Transaktionssteuerung durchgeführt.
Diese wird per Spring-AOP über Annotations konfiguriert (siehe Kapitel <a href="#datenhaltung">Datenhaltung</a>).</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="realisierung-2"><a class="anchor" href="#realisierung-2"></a>4.1.4. Realisierung</h4>
<div class="paragraph">
<p>Zur Realisierung einer Service-Schnittstelle müssen einige Aktivitäten ausgeführt werden.
Diese werden im Folgenden beschrieben.</p>
</div>
<div class="sect4">
<h5 id="anlegen-des-schnittstellen-projekts"><a class="anchor" href="#anlegen-des-schnittstellen-projekts"></a>4.1.4.1. Anlegen des Schnittstellenprojekts</h5>
<div class="paragraph">
<p>Das neue Projekt <code>&lt;system&gt;-httpinvoker-sst</code> muss angelegt werden.
Dazu wird eine neue <code>pom.xml</code> angelegt.
Wichtig ist, dass darin die Compiler-Version so festgelegt wird, wie es im <a href="../produkte.html#produktkatalog" class="xref page">Produktkatalog</a> vorgegeben ist.</p>
</div>
<div class="paragraph">
<p>Das Projekt muss ein Jar erzeugen, das von anderen Systemen zur Nutzung der Service-Schnittstelle benötigt wird.
In der Pom-Datei muss konfiguriert werden, dass das Jar in das Verzeichnis <code>repository-deploy</code> (Deployment-Repository) deployt wird.
Ein Beispiel dafür findet sich in <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-vorlageanwendung" class="xref page">Vorlageanwendung</a>.</p>
</div>
<div class="paragraph">
<p>Das Schnittstellen-Projekt erhält dieselbe Group-ID wie das eigentliche Anwendungsprojekt.
Die Artifact-ID ist <code>&lt;system&gt;-httpinvoker-sst</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="realisierung-der-externen-service-schnittstelle"><a class="anchor" href="#realisierung-der-externen-service-schnittstelle"></a>4.1.4.2. Realisierung der „externen“ Service-Schnittstelle</h5>
<div class="paragraph">
<p>Das RemoteBean-Interface, die Transportobjekte und -Exceptions müssen im Schnittstellen-Projekt angelegt werden.</p>
</div>
</div>
<div class="sect4">
<h5 id="realisierung-der-service-implementierung"><a class="anchor" href="#realisierung-der-service-implementierung"></a>4.1.4.3. Realisierung der Service-Implementierung</h5>
<div class="paragraph">
<p>Im Projekt der eigentlichen Anwendung müssen die Exception-Fassade, das Service-Interface (z.B. <code>AuskunftService</code>) und die Implementierung dieses Interfaces angelegt werden.</p>
</div>
<div class="paragraph">
<p>Im Rahmen der Implementierung muss ggf. die Bean-Mapping-Konfiguration für die Transformation der Transport- auf die Entitätsobjekte angelegt werden.
Der Bean Mapper wird als Spring-Bean konfiguriert.
Dabei werden die zuvor angelegten Mapping-Dateien im Mapper konfiguriert.</p>
</div>
<div class="paragraph">
<p>Die Exception-Fassade und die Service-Implementierung werden als Spring-Beans konfiguriert.
Die Exception-Fassade erhält eine Referenz auf die Service-Implementierung per Dependency Injection.
Genauso erhält die Service-Implementierung eine Referenz auf den Bean Mapper per Dependency Injection.</p>
</div>
<div class="paragraph">
<p>Vor der Exception-Fassade wird mithilfe der Annotation <code>@StelltLoggingKontextBereit</code> die mit dem Aufrufkontext mitkommende Correlation-Id für das Logging registriert.</p>
</div>
<div class="paragraph">
<p>An den Methoden der Service-Implementierung werden die Annotationen <code>@StelltAufrufKontextBereit</code> und <code>@Gesichert</code> gemäß <a href="../../isy-sicherheit/nutzungsvorgaben/master.html#einleitung" class="xref page">Nutzungsvorgaben Sicherheit</a> verwendet, um den Zugriff auf die Service-Methode zu autorisieren.</p>
</div>
<div class="paragraph">
<p>Beispiele dafür finden sich in <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-vorlageanwendung" class="xref page">Vorlageanwendung</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="konfigurieren-der-service-schnittstelle"><a class="anchor" href="#konfigurieren-der-service-schnittstelle"></a>4.1.4.4. Konfigurieren der Service-Schnittstelle</h5>
<div class="paragraph">
<p>In der Konfigurationsklasse der Service-Schicht wird die HTTP Invoker Konfiguration der
Service-Schnittstelle durchgeführt.
Dazu werden das Remote-Bean-Interface und die zugehörige Implementierung in Form der Exception-Fassade als Service
konfiguriert <a href="#listing-httpinvokerserviceexporter">Listing 5</a>.
Der Bean-Name ist für die URL, unter welcher der Service erreichbar sein wird, wichtig.</p>
</div>
<div id="listing-httpinvokerserviceexporter" class="listingblock">
<div class="title">Listing 5. Konfiguration von Remote Bean und Exception Fassade als Service</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class ServiceConfiguration {

    @Bean("/AuskunftBean_v1_0")
    public IsyHttpInvokerServiceExporter auskunftService(AuskunftExceptionFassade auskunftFassade) {
        IsyHttpInvokerServiceExporter exporter = new IsyHttpInvokerServiceExporter();
        exporter.setService(auskunftFassade);
        exporter.setServiceInterface(AuskunftRemoteBean.class);
        return exporter;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>IsyHttpInvokerServiceExporter</code> ist eine Erweiterung von <code>HttpInvokerServiceExporter</code> und deaktiviert standardmäßig die Verwendung von Proxy-Klassen.</p>
</div>
</div>
<div class="sect4">
<h5 id="einbinden-der-benoetigten-bibliotheken"><a class="anchor" href="#einbinden-der-benoetigten-bibliotheken"></a>4.1.4.5. Einbinden der benötigten Bibliotheken</h5>
<div class="sect5">
<h6 id="bibliotheken-fuer-das-service-schnittstellen-projekt"><a class="anchor" href="#bibliotheken-fuer-das-service-schnittstellen-projekt"></a>4.1.4.5.1. Bibliotheken für das Service-Schnittstellen-Projekt</h6>
<div class="paragraph">
<p>Das Projekt der Service-Schnittstelle benötigt die in <a href="#listing-bib-sst">Listing 6</a> aufgelisteten Bibliotheken:</p>
</div>
<div id="listing-bib-sst" class="listingblock">
<div class="title">Listing 6. Einbindung der Bibliotheken für das Service-Schnittstellen-Projekt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-exception-sst&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-serviceapi-sst&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bibliotheken-fuer-die-implementierung-der-service-schnittstelle"><a class="anchor" href="#bibliotheken-fuer-die-implementierung-der-service-schnittstelle"></a>4.1.4.5.2. Bibliotheken für die Implementierung der Service-Schnittstelle</h6>
<div class="paragraph">
<p>In die Build-Konfiguration des Hauptprojekts des Anwendungssystems müssen folgende Bibliotheken aufgenommen werden:</p>
</div>
<div id="listing-bib-sst-core" class="listingblock">
<div class="title">Listing 7. Einbindung der Bibliotheken für das Anbieten von Service-Schnittstellen</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;{organisation}.{domäne}.{system}&lt;/groupId&gt;
        &lt;artifactId&gt;{systemname}-httpinvoker-sst&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-exception-core&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-serviceapi-core&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;ma.glasnost.orika&lt;/groupId&gt;
        &lt;artifactId&gt;orika-core&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>&lt;systemname&gt;-httpinvoker-sst</code> fügt das Schnittstellen-Projekt als Abhängigkeit hinzu.</p>
</div>
<div class="paragraph">
<p>Die verwendete Version von <em>Orika</em> ist dem Produktkatalog zu entnehmen.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="nutzen-von-service-schnittstellen"><a class="anchor" href="#nutzen-von-service-schnittstellen"></a>4.2. Nutzen von Service-Schnittstellen</h3>
<div class="paragraph">
<p>Dieser Abschnitt beschreibt, wie Service-Schnittstellen genutzt, d.h. aufgerufen werden können.</p>
</div>
<div class="sect3">
<h4 id="designvorgaben-3"><a class="anchor" href="#designvorgaben-3"></a>4.2.1. Designvorgaben</h4>
<div class="paragraph">
<p>Die genutzte Schnittstelle soll vom eigenen Anwendungskern entkoppelt werden.
D.h. im eigenen Anwendungskern werden keine Exceptions oder Transportobjekte der genutzten Schnittstelle verwendet.
Dazu wird ein Wrapper um die Schnittstelle implementiert.</p>
</div>
</div>
<div class="sect3">
<h4 id="klassendesign-3"><a class="anchor" href="#klassendesign-3"></a>4.2.2. Klassendesign</h4>
<div id="image-implClntAd" class="imageblock text-center">
<div class="content">
<img src="../_images/tutorial/implClntAd.png" alt="implClntAd">
</div>
<div class="title">Abbildung 5. Beispiel für die Implementierung eines Client-Adapters</div>
</div>
<div class="paragraph">
<p>Zum Zugriff auf den Service wird im Normalfall ein Adapter im Client implementiert (<code>AuskunftAdapter</code>). Dieser Adapter entkoppelt den Anwendungskern des Clients vom Service.</p>
</div>
<div class="paragraph">
<p>Im Adapter wird im Wesentlichen eine Wrapper-Klasse (<code>AuskunftWrapper</code>) implementiert.
Diese führt das Mapping der Exceptions und der Daten durch.
Der Adapter implementiert im Beispiel ein eigenes <code>Auskunft</code>-Interface für die Nutzung durch die Client-Anwendung.</p>
</div>
<div class="paragraph">
<p>Für die Remote Zugriffe wird der <code>HttpInvokerProxy</code> benutzt.
Dieser wird automatisch von Spring erzeugt.
Er bietet das RemoteBean-Interface auf Client-Seite an und sorgt dafür, dass Aufrufe per HTTP Invoker an den Service weitergereicht werden.</p>
</div>
</div>
<div class="sect3">
<h4 id="realisierung-3"><a class="anchor" href="#realisierung-3"></a>4.2.3. Realisierung</h4>
<div class="sect4">
<h5 id="einbinden-der-schnittstellen-bibliothek"><a class="anchor" href="#einbinden-der-schnittstellen-bibliothek"></a>4.2.3.1. Einbinden der Schnittstellen-Bibliothek</h5>
<div class="paragraph">
<p>Zur Realisierung wird die Bibliothek mit der zu nutzenden Service-Schnittstelle benötigt.
Dieses befindet sich im Deployment-Repository der zu nutzenden Anwendung.
Das Jar wird in das eigene Projekt-Repository kopiert und via Maven eingebunden.</p>
</div>
<div class="paragraph">
<p>Zusätzlich müssen die HTTP Invoker Bibliotheken von Spring eingebunden werden.
Eine vollständige Liste zeigt <a href="#listing-bib-sst-nutzung">Listing 8</a>.</p>
</div>
<div id="listing-bib-sst-nutzung" class="listingblock">
<div class="title">Listing 8. Einbindung der Bibliotheken zur Nutzung von Service-Schnittstellen</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;{organisation}.{domäne}.{system}&lt;/groupId&gt;
        &lt;artifactId&gt;{systemname}-httpinvoker-sst&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-serviceapi-core&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>{systemname}-httpinvoker-sst</code> fügt das Schnittstellen-Projekt der zu nutzenden Schnittstelle als Abhängigkeit hinzu.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="durchfuehren-der-konfiguration"><a class="anchor" href="#durchfuehren-der-konfiguration"></a>4.2.3.2. Durchführen der Konfiguration</h5>
<div class="paragraph">
<p>Spring erzeugt anhand des Service-Interfaces HTTP Invoker Proxies, die den eigentlichen Aufruf durchführen.
Diese Proxies werden als Spring-Bean konfiguriert:</p>
</div>
<div id="listing-proxconf" class="listingblock">
<div class="title">Listing 9. Proxy-Konfiguration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class ServiceConfig {
    @Bean
    public HttpInvokerProxyFactoryBean invoker(ConfigProperties properties) {
        HttpInvokerProxyFactoryBean invoker = new HttpInvokerProxyFactoryBean();
        invoker.setServiceUrl(properties.getServiceUrl());
        invoker.setServiceInterface(BeispielServiceRemoteBean.class);
        return invoker;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Auf der Bean können alle Methoden des Interfaces <code>serviceInterface</code> aufgerufen werden, der Aufruf erfolgt dann automatisch
per HTTP Invoker gegen das in <code>serviceUrl</code> konfigurierte Ziel-System.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Die URL wird als betriebliche Konfiguration in <code>application.properties</code> ausgelagert und durch eine <code>@ConfigurationProperties</code>-Klasse von Spring Boot gesetzt.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="erweiterung-um-die-aufrufwiederholung-mittels-service-utilities"><a class="anchor" href="#erweiterung-um-die-aufrufwiederholung-mittels-service-utilities"></a>4.2.3.3. Erweiterung um die Aufrufwiederholung mittels Service Utilities</h5>
<div class="paragraph">
<p>Die in diesem Kapitel aufgeführte Konfiguration eines aufzurufenden Services kann durch die Verwendung einer Aufruf-Wiederholungsimplementierung
erweitert werden, so dass Aufrufe bei Timeouts wiederholt werden.
Dies ist nur notwendig, sofern eine Aufrufwiederholung eine Anforderung an die Anwendung ist.
Für die Aufrufwiederholung ist lediglich die Spring-Konfiguration des Proxies anzupassen:</p>
</div>
<div id="listing-KDmSAWied" class="listingblock">
<div class="title">Listing 10. Konfiguration der Service-API mit Aufruf-Wiederholungen</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
public class ServiceConfig {
    @Bean
    public HttpInvokerProxyFactoryBean invoker(ServiceConfigProperties properties, HttpInvokerRequestExecutor executor) {
        HttpInvokerProxyFactoryBean invoker = new HttpInvokerProxyFactoryBean();
        invoker.setServiceUrl(properties.getServiceUrl());
        invoker.setServiceInterface(BeispielServiceRemoteBean.class);
        return invoker;
    }

    @Bean
    public TimeoutWiederholungHttpInvokerRequestExecutor executor(ServiceConfigProperties properties) {
        TimeoutWiederholungHttpInvokerRequestExecutor executor = new TimeoutWiederholungHttpInvokerRequestExecutor();
        executor.setAnzahlWiederholungen(properties.getWiederholungen());
        executor.setTimeout(properties.getTimeout());
        return executor;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Auf der Bean <code>executor</code> sind die <code>anzahlWiederholungen</code> und der <code>timeout</code> konfiguriert.
Dieser <code>RequestExecutor</code> erweitert den Standard-<code>RequestExecutor</code> von Spring um die Möglichkeit Timeouts zu definieren und eine konfigurierte Anzahl an Aufruf-Wiederholungen durchzuführen.
Dieser <code>RequestExecutor</code> ist der Spring-HttpInvokerProxyFactoryBean bekannt zu machen.</p>
</div>
</div>
<div class="sect4">
<h5 id="implementierung-des-wrappers"><a class="anchor" href="#implementierung-des-wrappers"></a>4.2.3.4. Implementierung des Wrappers</h5>
<div class="paragraph">
<p>Zur Entkopplung des eigenen Anwendungskerns von der Schnittstelle wird ein Wrapper für die Schnittstelle implementiert.
Der Wrapper führt das Mapping der internen Datenobjekte auf die Transportobjekte durch.
Dieses kann bei Bedarf mit einem Bean Mapper gemacht werden.</p>
</div>
<div class="paragraph">
<p>Zusätzlich führt der Wrapper das Exception-Handling durch.
Der Wrapper kann auftretende Exceptions in eigene Exceptions umwandeln (Exception-Chaining) oder explizit behandeln.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="batch-verarbeitung"><a class="anchor" href="#batch-verarbeitung"></a>4.3. Batch-Verarbeitung</h3>
<div class="paragraph">
<p>In diesem Kapitel wird die Implementierung von Batches zu einer Anwendung beschrieben.</p>
</div>
<div class="sect3">
<h4 id="designvorgaben-4"><a class="anchor" href="#designvorgaben-4"></a>4.3.1. Designvorgaben</h4>
<div class="ulist">
<ul>
<li>
<p>Die Batch-Verarbeitung verwendet den Anwendungskern der zugehörigen Anwendung.
Der Anwendungskern ist Teil des Batch-Deployments, d.h. der Code ist sowohl Teil der Server-Anwendung als auch der Batch-Anwendung in Bezug auf Deploymenteinheiten.</p>
</li>
<li>
<p>Zur Realisierung der Batchlogik wird eine Batch-Ausführungs-Bean implementiert.</p>
</li>
<li>
<p>Falls für die Verarbeitung im Batch eigene Fachlogik benötigt wird, ist diese trotzdem den entsprechenden Anwendungskomponenten der zugehörigen Geschäftsanwendung hinzuzufügen.</p>
</li>
<li>
<p>Im Rahmen der Initialisierung hat die Ausführungs-Bean unter anderem die Aufgabe, die Konsistenz und Korrektheit der Eingabedaten zu prüfen.</p>
</li>
<li>
<p>Falls die zu verarbeitenden Sätze eines Batches das Ergebnis einer Datenbank-Query sind, ist in der Initialisierung die Query über eine Anwendungskomponente der zugehörigen Geschäftsanwendung abzusetzen.
Diese Query soll die (fachlichen) Schlüssel von Entitäten, nicht Entitäten selbst auslesen.</p>
</li>
<li>
<p>Die Batches sind möglichst robust zu konstruieren: Falls auf ein fachliches Problem in der Ausführungs-Bean reagiert werden kann, sollte dies getan werden.</p>
</li>
<li>
<p>Batches erzeugen ein Ausführungsprotokoll.
Der Batchrahmen, die Steuerungsimplementierung, die jeden Batch und dessen Arbeitsschritte steuert, stellt die notwendige Implementierung bereit.
Die Ausführungs-Bean übermittelt dem Batchrahmen Status-Informationen für das Protokoll.</p>
</li>
<li>
<p>Batches verwenden einen (konfigurierten) technischen Benutzer, um sich vor Start der fachlichen Verarbeitung am IAM-Service des Anwendungssystems oder der Anwendungslandschaft zu authentifizieren.</p>
</li>
<li>
<p>Alle Batches zu einer Anwendung werden als eigenständige Deployment-Einheit ausgeliefert.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="klassendesign-4"><a class="anchor" href="#klassendesign-4"></a>4.3.2. Klassendesign</h4>
<div class="paragraph">
<p>Klassendesign eines Batches</p>
</div>
<div id="image-KDBatch" class="imageblock text-center">
<div class="content">
<img src="../_images/tutorial/KDBatch.png" alt="KDBatch" width="80%">
</div>
</div>
<div class="paragraph">
<p><a href="#image-KDBatch">Abbildung 6</a> zeigt eine beispielhafte Implementierung eines Batches, der die Komponenten <code>Auskunft</code> und <code>Basisdaten</code> verwendet.</p>
</div>
<div class="paragraph">
<p>Im Normalfall erhält die Batch-Bean (<code>AuskunftBatch</code>) eine Referenz auf die Komponenten des Anwendungskerns per Spring-Dependency.
Für die Komponente Basisdaten erfolgt der Zugriff wie immer mittels statischer Aufrufe der DAOs.</p>
</div>
<div class="paragraph">
<p>Der Batchrahmen definiert das Interface <code>BatchAusfuehrungsBean</code>. Dieses dient der Steuerung des Batches durch den Batchrahmen.
Es muss von der Batch-Ausführungs-Bean implementiert werden.
Der Batchrahmen sorgt auch für die Initialisierung und Ausführung des Batches.</p>
</div>
<div class="paragraph">
<p>Der Batchrahmen übernimmt die Transaktionssteuerung.
Die Transaktionssteuerung im Batch sieht vor, mehrere Arbeitsschritte in einer Transaktion abzuwickeln.
Die Größe der Transaktion (Commit-Rate) wird über den Batchrahmen konfiguriert.</p>
</div>
</div>
<div class="sect3">
<h4 id="realisierung-4"><a class="anchor" href="#realisierung-4"></a>4.3.3. Realisierung</h4>
<div class="sect4">
<h5 id="einbinden-der-bibliothek"><a class="anchor" href="#einbinden-der-bibliothek"></a>4.3.3.1. Einbinden der Bibliothek</h5>
<div class="paragraph">
<p>Zur Realisierung von Batches muss die in <a href="#listing-bib-batch">Listing 11</a> aufgelistete Bibliothek eingebunden werden.</p>
</div>
<div id="listing-bib-batch" class="listingblock">
<div class="title">Listing 11. Einbindung der Bibliotheken zur Realisierung von Batches</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-batchrahmen&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="implementierung-der-batch-logik"><a class="anchor" href="#implementierung-der-batch-logik"></a>4.3.3.2. Implementierung der Batch-Logik</h5>
<div class="paragraph">
<p>Die Batch-Logik wird implementiert, in dem eine Batch-Bean im Package <code>&lt;organisation&gt;.&lt;domäne&gt;.&lt;anwendung&gt;.batch</code> implementiert wird.
Für die Realisierung ist es notwendig, dass die Batch-Bean das Interface <code>BatchAusfuehrungsBean</code> aus der Bibliothek <code>isy-batchrahmen</code> implementiert.</p>
</div>
<div class="paragraph">
<p>Der Batchrahmen ruft als Erstes die Methode <code>initialisieren</code> auf.
Dabei werden alle zur Initialisierung benötigten Informationen übergeben.
Details dazu werden im JavaDoc der Methode beschrieben.</p>
</div>
<div class="paragraph">
<p>Der Parameter <code>BatchErgebnisProtokoll</code> enthält eine Referenz auf ein Protokollobjekt, welches der Batch verwendet, um Protokoll-Meldungen und Statistiken an den Batchrahmen zu übergeben.</p>
</div>
</div>
<div class="sect4">
<h5 id="konfiguration-des-batches-und-batchrahmens"><a class="anchor" href="#konfiguration-des-batches-und-batchrahmens"></a>4.3.3.3. Konfiguration des Batches und Batchrahmens</h5>
<div class="paragraph">
<p>Für jeden Batch muss eine Property-Datei in <code>/src/main/resources/resources/batch</code> angelegt werden.
In dieser statischen Konfiguration werden unter anderem die Batch-ID und die Transaktionssteuerung konfiguriert.
Eine Beschreibung der Parameter ist in <a href="../../blaupausen/detailkonzept-komponente-batch/master.html" class="xref page">Detailkonzept Komponente Batch</a> enthalten.</p>
</div>
<div class="paragraph">
<p>Die betriebliche Konfiguration des Batches ist identisch zu derjenigen der zugehörigen Anwendung.
Auch Parameter, die nur für den Batch benötigt werden, werden in die betriebliche Konfiguration der Geschäftsanwendung aufgenommen.</p>
</div>
</div>
<div class="sect4">
<h5 id="spring-konfiguration-anlegen"><a class="anchor" href="#spring-konfiguration-anlegen"></a>4.3.3.4. Spring-Konfiguration anlegen</h5>
<div class="paragraph">
<p>Für den Batchrahmen werden in der Konfigurationsklasse der Batch-Schicht die Spring-Beans des Batchrahmens und für jeden existierenden Batch die Ausführungs-Bean als Spring-Bean definiert.</p>
</div>
<div class="paragraph">
<p>Zusätzlich müssen folgende Beans erstellt werden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eine Bean vom Typ <code>BatchRahmenMBean</code> zur Überwachung des Batchrahmens.
Diese muss über den Spring MBeanExporter exportiert werden.</p>
</li>
<li>
<p>Eine Bean für den <code>AufrufKontextVerwalter</code>, die nicht den Scope <code>thread</code> hat. Ist in der Anwendungskonfiguration
bereits eine Bean dieses Typs definiert, kann sie mit der Annotation <code>@ExcludeFromBatchContext</code> ausschließen.</p>
</li>
<li>
<p>Eine Bean für einen <code>JpaTransactionManager</code>.</p>
</li>
<li>
<p>Die Konfigurationsklasse der Batch-Schicht muss mit der Annotation</p>
<div class="literalblock">
<div class="content">
<pre>@EntityScan("de.bund.bva.isyfact.batchrahmen.persistence.rahmen")</pre>
</div>
</div>
<div class="paragraph">
<p>versehen werden, damit die Entitäten des Batchrahmens gefunden werden.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Die Spring-Konfiguration der Anwendung kann auch für den Batches verwendet werden.
Dazu müssen Beans, nicht die nicht für Ausführung eines Batches instanziiert werden sollen, mit
<code>@ExcludeFromBatchContext</code> annotiert werden.</p>
</div>
</div>
<div class="sect4">
<h5 id="konfiguration-des-batch-deployments"><a class="anchor" href="#konfiguration-des-batch-deployments"></a>4.3.3.5. Konfiguration des Batch-Deployments</h5>
<div class="paragraph">
<p>Für das Deployment des Batches wird ein neues Maven-Projekt <code>&lt;system&gt;-batch</code> angelegt.
Dieses hat die Aufgabe das Deployment-Paket für den Batch zusammenzustellen.</p>
</div>
<div class="paragraph">
<p>Dazu wird eine neue pom.xml angelegt, die als Ziel-Typ ein Jar mit allen Dateien des Batches erzeugt.
Zusätzlich können in diesem Projekt Shell-Skripte und ähnliches für den Batch abgelegt werden.
Ein Beispiel ist in <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-vorlageanwendung" class="xref page">Vorlageanwendung</a> enthalten.</p>
</div>
<div class="paragraph">
<p>Das Batch-Projekt enthält keinen Java-Code.
Die Batch-Beans liegen im normalen Anwendungsprojekt.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="querschnitt"><a class="anchor" href="#querschnitt"></a>5. Querschnitt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In diesem Kapitel wird die Umsetzung querschnittlicher Aspekte beschrieben.</p>
</div>
<div class="sect2">
<h3 id="logging"><a class="anchor" href="#logging"></a>5.1. Logging</h3>
<div class="paragraph">
<p>In diesem Abschnitt wird beschrieben, wie das Logging umzusetzen und zu konfigurieren ist.</p>
</div>
<div class="sect3">
<h4 id="designvorgaben-5"><a class="anchor" href="#designvorgaben-5"></a>5.1.1. Designvorgaben</h4>
<div class="ulist">
<ul>
<li>
<p>Für Logging wird die Bibliothek <code>isy-logging</code> verwendet.</p>
</li>
<li>
<p>Es wird ein Debug-, Info- und ein Error-Log geführt.
Die Zuordnung der Log-Levels auf diese Log-Arten wird im Dokument <a href="../../isy-logging/konzept/master.html#einleitung" class="xref page">Konzept Logging</a> definiert.
Ebenso welche Informationen mit welchem Log-Level ausgeben werden sollen.</p>
</li>
<li>
<p>Für das Logging wird die im Rahmen der IsyFact erstellten Layouts für Entwicklung und Produktion verwendet.</p>
</li>
<li>
<p>In jeder Log-Meldung ist eine Correlation-ID mitzuloggen.
Diese identifiziert den Aufruf über die Anwendungslandschaft hinweg.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="realisierung-5"><a class="anchor" href="#realisierung-5"></a>5.1.2. Realisierung</h4>
<div class="sect4">
<h5 id="implementierung-von-log-ausgaben"><a class="anchor" href="#implementierung-von-log-ausgaben"></a>5.1.2.1. Implementierung von Log-Ausgaben</h5>
<div class="paragraph">
<p>Log-Ausgaben können an beliebigen Stellen im Code erzeugt werden.
Dazu wird in jeder Klasse ein eigener Logger erzeugt (<a href="#listing-logger">Listing 12</a>).</p>
</div>
<div id="listing-logger" class="listingblock">
<div class="title">Listing 12. Erzeugen eines Loggers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyClass {
...
   private static final IsyLoggerStandard LOG = IsyLoggerFactory.getLogger(MyClass.class);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Der <code>IsyLoggerStandard</code> ist dabei für technisches Logging gedacht.
Je nach Anwendungsszenario sind andere spezifische Logger (<code>IsyLoggerFachdaten</code>, <code>IsyLoggerTypisiert</code>) zu verwenden.</p>
</div>
<div class="paragraph">
<p>Wichtig ist, in der Exception-Fassade an der Service-Schnittstelle (siehe Kapitel <a href="#klassendesign-2">Klassendesign</a>) die Correlation-ID zu setzen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@StelltLoggingKontextBereit
public int cdErworben(AufrufKontext kontext, …)
…</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="einbinden-der-bibliotheken-1"><a class="anchor" href="#einbinden-der-bibliotheken-1"></a>5.1.2.2. Einbinden der Bibliotheken</h5>
<div class="paragraph">
<p>Um die Logging Funktionen in der eigenen Anwendung nutzen zu können müssen die in <a href="#listing-bib-logging">Listing 13</a> aufgelisteten Bibliotheken eingebunden werden.</p>
</div>
<div id="listing-bib-logging" class="listingblock">
<div class="title">Listing 13. Einbindung der Bibliotheken zur Nutzung des Logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-logging&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dadurch wird die Bibliothek <code>isy-logging</code> sowie Logback als verwendetes Produkt automatisch in die Anwendung integriert.</p>
</div>
</div>
<div class="sect4">
<h5 id="anlegen-der-konfiguration"><a class="anchor" href="#anlegen-der-konfiguration"></a>5.1.2.3. Anlegen der Konfiguration</h5>
<div class="paragraph">
<p>In <code>/src/main/resources/</code> muss die Datei <code>logback-spring.xml</code> angelegt werden.
Diese definiert, wohin Log-Ausgaben geschrieben werden und wie das Layout dafür ist.
Die Bibliothek <code>isy-logging</code> bringt fertig konfigurierte Layouts mit, die dort eingebunden werden.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="konfiguration"><a class="anchor" href="#konfiguration"></a>5.2. Konfiguration</h3>
<div class="paragraph">
<p>In diesem Kapitel wird die Verarbeitung von Konfigurationen in Anwendungen beschrieben.</p>
</div>
<div class="sect3">
<h4 id="designvorgaben-6"><a class="anchor" href="#designvorgaben-6"></a>5.2.1. Designvorgaben</h4>
<div class="ulist">
<ul>
<li>
<p>Für die Konfiguration werden betriebliche, statische und Benutzerkonfigurationen unterschieden.
Eine Definition und Kriterien zur Typisierung können in <a href="../../isy-konfiguration/konzept/master.html#einleitung" class="xref page">Konzept Konfiguration</a> nachgelesen werden.</p>
</li>
<li>
<p>Die betriebliche Konfiguration wird in <code>/src/main/resources/config/application.properties</code> abgelegt.</p>
</li>
<li>
<p>Statische Konfigurationen werden als Datei in <code>/src/main/resources/resources</code> abgelegt.</p>
</li>
<li>
<p>Benutzerkonfigurationen werden in der Datenbank abgelegt.</p>
</li>
<li>
<p>Betriebliche Konfigurationen können in Ausnahmefällen zur Laufzeit aktualisiert werden.</p>
</li>
<li>
<p>Für das Laden von betrieblichen Konfigurationen werden <code>@ConfigurationProperties</code>-Klassen verwendet.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="realisierung-6"><a class="anchor" href="#realisierung-6"></a>5.2.2. Realisierung</h4>
<div class="sect4">
<h5 id="auslesen-von-konfigurationsparametern-in-der-anwendung"><a class="anchor" href="#auslesen-von-konfigurationsparametern-in-der-anwendung"></a>5.2.2.1. Auslesen von Konfigurationsparametern in der Anwendung</h5>
<div class="paragraph">
<p>Für den Zugriff auf Konfigurationsparameter in <code>application.properties</code> werden Klassen erstellt, die beim Start
der Anwendung mit den Werten aus <code>application.properties</code> befüllt werden.
Der Zugriff auf diese Klassen ist typsicher und die Werte können zusätzlich mit Bean Validierung überprüft werden.
Zur Verwendung in den Komponenten der Anwendung oder zur Konfiguration von Spring Beans werden diese Klassen per
Dependency Injection verfügbar gemacht.
Details zur Implementierung siehe <a href="../../isy-konfiguration/konzept/master.html#einleitung" class="xref page">Konzept Konfiguration</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fehlerbehandlung"><a class="anchor" href="#fehlerbehandlung"></a>5.3. Fehlerbehandlung</h3>
<div class="paragraph">
<p>In diesem Kapitel wird beschrieben, wie die Fehlerbehandlung durchzuführen ist.</p>
</div>
<div class="sect3">
<h4 id="designvorgaben-7"><a class="anchor" href="#designvorgaben-7"></a>5.3.1. Designvorgaben</h4>
<div class="ulist">
<ul>
<li>
<p>In jeder Anwendung bzw. Bibliothek wird eine eigene Exception-Hierarchie angelegt.</p>
</li>
<li>
<p>Für Anwendungs-Exceptions wird die oberste Exception dieser Hierarchie von den in der Bibliothek <code>isy-exception-core</code> enthaltenen Exception-Klassen abgeleitet.
Diese Ober-Exceptions sind als abstrakt zu kennzeichnen.</p>
</li>
<li>
<p>Für Exceptions in selbst entwickelten Bibliotheken werden nicht die Exception-Klassen aus <code>isy-exception-core</code> verwendet.
Die zugrundeliegenden Designprinzipien sind jedoch identisch umzusetzen.
So wird für jede Bibliothek eine abstrakte Ober-Exception angelegt.
Diese sorgt für das Laden der Nachrichten, erbt aber direkt von einer der <code>java.lang.Exception</code> bzw. <code>java.lang.RuntimeException</code>.</p>
</li>
<li>
<p>Fehlertexte werden in Resource-Bundles ausgelagert und über eine Fehler-ID identifiziert.
Die Schlüssel der Fehler-IDs werden in einer Konstantenklasse zusammengefasst.</p>
</li>
<li>
<p>Exceptions werden grundsätzlich nur zur Signalisierung abnormer Ergebnisse bzw. Situationen eingesetzt.</p>
</li>
<li>
<p>Exceptions sind in der Regel zu behandeln und zu loggen.
Ist es nicht möglich die Exception zu behandeln, muss sie an den Aufrufer weitergegeben werden.
Die Exception wird im Fall eines Weiterwerfens nicht geloggt.</p>
</li>
<li>
<p>Nur Exceptions in Methodensignaturen verwenden, die auch vorkommen können.</p>
</li>
<li>
<p>Bei der Behandlung von Fehlern ist ein geordneter Systemzustand herzustellen, z. B. das Schließen
der Datenbankverbindung über einen <code>finally</code>-Block.</p>
</li>
<li>
<p>Fehler sollten möglichst früh erkannt werden und zu entsprechenden Ausnahmen führen.</p>
</li>
<li>
<p>Interne Exceptions dürfen in der Service-Schnittstelle nicht vorkommen.</p>
</li>
<li>
<p>Catch-Blöcke dienen der Fehlerbehandlung und dürfen nicht als <code>else</code>-Zweige genutzt werden.</p>
</li>
<li>
<p>Keine leeren Catch-Blöcke.</p>
</li>
<li>
<p>Das destruktive Wrappen einer Exception zerstört den StackTrace und ist nur für Exceptions an den Außen-Schnittstellen sinnvoll.
Destruktiv gewrappte Exceptions sind in jedem Fall vor dem Wrappen zu loggen.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Weitere Hinweise für die richtige Behandlung von Fehlern sind in <a href="../../isy-exception-core/konzept/master.html#einleitung" class="xref page">Konzept Fehlerbehandlung</a> enthalten.</p>
</div>
</div>
<div class="sect3">
<h4 id="paketstruktur"><a class="anchor" href="#paketstruktur"></a>5.3.2. Paketstruktur</h4>
<div class="paragraph">
<p>Exceptions die querschnittlich, also von mehreren Komponenten genutzt werden, werden im Paket:</p>
</div>
<div class="paragraph">
<p><code>&lt;organisation&gt;.&lt;domäne&gt;.&lt;anwendung&gt;.common.exception</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
<code>&lt;organisation&gt;</code> z.B. bva.bund.de
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>implementiert. Komponentenspezifische Exceptions, also solche die nur von einer einzigen
Komponente genutzt werden, gehören in das Paket:</p>
</div>
<div class="paragraph">
<p><code>&lt;organisation&gt;.&lt;domäne&gt;.&lt;anwendung&gt;.core.&lt;komponente&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="realisierung-7"><a class="anchor" href="#realisierung-7"></a>5.3.3. Realisierung</h4>
<div class="paragraph">
<p>Die Bibliothek ist in zwei Teile aufgeteilt: <code>isy-exception-core</code> und <code>isy-exception-sst</code>.
Das Core-Paket enthält anwendungsinterne Exception-Klassen und Hilfsklassen für das Exception-Mapping.
Im Schnittstellen-Projekt sind die Klassen für die Transport-Exceptions enthalten.
Wenn das Core-Paket eingebunden wird, wird über Maven automatisch das Schnittstellen-Projekt mit eingebunden.
Die explizite Einbindung von <code>isy-exception-sst</code> sollte dann entfernt werden.</p>
</div>
<div class="paragraph">
<p>Die Core-Bibliothek wird im Wesentlichen im Anwendungskern bzw.
der Service-Schnittstellen-Implementierung benötigt
(siehe <a href="#bibliotheken-fuer-die-implementierung-der-service-schnittstelle">Bibliotheken für die Implementierung der Service-Schnittstelle</a>). Für Service-Schnittstellen
werden lediglich die Transport-Exceptions aus <code>isy-exception-sst</code> benötigt
(siehe Kapitel <a href="#bibliotheken-fuer-das-service-schnittstellen-projekt">Bibliotheken für das Service-Schnittstellen-Projekt</a>).</p>
</div>
<div class="sect4">
<h5 id="einbinden-der-bibliothek-1"><a class="anchor" href="#einbinden-der-bibliothek-1"></a>5.3.3.1. Einbinden der Bibliothek</h5>
<div class="paragraph">
<p>Zur Realisierung der Fehlerbehandlung und Implementierung von Exceptions müssen die in <a href="#listing-bib-fehlerbehandlung">Listing 14</a>
aufgelisteten Bibliotheken eingebunden werden.</p>
</div>
<div id="listing-bib-fehlerbehandlung" class="listingblock">
<div class="title">Listing 14. Einbindung der Bibliotheken für die Fehlerbehandlung</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-exception-core&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-util&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>isy-exception-core</code> enthält abstrakte Exception-Klassen die in Anwendungen zu verwenden sind.
<code>isy-util</code> enthält Hilfsklassen zum Laden von Fehlertexten.</p>
</div>
</div>
<div class="sect4">
<h5 id="anlegen-der-exception-klassen"><a class="anchor" href="#anlegen-der-exception-klassen"></a>5.3.3.2. Anlegen der Exception-Klassen</h5>
<div class="paragraph">
<p>In jeder Anwendung wird für jede Exception-Art (technisch, fachlich) eine eigene Oberklasse angelegt.
Diese erbt von der entsprechenden Klasse aus <code>isy-exception-core</code>. Zum Laden der
 Fehlertexte wird das Interface FehlertextProvider aus derselben Bibliothek verwendet.
In <code>isy-util</code> ist die Implementierung <code>MessageSourceFehlertextProvider</code> enthalten.
Diese unterstützt das Laden von Fehlertexten aus einer Spring-Message-Source.
Ein Beispiel für die Verwendung ist in der <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-vorlageanwendung" class="xref page">Vorlageanwendung</a> enthalten.</p>
</div>
</div>
<div class="sect4">
<h5 id="fehlerbehandlung-an-der-anwendungsschnittstelle"><a class="anchor" href="#fehlerbehandlung-an-der-anwendungsschnittstelle"></a>5.3.3.3. Fehlerbehandlung an der Anwendungsschnittstelle</h5>
<div class="paragraph">
<p>Fehler sind entweder zu behandeln und zu loggen oder weiterzuwerfen.
Es muss jedoch sichergestellt werden, dass interne Fehler der Anwendung nicht über die
System-Schnittstelle (siehe <a href="#anbieten-von-service-schnittstellen">Anbieten von Service-Schnittstellen</a>) geworfen werden.
Dazu wird in der Exception-Fassade eine explizite Fehlerbehandlung mit einem Catch-Throwable-Block durchgeführt.</p>
</div>
<div class="paragraph">
<p>Alle Exceptions der Anwendungen werden hier in Transport-Exceptions umgewandelt.
Dazu wird das im Folgenden beschrieben Muster verwendet.</p>
</div>
<div class="paragraph">
<p>Es wird ein Catch-Block für alle auftretenden eigenen Exceptions angelegt.
In jedem Catch-Block wird die Exception geloggt und über <code>ExceptionMapper.mapException()</code>
in eine passende Transport-Exception umgewandelt.
Als Letztes wird ein Catch-Throwable-Block eingefügt.</p>
</div>
<div class="paragraph">
<p>Hier wird für die aufgetretene Exception über <code>ExceptionMapper.createToException()</code>
eine neue Transport-Exception erzeugt.
Zur Ermittlung der Fehler-ID wird eine Klasse AusnahmeIdUtil angelegt.
Diese implementiert eine statische Methode <code>getAusnahmeId</code>, die zu einer übergebenen Exception
eine passende Fehler-ID ermittelt.
Vor dem Werfen der so erzeugten Exception über die Schnittstelle wird ein Log-Eintrag erzeugt.</p>
</div>
<div class="paragraph">
<p>Beim Umwandeln der internen Exceptions in Transport-Exceptions wird der Stack-Trace der internen Exceptions verworfen.</p>
</div>
<div class="paragraph">
<p>Ein Beispiel hierfür ist wieder in <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-vorlageanwendung" class="xref page">Vorlageanwendung</a> enthalten.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aufrufkontextverwaltung"><a class="anchor" href="#aufrufkontextverwaltung"></a>5.4. Aufrufkontextverwaltung</h3>
<div class="paragraph">
<p>Einige Komponenten der Anwendung, z.B. die Protokollierung oder die Autorisierung benötigen
Kontextinformationen über den Aufrufer.
Damit diese nicht durch die gesamte Anwendung gereicht werden müssen, kann in der Anwendung
ein <code>AufrufKontextVerwalter</code> verwendet werden.</p>
</div>
<div class="sect3">
<h4 id="designvorgaben-9"><a class="anchor" href="#designvorgaben-9"></a>5.4.1. Designvorgaben</h4>
<div class="ulist">
<ul>
<li>
<p>Die Komponente wird so implementiert, dass sie spezifische Informationen über den Aufrufkontext speichern kann (z.B. Name des aufrufenden Benutzers).</p>
</li>
<li>
<p>Die Komponente kann in einer Anwendung so erweitert werden, dass sie beliebige weitere Kontext-Informationen aufnehmen kann.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="realisierung-9"><a class="anchor" href="#realisierung-9"></a>5.4.2. Realisierung</h4>
<div class="sect4">
<h5 id="einbinden-der-bibliothek-3"><a class="anchor" href="#einbinden-der-bibliothek-3"></a>5.4.2.1. Einbinden der Bibliothek</h5>
<div class="paragraph">
<p>Zur Realisierung des Aufrufkontextes müssen die in <a href="#listing-bib-aufrufkontext">Listing 15</a> aufgelisteten Bibliotheken eingebunden werden.</p>
</div>
<div class="paragraph">
<p>Einbindung der Bibliotheken zur Nutzung des Aufrufkontextes</p>
</div>
<div id="listing-bib-aufrufkontext" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-aufrufkontext&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Die Bibliothek <code>isy-aufrufkontext</code> enthält die Komponente <code>AufrufKontextVerwalter</code>, welcher den benutzerspezifischen Aufrufkontext im Thread-Scope (alternativ Request-Scope) hält.</p>
</div>
</div>
<div class="sect4">
<h5 id="konfiguration-der-bibliothek"><a class="anchor" href="#konfiguration-der-bibliothek"></a>5.4.2.2. Konfiguration der Bibliothek</h5>
<div class="paragraph">
<p>Die Komponente <code>AufrufKontextVerwalter</code> wird als Spring-Bean konfiguriert.
Dabei wird festgelegt, dass Spring eine neue Instanz für jeden Thread (alternativ Request) anlegen soll:</p>
</div>
<div id="listing-ARKxtVerw" class="listingblock">
<div class="title">Listing 15. Spring-Konfiguration der Bean AufrufKontextVerwalter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
@Scope(value="request", proxyMode = ScopedProxyMode.TARGET_CLASS)
public AufrufKontextVerwalter aufrufKontextVerwalter(){
    return new AufrufKontextVerwalterImpl();
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Die Scopes <code>thread</code> und <code>request</code> werden mit dem Einbinden der Bibliothek <code>isy-sicherheit</code> registriert.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Der vom AufrufKontextVerwalter verwaltete AufrufKontext wird beim Aufruf der Anwendung in der Service-Schnittstelle oder im Controller der GUI gesetzt und steht fortan, während der Verarbeitung des Requests, in der gesamten Anwendung zur Verfügung.</p>
</div>
<div class="paragraph">
<p>Komponenten, die diese Informationen benötigen, erhalten dazu einfach eine Referenz auf den <code>AufrufKontextVerwalter</code> per Dependency Injection.</p>
</div>
<div class="paragraph">
<p>Zur Entgegennahme des Aufrufkontextes an der Service-Schnittstelle wird die Annotation <code>@StelltAufrufKontextBereit</code> verwendet.
Die Konfiguration ist im Dokument <a href="../../isy-sicherheit/nutzungsvorgaben/master.html#einleitung" class="xref page">Nutzungsvorgaben Sicherheit</a> beschrieben.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authentifizierung-und-autorisierung"><a class="anchor" href="#authentifizierung-und-autorisierung"></a>5.5. Authentifizierung und Autorisierung</h3>
<div class="paragraph">
<p>Dieses Kapitel beschreibt die Realisierung der Authentifizierung und Autorisierung von Anfragen.</p>
</div>
<div class="sect3">
<h4 id="designvorgaben-10"><a class="anchor" href="#designvorgaben-10"></a>5.5.1. Designvorgaben</h4>
<div class="ulist">
<ul>
<li>
<p>Die Authentifizierung von Anfragen wird im Servicegateway und im Portal mithilfe des IAM-Services durchgeführt.</p>
</li>
<li>
<p>Prozesse, die innerhalb des Anwendungssystems oder der Anwendungslandschaft starten (z.B. Timertasks, Batches) verwenden einen technischen Benutzer und authentifizieren diesen selbständig gegen den IAM-Service.</p>
</li>
<li>
<p>Die Berechtigungsprüfung ist in der Anwendung deklarativ zu definieren bzw.
zu programmieren.</p>
</li>
<li>
<p>Eine erste Berechtigungsprüfung erfolgt in der Service-Schnittstelle oder im Web-GUI-Dialogcontroller jeder Anwendung.
Es wird geprüft, ob der Aufrufer den Service oder den Dialog überhaupt verwenden darf.</p>
</li>
<li>
<p>In jeder Service-Methode wird ein Parameter <code>AufrufKontext</code> mit den Daten des aufrufenden Benutzers übermittelt.
Dieser Parameter wird im <code>AufrufKontextVerwalter</code> hinterlegt und beim Aufruf weiterer Nachbarsysteme durchgereicht.</p>
</li>
<li>
<p>In der Web-GUI wird ein vom IAM-Service bereitgestellter HTTP-Header mit den
Daten des aufrufenden Benutzers entgegengenommen und in einen <code>AufrufKontext</code> gewandelt.
Dieser Parameter wird im <code>AufrufKontextVerwalter</code> hinterlegt und beim Aufruf weiterer Nachbarsysteme durchgereicht.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="realisierung-10"><a class="anchor" href="#realisierung-10"></a>5.5.2. Realisierung</h4>
<div class="sect4">
<h5 id="einbinden-der-bibliothek-4"><a class="anchor" href="#einbinden-der-bibliothek-4"></a>5.5.2.1. Einbinden der Bibliothek</h5>
<div class="paragraph">
<p>Zur Realisierung der Autorisierung müssen die in <a href="#listing-bib-sicherheit">Listing 17</a> aufgelisteten Bibliotheken eingebunden werden.</p>
</div>
<div id="listing-bib-sicherheit" class="listingblock">
<div class="title">Listing 16. Einbindung der Bibliotheken zur Authentifizierung und Autorisierung</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-sicherheit&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-serviceapi-sst&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Die Bibliothek <code>isy-sicherheit</code> enthält die Komponenten <code>Sicherheit</code> und <code>BerechtigungsManager</code>.</p>
</div>
<div class="paragraph">
<p>Die Bibliothek <code>isy-serviceapi-sst</code> enthält das Transportobjekt <code>AufrufKontextTo</code>, das zur Übermittlung der Authentifizierungsdaten über Schnittstellenaufrufe benutzt wird.</p>
</div>
<div class="paragraph">
<p>Zusätzlich wird als Abhängigkeit der <code>AufrufKontextVerwalter</code> (siehe <a href="#aufrufkontextverwaltung">Aufrufkontextverwaltung</a>) benötigt,
der die Informationen zum Aufrufer kennt.</p>
</div>
</div>
<div class="sect4">
<h5 id="konfiguration-der-sicherheitskomponente"><a class="anchor" href="#konfiguration-der-sicherheitskomponente"></a>5.5.2.2. Konfiguration der Sicherheitskomponente</h5>
<div class="paragraph">
<p>Die Komponente Sicherheit wird als Spring-Bean in einer Konfigurationsklasse konfiguriert.</p>
</div>
<div class="paragraph">
<p>Die einer Rolle zugeordneten Rechte werden in der Datei <code>/src/main/resources/resources/rollenrechte.xml</code> konfiguriert.</p>
</div>
</div>
<div class="sect4">
<h5 id="pruefen-der-berechtigung"><a class="anchor" href="#pruefen-der-berechtigung"></a>5.5.2.3. Prüfen der Berechtigung</h5>
<div class="paragraph">
<p>Die Berechtigungsprüfung erfolgt in der Regel vor der fachlichen Verarbeitung in der Service-Schnittstelle oder im Dialog-Controller einer Anwendung.
Dies erfolgt über Annotationen oder im Webflow (siehe <a href="../../isy-sicherheit/nutzungsvorgaben/master.html#einleitung" class="xref page">Nutzungsvorgaben Sicherheit</a>).
Es kann auch jederzeit auf das Bean Sicherheit zugegriffen werden, um einen Berechtigungsmanager zu verwenden.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Berechtigungsmanager manager = sicherheit.getBerechtigungsManager();
manager.pruefeRecht(RechteSchluessel.RECHT_MELDEN);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Über die Methoden des Berechtigungsmanagers (z.B. <code>hatRecht</code>, <code>pruefeRecht</code>) kann die Anwendung
die Autorisierung durchführen.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ueberwachung"><a class="anchor" href="#ueberwachung"></a>5.6. Überwachung</h3>
<div class="paragraph">
<p>In diesem Abschnitt wird beschrieben, wie die Überwachung einer Anwendung realisiert wird.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Detaillierte Informationen zur Überwachung sind im Dokument <a href="../../isy-ueberwachung/konzept/master.html#einleitung" class="xref page">Konzept Überwachung</a> und in
<a href="../../isy-ueberwachung/nutzungsvorgaben/master.html#einleitung" class="xref page">Nutzungsvorgaben Überwachung</a> enthalten.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="designvorgaben-11"><a class="anchor" href="#designvorgaben-11"></a>5.6.1. Designvorgaben</h4>
<div class="ulist">
<ul>
<li>
<p>Die Erreichbarkeit des Systems wird über einen HealthCheck von Spring Boot Actuator realisiert.</p>
</li>
<li>
<p>Server-Metriken werden anbieterneutral mit Micrometer angeboten.</p>
</li>
<li>
<p>Einzelne Services können detailliert überwacht werden. Dazu stellen die Services Statistiken über ihre Nutzung
als Metriken bereit.</p>
</li>
<li>
<p>Zur Steuerung des Loadbalancing ist ein Servlet enthalten, um die Anwendung innerhalb eines Clusters deaktivierbar
zu machen.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="realisierung-11"><a class="anchor" href="#realisierung-11"></a>5.6.2. Realisierung</h4>
<div class="sect4">
<h5 id="einbinden-der-bibliothek-5"><a class="anchor" href="#einbinden-der-bibliothek-5"></a>5.6.2.1. Einbinden der Bibliothek</h5>
<div class="paragraph">
<p>Zur Realisierung der Überwachung muss die in <a href="#listing-bib-ueberwachung">Listing 18</a> aufgelistete Bibliothek eingebunden werden.</p>
</div>
<div id="listing-bib-ueberwachung" class="listingblock">
<div class="title">Listing 17. Einbindung der Bibliothek zur Überwachung von Anwendungen</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    ...
    &lt;dependency&gt;
        &lt;groupId&gt;de.bund.bva.isyfact&lt;/groupId&gt;
        &lt;artifactId&gt;isy-ueberwachung&lt;/artifactId&gt;
    &lt;/dependency&gt;
    ...
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="konfiguration-der-ueberwachungsschnittstelle"><a class="anchor" href="#konfiguration-der-ueberwachungsschnittstelle"></a>5.6.2.2. Konfiguration der Überwachungsschnittstelle</h5>
<div class="paragraph">
<p>Der HealthCheck, die Server-Metriken und das Loadbalancing Servlet werden automatisch durch die Verwendung der Bibliothek
in die Anwendung eingebunden und aktiviert. Für den HealthCheck muss explizit eine Konfiguration in den Application Properties
erfolgen, damit der Health-Status automatisch aktualisiert wird.</p>
</div>
<div class="paragraph">
<p>Die im Detail zu überwachenden Services müssen explizit konfiguriert werden. Dazu werden die Service-Beans in
Service-Statistik-Beans gekapselt, und jeder Service-Aufruf wird durch die Service-Statistik-Beans delegiert. Die
Konfiguration besteht aus zwei Teilen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Konfigurieren der Service-Statistik-Beans als Spring Beans.</p>
</li>
<li>
<p>Anbinden der Service-Statistik-Beans an die Service-Beans durch einen AOP-Advice.
Dieser Advice wird so konfiguriert, dass bei jedem Aufruf einer Methode der Service-Bean die Statistik-Bean aufgerufen wird.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<div class="divFooter"></div>

<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/isyfact.js"></script>
  </body>
</html>
