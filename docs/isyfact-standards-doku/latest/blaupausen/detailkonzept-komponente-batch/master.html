<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Komponente Batch :: IsyFact Dokumentation</title>
    <link rel="canonical" href="https://github.com/isyfact/isyfact-standards-doku/latest/blaupausen/detailkonzept-komponente-batch/master.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../../../_/css/isyfact.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://github.com/isyfact">IsyFact Dokumentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="isyfact-standards-doku" data-version="2.5-SNAPSHOT">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../einstieg/vorstellung.html">IsyFact Standards</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Einstieg</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../einstieg/vorstellung.html">Vorstellung der IsyFact</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../einstieg/vorstellung/isyfact-standards.html">IsyFact-Standards</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../einstieg/vorstellung/isyfact-erweiterungen.html">IsyFact-Erweiterungen</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../einstieg/vorstellung/rahmenbedingungen.html">Rahmenbedingungen</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/erste-schritte.html">Erste Schritte</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/tutorial/master.html">Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/whitepaper/master.html">Whitepaper</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../einstieg/migrationsleitfaden-if2/master.html">Migrationsleitfaden IsyFact 2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Blaupausen</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../referenzarchitektur/master.html">Referenzarchitektur</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../referenzarchitektur-it-system/master.html">Referenzarchitektur IT-System</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../detailkonzept-komponente-anwendungskern/master.html">Anwendungskern</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../detailkonzept-komponente-datenzugriff/master.html">Datenzugriff</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../detailkonzept-komponente-service/master.html">Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../detailkonzept-komponente-web-gui/master.html">Web GUI</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="master.html">Batch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Vorgaben</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../vorgaben-architektur/master.html">Architektur</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../vorgaben-it-sicherheit/master.html">IT-Sicherheit</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Bausteine</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Datum &amp; Zeit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-datetime/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-datetime/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Fehlerbehandlung</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-exception-core/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-exception-core/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">HttpInvoker</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-serviceapi-core/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-serviceapi-core/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Konfiguration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-konfiguration/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-konfiguration/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Logging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-logging/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-logging/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Polling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-polling/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-polling/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">REST</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-service-rest/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-service-rest/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Sicherheit</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sicherheit/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sicherheit/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Sonderzeichen</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sonderzeichen/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-sonderzeichen/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Task Scheduling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-task/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-task/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ãœberwachung</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-ueberwachung/konzept/master.html">Konzept</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-ueberwachung/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Util</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../isy-util/nutzungsvorgaben/master.html">Nutzungsvorgaben</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Methodik</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/namenskonventionen/master.html">Namenskonventionen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/versionierung/master.html">Versionierung</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../methodik/java-programmierkonventionen/master.html">Java-Programmierkonventionen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../methodik/diagrammerstellung.html">Diagrammerstellung und Modellierung</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/diagrammerstellung/diagramsnet.html">diagrams.net</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/diagrammerstellung/enterprise-architect.html">Enterprise Architect</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../methodik/vorlagen.html">Vorlagen</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/tailoring/tailoring.html">Tailoring</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../methodik/spezifikation/datenflussdiagramme.html">Datenflussdiagramme</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Werkzeuge</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../werkzeuge/einrichtung_entwicklungsumgebung/master.html">Entwicklungsumgebung</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../werkzeuge/versionierungskontrolle/master.html">Versionierungskontrolle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../werkzeuge/handbuch_dokumentation/master.html">Dokumentation der IsyFact</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../werkzeuge/seitenvorlage.html">Seitenvorlage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../werkzeuge/kopiervorlage.html">Kopiervorlage fÃ¼r neue Seiten</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../changelog/changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">IsyFact Standards</span>
    <span class="version">2.5-SNAPSHOT</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../glossary/latest/glossary/master.html">Glossar</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../glossary/latest/glossary/master.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../einstieg/vorstellung.html">IsyFact Standards</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../einstieg/vorstellung.html">2.5-SNAPSHOT</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../einstieg/vorstellung.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../einstieg/vorstellung.html">IsyFact Standards</a></li>
    <li>Blaupausen</li>
    <li><a href="../referenzarchitektur-it-system/master.html">Referenzarchitektur IT-System</a></li>
    <li><a href="master.html">Batch</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Inhalt" data-levels="3">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Komponente Batch</h1>
<div id="preamble">
<div class="sectionbody">
<h3 id="_detailkonzept" class="discrete">Detailkonzept</h3>
<div class="paragraph">
<p><span class="image left"><img src="../../../../glossary/latest/licence/_images/IFS-Logo.png" alt="IFS-Logo" width="150"></span> Dieses Dokument ist ein Teil der IsyFact-Standards. Alle Inhalte dieses Dokuments, insbesondere Texte und Grafiken, sind urheberrechtlich geschÃ¼tzt. Alle urheberrechtlichen Nutzungs- und Verwertungsrechte liegen beim Bundesverwaltungsamt.</p>
</div>
<div class="paragraph">
<p><span class="image right"><img src="../../../../glossary/latest/licence/_images/CC-BY.png" alt="Creative Commons Namensnennung" width="100"></span>
Die Nutzung ist unter den Lizenzbedingungen der Creative Commons Namensnennung 4.0 International gestattet.
Die Lizenzbestimmungen sind unter folgender URL erhÃ¤ltlich:</p>
</div>
<div class="paragraph">
<p><a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-cc-licence" class="xref page">Creative-Commons-Lizenz</a></p>
</div>
<div class="paragraph">
<p><strong>Java Bibliothek / IT-System</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 16.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Art</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">isy-batchrahmen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bibliothek</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v2.5-SNAPSHOT</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="Einleitung"><a class="anchor" href="#Einleitung"></a>1. Einleitung</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ein Batch bzw. die Batchverarbeitung bietet die MÃ¶glichkeit, Daten automatisiert und meist sequenziell zu verarbeiten.
Er stellt eine Variante zur Dialogverarbeitung dar, bei welcher die Datenverarbeitung von Benutzerinteraktionen gesteuert wird.</p>
</div>
<div class="paragraph">
<p>Neben einer Liste von Anforderungen fÃ¼r die Umsetzung von Batches, stellt IsyFact den technischen Baustein <em>Batchrahmen</em> zur VerfÃ¼gung, die in diesem Dokument nÃ¤her beschrieben werden.</p>
</div>
<div class="paragraph">
<p>In Kapitel <a href="#anforderungen">Anforderungen</a> werden die Anforderungen, in Kapitel <a href="#ausgrenzungen">Ausgrenzungen</a> die Ausgrenzungen definiert.
Die Funktionsweise des Batchrahmens und die verschiedenen Startarten sowie die Konfiguration folgt in Kapitel <a href="#der-batchrahmen">Der Batchrahmen</a>.
Dort werden auch die Transaktionssteuerung und die Restart-FunktionalitÃ¤t beschrieben, die es ermÃ¶glicht, abgebrochene Batches fortzusetzen.
Die Ãœberwachung mittels JMX ist ebenfalls enthalten.
Das Kapitel <a href="#die-ausfuehrungsbeans">Die AusfÃ¼hrungsbeans</a> beschreibt schlieÃŸlich, wie die konkrete Batchlogik Ã¼ber AusfÃ¼hrungsbeans angebunden wird.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="einfuehrung"><a class="anchor" href="#einfuehrung"></a>2. EinfÃ¼hrung</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="vorgehen"><a class="anchor" href="#vorgehen"></a>2.1. Vorgehen</h3>
<div class="paragraph">
<p>Der Begriff â€žBatchâ€œ bedeutet im Kern lediglich â€žnicht interaktive Stapelverarbeitungâ€œ. Wie ein Batch technisch umgesetzt werden soll, hÃ¤ngt davon ab, was konkret unter einem Batch verstanden wird.
Im Folgenden wird deshalb zuerst beschrieben, was ein Batch im Sinne der IsyFact ist.</p>
</div>
<div class="paragraph">
<p>Ein Batch teilt sich auf in einen â€žBatchrahmenâ€œ, die Batchlogik der einzelnen Batch-Anwendungen, sowie die von ihnen aufgerufenen Komponenten des Anwendungskerns.
Was darunter verstanden wird, wird in Kapitel <a href="#die-aufteilung-in-batchrahmen-und-batchlogik">Die Aufteilung in Batchrahmen und Batchlogik</a> beschrieben.</p>
</div>
</div>
<div class="sect2">
<h3 id="was-ist-ein-batch"><a class="anchor" href="#was-ist-ein-batch"></a>2.2. Was ist ein Batch?</h3>
<div class="paragraph">
<p>Eine GeschÃ¤ftsanwendung stellt Ã¼ber ihre Komponenten fachliche Operationen bereit.
Diese Operationen werden (zum Teil) als Services bereitgestellt.
Sie werden aber auch bei der automatisierten Bearbeitung grÃ¶ÃŸerer Datenmengen in Batches verwendet.
Typischerweise verarbeiten Batches dabei Dateilieferungen oder eine definierte Menge von DatensÃ¤tzen aus dem Datenbestand.
Einige der Operationen von Anwendungskomponenten werden nur fÃ¼r Services, einige nur fÃ¼r Batch-Verarbeitungen, andere fÃ¼r beides verwendet.</p>
</div>
</div>
<div class="sect2">
<h3 id="_namenskonvention_fÃ¼r_eine_batchanwendung"><a class="anchor" href="#_namenskonvention_fÃ¼r_eine_batchanwendung"></a>2.3. Namenskonvention fÃ¼r eine Batchanwendung</h3>
<div class="paragraph">
<p>Mit vielen Systemen wird eine eigene Batch-Deploymenteinheit ausgeliefert.
Diese wird folgendermaÃŸen benannt.</p>
</div>
<table id="table-nambat" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 1. Name einer Batchanwendung</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Name der Batchanwendung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Schema</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;anwendungsname&gt;-batch</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Beispiele</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xyz-ga-batch<br>
xyz-register-batch</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Variable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MÃ¶gliche AusprÃ¤gungen</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;anwendungsname&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Name einer Anwendung, wie in den vorigen Abschnitten beschrieben.
Er setzt sich meistens aus einem SystemkÃ¼rzel und dem Systemtyp zusammen.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="die-bestandteile-eines-batches-und-die-zielarchitektur"><a class="anchor" href="#die-bestandteile-eines-batches-und-die-zielarchitektur"></a>2.3.1. Die Bestandteile eines Batches und die Zielarchitektur</h4>
<div class="paragraph">
<p>Ein Batch verwendet fÃ¼r die fachliche Verarbeitungslogik die Operationen der Komponenten der GeschÃ¤ftsanwendung.
Neben der fachlichen Verarbeitungslogik besteht die Anwendungslogik eines Batches aus folgenden Bestandteilen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>der technischen Logik, welche spezifisch fÃ¼r genau eine Batch-Implementierung ist: FunktionalitÃ¤t fÃ¼r das Einlesen der fÃ¼r die Verarbeitung benÃ¶tigten Daten, das Aufrufen der Fachkomponenten etc.</p>
</li>
<li>
<p>querschnittliche Logik, welche fÃ¼r alle Batches gleich ist.
Dies ist z.Â B. die Checkpoint-Restart Logik (siehe Kapitel <a href="#checkpoint-restart-logik">Checkpoint / Restart Logik</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <a href="#image-AnwLogBat">Abbildung 1</a> werden diese Bestandteile in der Zielarchitektur hervorgehoben: Die spezifische technische
Batchlogik wird in Punkt 1 dargestellt, die fachlichen Operationen der Komponenten finden sich in Punkt 2.
Die querschnittliche Logik wird lediglich als Bibliothek eingebunden und ist in der Abbildung nicht dargestellt.</p>
</div>
<div class="paragraph">
<p>Die Komponente â€žBatchsteuerungâ€œ der Zielarchitektur bezieht sich auf die Steuerung eines Batch-Netzes (siehe <a href="#image-BatNetz">Abbildung 2</a>) und
wird Ã¼ber UC4 (siehe auch <a href="../../isy-konfiguration/konzept/master.html#einleitung" class="xref page">Konzept Konfiguration</a>) umgesetzt.
Sie wird in diesem Dokument nicht betrachtet.</p>
</div>
<div class="paragraph">
<p>Die Komponente â€žBatchlogikâ€œ der Zielarchitektur ist eine logische Komponente, welche die technische Logik der
Batchimplementierungen der GeschÃ¤ftsanwendung beinhaltet.
Diese Logik ist technisch gesehen keine Komponente, sondern eine Sammlung unabhÃ¤ngiger Klassen in der Batch-Schicht
der GeschÃ¤ftsanwendung.
Im Dokument wird unter Batchlogik diese Klassensammlung und keine Komponente verstanden.</p>
</div>
<div id="image-AnwLogBat" class="imageblock text-center">
<div class="content">
<img src="../_images/detailkonzept-batch/AnwLogBat.png" alt="AnwLogBat">
</div>
<div class="title">Abbildung 1. Die Anwendungslogik eines Batches (Zielarchitektur)</div>
</div>
</div>
<div class="sect3">
<h4 id="checkpoint-restart-logik"><a class="anchor" href="#checkpoint-restart-logik"></a>2.3.2. Checkpoint / Restart Logik</h4>
<div class="paragraph">
<p>Da ein Batch in einem Lauf eine groÃŸe Anzahl an DatensÃ¤tzen verarbeiten muss, soll seine Verarbeitung nicht in einer Transaktion durchgefÃ¼hrt werden.
Ebenso soll nicht jeder Datensatz in einer eigenen Transaktion verarbeitet werden, wie es die Transaktionssteuerung des Anwendungskerns vorsieht.
Vielmehr wird ein Batch sein Arbeitspaket in mehreren Paketen, und damit auch Transaktionen, abarbeiten.
Bei einem Wiederanlauf nach einem Fehler muss der Batch in der Lage sein, die bis zu seinem letzten Commit verarbeiteten DatensÃ¤tze zu Ã¼berlesen und nur die â€žneuenâ€œ DatensÃ¤tze zu verarbeiten.
Das Commit einer Transaktion bezeichnet man in diesem Fall als Checkpoint.
Das Ãœberlesen bereits verarbeiteter DatensÃ¤tze nennt man Checkpoint / Restart FÃ¤higkeit.</p>
</div>
<div class="paragraph">
<p>FÃ¼r die Umsetzung der Checkpoint / Restart FÃ¤higkeit muss der Batch in jeder Transaktion speichern, welche DatensÃ¤tze bis zum Commit verarbeitet wurden. Ãœblicherweise geschieht das durch die Ablage der Anzahl verarbeiteter DatensÃ¤tze bis zum Commit.
Abgelegt werden diese Daten in einer Batch-Statustabelle, welche fÃ¼r jeden Batch eine Zeile enthÃ¤lt.</p>
</div>
</div>
<div class="sect3">
<h4 id="der-unterschied-zwischen-batch-netz-batch-schritt-und-batch-implementierung"><a class="anchor" href="#der-unterschied-zwischen-batch-netz-batch-schritt-und-batch-implementierung"></a>2.3.3. Der Unterschied zwischen Batch-Netz, Batch-Schritt und Batch-Implementierung</h4>
<div class="paragraph">
<p>Die Verarbeitung von Massendaten durch einen Batch verlÃ¤uft meist in mehreren Schritten: Die Verarbeitung einer Datei kann beispielsweise aus ihrer Ãœbertragung auf einen internen Server, ihrer nachfolgenden PrÃ¼fung und der Verarbeitung ihres Inhalts bestehen.
Diese Verarbeitungsschritte (<em>Batch-Schritte</em>) eines Batches bilden ein â€žBatch-Netzâ€œ. Jeder Schritt wird Ã¼ber den Aufruf eines Shell-Skripts gestartet.</p>
</div>
<div id="image-BatNetz" class="imageblock text-center">
<div class="content">
<img src="../_images/detailkonzept-batch/BatNetz.png" alt="BatNetz">
</div>
<div class="title">Abbildung 2. Ein Batch-Netz</div>
</div>
<div class="paragraph">
<p>Die meisten Batch-Schritte sind keine Anwendungen: Sie werden komplett Ã¼ber ein Skript umgesetzt.
Nur die Schritte, welche die Verarbeitung in der GeschÃ¤ftsanwendung durchfÃ¼hren, sind Anwendungen und besitzen eine Java-Implementierung (die <em>Batchschritt-Implementierung</em>). In obiger Abbildung wird die Verarbeitung in der GeschÃ¤ftsanwendung durch drei Batch-Schritte parallel durchgefÃ¼hrt.
Alle drei verwenden dieselbe Batchschritt-Implementierung, arbeiten aber auf anderen Daten.</p>
</div>
<div class="paragraph">
<p>Ein Batch-Netz wird durch einen Job-Scheduler gesteuert.
Ein Batch-Schritt ist dabei der Aufruf, welcher vom Scheduler aufgerufen wird.
Aufgerufen wird ein Skript mit einer bestimmten Konfiguration. Ãœber dieses Skript wird ggf.
eine GeschÃ¤ftsanwendung mit der Ã¼bergebenen Konfiguration ausgefÃ¼hrt.
Die Konfiguration eines Batchschrittes enthÃ¤lt stets eine Batchschritt-ID, welche den Batchschritt eindeutig identifiziert.
Das bedeutet, dass jeder der drei Batchschritte in <a href="#image-BatNetz">Abbildung 2</a> eine eigene Batchschritt-ID erhÃ¤lt, obwohl alle drei Batchschritte die gleiche Batchschritt-Implementierung verwenden.
Der Grund ist, dass jeder Batchschritt auf einem anderen Nummernkreis arbeitet und somit die Batchschritte unterscheidbar sein mÃ¼ssen.
Diese Unterscheidung erfolgt Ã¼ber die Batchschritt-ID.</p>
</div>
<div class="paragraph">
<p>Dieses Dokument befasst sich nicht mit Batch-Netzen oder ihrer Steuerung.
Es behandelt die GeschÃ¤ftsanwendung-Batchimplementierungen und ihre Konfigurationen.
Der Einfachheit halber wird deshalb ein GeschÃ¤ftsanwendung-Batchschritt als â€žBatchâ€œ und eine Batchschritt-ID als â€žBatch-IDâ€œ bezeichnet.</p>
</div>
<div class="paragraph">
<p>Wichtig ist jedoch die Unterscheidung zwischen Batch und Batch-Implementierung: Der Batch ist der Aufruf aus der Produktionssteuerung heraus. Ãœber ihn wird die aufzurufende Batch-Implementierung sowie seine Konfiguration (inklusive der Batch-ID) definiert.
Die Implementierung ist Java-Code, der von mehreren Batches verwendet werden darf.</p>
</div>
</div>
<div class="sect3">
<h4 id="die-aufteilung-in-batchrahmen-und-batchlogik"><a class="anchor" href="#die-aufteilung-in-batchrahmen-und-batchlogik"></a>2.3.4. Die Aufteilung in Batchrahmen und Batchlogik</h4>
<div class="paragraph">
<p>Das Einlesen und Verarbeiten von DatensÃ¤tzen durch den Aufruf fachlicher Komponenten wird in diesem Dokument <em>Batchlogik</em> genannt.
Diese ist spezifisch fÃ¼r genau eine Batch-Implementierung.</p>
</div>
<div class="paragraph">
<p>Neben dieser Logik enthÃ¤lt eine Batch-Implementierung QuerschnittsfunktionalitÃ¤t, welche stets gleich ist.
FÃ¼r eine Batch-Implementierung umfasst diese QuerschnittsfunktionalitÃ¤t folgende Punkte:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Einlesen der Konfiguration des Batches Ã¼ber die Kommandozeile und Konfigurationsdateien</p>
</li>
<li>
<p>Instanziieren der GeschÃ¤ftsanwendungs-Komponenten in einem Spring-Kontext</p>
</li>
<li>
<p>Initialisieren, Auslesen und Verwalten der Batch-Statustabelle</p>
</li>
<li>
<p>Aufruf des Ãœberlesens von DatensÃ¤tzen bei einem Restart</p>
</li>
<li>
<p>Steuerung der Transaktionen inklusive Speicherung des Fortschritts in einer Status-Tabelle</p>
</li>
<li>
<p>Bereitstellung von ÃœberwachungsmÃ¶glichkeiten</p>
</li>
<li>
<p>Authentifizierung und Autorisierung eines betrieblich konfigurierten Batchbenutzers Ã¼ber die T-Komponente Sicherheit</p>
</li>
<li>
<p>Konfiguration, Instanziierung und Aufruf der eigentlichen Batchlogik</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Diese FunktionalitÃ¤t wird in einer Batch-Implementierung durch eine querschnittliche Komponente namens <em>Batchrahmen</em> umgesetzt.
Diese wird Ã¼ber eine Bibliothek bereitgestellt, welche in jede GeschÃ¤ftsanwendung eingebunden wird.</p>
</div>
</div>
<div class="sect3">
<h4 id="grobe-architektur-des-batchrahmens"><a class="anchor" href="#grobe-architektur-des-batchrahmens"></a>2.3.5. Grobe Architektur des Batchrahmens</h4>
<div class="paragraph">
<p>FÃ¼r den Batchrahmen wurde folgende grobe Architektur gewÃ¤hlt:</p>
</div>
<div id="image-GrobArchBatCanv" class="imageblock text-center">
<div class="content">
<img src="../_images/detailkonzept-batch/GrobArchBatCanv.png" alt="GrobArchBatCanv" width="80%">
</div>
<div class="title">Abbildung 3. Grobe Architektur des Batchrahmens</div>
</div>
<div class="paragraph">
<p>Der Batchrahmen besteht aus einem Startprogramm, welches notwendige Initialisierungen vornimmt, und einer Komponente Batchrahmen.
Die Komponente Batchrahmen Ã¼bernimmt die Steuerung des Batches und den Aufruf der Batchlogik.</p>
</div>
<div class="paragraph">
<p>Die Komponenten einer GeschÃ¤ftsanwendung werden fÃ¼r einen Batch, genau wie in der Webanwendung, Ã¼ber das Spring-Framework verwaltet.
Damit die Konfigurationen fÃ¼r die Webanwendung und fÃ¼r die Batch-Implementierungen mÃ¶glichst gleich sind, werden die Komponenten fÃ¼r den Batchrahmen und die Batchlogik in einer separaten Konfigurationsdatei und einem separaten Spring-Kontext abgelegt.
Dieser Kontext ist ein Kind-Kontext des eigentlichen <a href="../../../../glossary/latest/glossary/master.html#glossar-Anwendungskontext" class="xref page">Anwendunskontextes</a> und kann alle Beans des Anwendungskontextes verwenden.
So kann die Konfiguration der Webanwendung mit minimalen Anpassungen auch fÃ¼r den Batch verwendet werden.</p>
</div>
<div class="paragraph">
<p>Der Batchrahmen benÃ¶tigt fÃ¼r die Speicherung des Fortschritts und des Status der Batches eine Datenbankverbindung.
In der Datei werden die vom Batchrahmen benÃ¶tigten Informationen gespeichert, siehe <a href="#die-tabellen-des-batchrahmens">Die Tabellen des Batchrahmens</a>.</p>
</div>
<div class="paragraph">
<p>Bei Bedarf kÃ¶nnen in einem Batch auch weitere Datenbankverbindungen genutzt werden.
Die Einbindung weiterer Datenbanken ist in <a href="../detailkonzept-komponente-datenzugriff/master.html" class="xref page">Detailkonzept Komponente Datenzugriff</a> beschrieben.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="batches-als-eigenes-it-system"><a class="anchor" href="#batches-als-eigenes-it-system"></a>2.4. Batches als eigenes IT-System</h3>
<div class="paragraph">
<p>Batches existieren meistens als weiterer Zugangsweg in der Nutzungsschicht einer bestehenden GeschÃ¤ftsanwendung
(siehe <a href="#image-AnwLogBat">Abbildung 1</a>), da sie auf den Daten des jeweiligen Anwendungssystems operieren.</p>
</div>
<div class="paragraph">
<p>Es kann allerdings auch Batches geben, die unabhÃ¤ngig von einer bestimmten GeschÃ¤ftsanwendung sind.
Dies kann beispielsweise der Fall sein, wenn ein Import-Batch angelieferte Dateien in verschiedene GeschÃ¤ftsanwendungen importiert.
Wenn Batches nicht eindeutig einem Anwendungssystem zugeordnet werden kÃ¶nnen, kann man sie auch als eigenstÃ¤ndiges IT-System implementieren.
Dieses â€žBatch-Systemâ€œ kann dann die Service-Schnittstellen anderer GeschÃ¤ftsanwendungen aufrufen.
Insgesamt ist dies jedoch als Sonderfall zu betrachten.
In der Regel gehÃ¶ren Batches zu GeschÃ¤ftsanwendungen, sie enthalten damit den fachlichen Code dieser Anwendung und
nutzen diesen nicht Ã¼ber Service-Schnittstellen (siehe Kapitel <a href="#das-deployment-eines-batches">Das Deployment eines Batches</a>).</p>
</div>
<div class="paragraph">
<p>In diesem Fall ist das Anwendungssystem architektonisch ein eigenstÃ¤ndiges IT-System nach Zielarchitektur, nur ohne Service und GUI Bereiche in der Nutzungsschicht.</p>
</div>
<div class="paragraph">
<p>Batches die zu einer GeschÃ¤ftsanwendung gehÃ¶ren sollen jedoch nicht als eigenstÃ¤ndiges IT-System umgesetzt werden.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="anforderungen"><a class="anchor" href="#anforderungen"></a>3. Anforderungen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="anforderungen-an-den-batchrahmen"><a class="anchor" href="#anforderungen-an-den-batchrahmen"></a>3.1. Anforderungen an den Batchrahmen</h3>
<div class="paragraph">
<p>FÃ¼r den Batchrahmen selbst gelten folgende Anforderungen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Er soll den vorhandenen Nutzungsvorgaben und QuerschnittsÂ­konzepten entsprechen.</p>
</li>
<li>
<p>Die Spring-Konfiguration fÃ¼r den Batch soll der Konfiguration der Webanwendung mÃ¶glichst Ã¤hnlich sein.</p>
</li>
<li>
<p>Er soll mÃ¶glichst wenige Anforderungen an (bzw.
Annahmen in Bezug auf) die Batchlogik stellen.</p>
</li>
<li>
<p>Die Batchlogik soll mÃ¶glichst einfach implementiert werden kÃ¶nnen.</p>
</li>
<li>
<p>Die Batchrahmen-Implementierung soll programmtechnisch effizient sein.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="anforderungen-an-die-batchimplementierung"><a class="anchor" href="#anforderungen-an-die-batchimplementierung"></a>3.2. Anforderungen an die Batchimplementierung</h3>
<div class="paragraph">
<p>FÃ¼r die umzusetzende Batchlogik gelten folgende Anforderungen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sie sollen keine Fachlogik enthalten, sondern die Komponenten des Anwendungskerns verwenden.
Abweichungen sind nur aus zwingenden Performance-GrÃ¼nden erlaubt.
Dies ist jeweils mit dem technischen Chefarchitekten abzustimmen und im Systementwurf zu dokumentieren.
Falls in AusnahmefÃ¤llen direkte Datenbankzugriffe notwendig sind, sind alle weiteren Verarbeitungen an die Fach-Komponenten zu delegieren.</p>
</li>
<li>
<p>Die Batchlogik soll die Logging-, Statistik- und Protokollierungs-Aufgaben nach Anforderung des Projekts umsetzen.
Diese wird nicht durch den Batchrahmen umgesetzt.
Insbesondere die Statistikinformationen sind fÃ¼r Betrieb und Fachbereich wichtige Informationsquellen, um beispielsweise LaufzeitabschÃ¤tzungen fÃ¼r die Produktion durchfÃ¼hren zu kÃ¶nnen.
In der Statistik sollte immer enthalten sein, wie viele SÃ¤tze verarbeitet wurden (erfolgreich und mit Fehlern) und was konkret unter dem Begriff â€žSatzâ€œ zu verstehen ist.
Ist dies in der Statistik nicht vermerkt, wird davon ausgegangen, dass es sich um den Hauptsatz der GeschÃ¤ftsanwendung handelt.
Was der Hauptsatz einer GeschÃ¤ftsanwendung ist, hÃ¤ngt von der konkreten Anwendung ab.</p>
</li>
<li>
<p>Die Batchlogik soll die FunktionalitÃ¤t des â€žÃœberlesensâ€œ von DatensÃ¤tzen Ã¼bernehmen.
Ob und welche DatensÃ¤tze zu Ã¼berlesen sind, teilt der Batchrahmen mit.</p>
</li>
<li>
<p>Die Batchlogik soll dem Batchrahmen hinreichende Informationen Ã¼bergeben, um den Wiederanlaufpunkt bei einem spÃ¤teren Restart zu bestimmen.</p>
</li>
<li>
<p>Der Batchrahmen fÃ¼hrt in konfigurierbaren Intervallen Commits durch, um das Fortsetzen des Batches nach einem Abbruch zu ermÃ¶glichen.
Die Batchlogik soll mit solchen periodischen Commits umgehen kÃ¶nnen.</p>
</li>
<li>
<p>Die Batchlogik sollte â€“ sofern es keine inhaltlichen AbhÃ¤ngigkeiten gibt â€“ mit parallel laufenden Batches umgehen kÃ¶nnen.
Damit ist nicht nur gemeint, dass die gleiche Batchschritt-Implementierung parallel auf z.Â B. verschiedenen Nummernkreisen arbeiten kann.
Vielmehr ist damit gemeint, dass verschiedene Batchschritt-Implementierung parallel ausgefÃ¼hrt werden kÃ¶nnen.
Dazu ist sicherzustellen, dass gemeinsam genutzte Ressourcen nicht unnÃ¶tig gehalten werden.</p>
</li>
<li>
<p>Bei der Ausgabe von vielen Dateien wÃ¤hrend eines Batchlaufs sind diese strukturiert in Unterverzeichnissen abzulegen.
Es ist eine Datei-Namenskonvention fÃ¼r die Batch-Implementierung festzulegen.
Die Unterverzeichnisstruktur und die Anzahl der darin enthaltenen Dateien sollen parametrisierbar sein.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="anforderungen-an-die-dokumentation-von-batches"><a class="anchor" href="#anforderungen-an-die-dokumentation-von-batches"></a>3.3. Anforderungen an die Dokumentation von Batches</h3>
<div class="paragraph">
<p>FÃ¼r die Dokumentation von Batches gelten neben der lÃ¼ckenlosen und kurzen Beschreibung der durchgefÃ¼hrten Funktionen noch folgende Anforderungen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Es muss auf lang laufende Batches hingewiesen werden.
Dies ist abhÃ¤ngig von der umgesetzten Batchlogik und der erwarteten Anzahl an zu verarbeitenden DatensÃ¤tzen.
Der Betreiber des Batches soll damit schon im Vorfeld lÃ¤ngere Batchlaufzeiten einkalkulieren kÃ¶nnen.</p>
</li>
<li>
<p>Das zu erwartende Laufzeitverhalten bei steigendem MengengerÃ¼st ist anzugeben.
Dadurch soll eine AbschÃ¤tzung geliefert werden, wie sich der Batch skalieren lÃ¤sst.
Analog zum zuvor genannten Punkt soll dies eine Hilfe fÃ¼r den Betreiber zur Kalkulation von Batchlaufzeiten sein.</p>
</li>
<li>
<p>AbhÃ¤ngigkeiten von Batches werden dargestellt.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ausgrenzungen"><a class="anchor" href="#ausgrenzungen"></a>4. Ausgrenzungen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Der bereitzustellende Batchrahmen soll ein unkompliziertes und einfach zu verwendendes Framework sein.
Seine FunktionalitÃ¤ten sollen lediglich die Verarbeitung, nicht andere betriebliche Aspekte abdecken.
Explizit ausgegrenzt werden deshalb folgende Themenbereiche:</p>
</div>
<div class="paragraph">
<p><strong>Ein explizites Handling von Eingabedateien:</strong> Ein mÃ¶glicherweise erforderliches Dateihandling Ã¼bernimmt die spezifische Batchlogik.
Der Batchrahmen soll kein Wissen darÃ¼ber besitzen.</p>
</div>
<div class="paragraph">
<p><strong>Die Terminierung der Verarbeitung:</strong> Der Batch stellt keine direkten Schnittstellen bereit, um ihn wÃ¤hrend der Verarbeitung zu beenden.
Allerdings muss es mÃ¶glich sein, einen aktiven Lauf mit dem Signal <code>kill -15</code> definiert zu beenden.
Wie die zugehÃ¶rige Prozess-ID ermittelt wird, ist in den BetriebshandbÃ¼chern fÃ¼r die Prozesse zu definieren.
Es ist auch mÃ¶glich, mit dem â€žlaufzeitâ€œ-Parameter eine maximale Laufzeit anzugeben, um den Batch nach Ãœberschreitung der angegebenen Laufzeit sich selbst definiert beenden zu lassen.</p>
</div>
<div class="paragraph">
<p><strong>Das Scheduling der Verarbeitung:</strong> Das Scheduling wird nicht durch den Batchrahmen, sondern durch die betriebliche Produktionssteuerung durchgefÃ¼hrt.</p>
</div>
<div class="paragraph">
<p><strong>Das PrÃ¼fen von Vorbedingungen:</strong> Falls fÃ¼r die AusfÃ¼hrung Vorbedingungen gegeben sein mÃ¼ssen (etwa Dateien in Verzeichnissen vorliegen mÃ¼ssen), so liegt deren PrÃ¼fung in der Verantwortung des aufrufenden Skripts.</p>
</div>
<div class="paragraph">
<p><strong>Das Warten auf Events:</strong> Der Batchrahmen arbeitet eine Reihe von DatensÃ¤tzen ab und beendet sich danach.
Er ist kein Serverprozess, welcher auf bestimmte Events (Dateien in Verzeichnissen, SÃ¤tze in Datenbank) wartet, diese verarbeitet und daraufhin weiter wartet.</p>
</div>
<div class="paragraph">
<p><strong>Keine parallele Verarbeitung innerhalb eines Batches:</strong> Es ist erlaubt, dass mehrere Java-Prozesse mit der gleichen Batch-Implementierung (jedoch verschiedenen BatchIDs) parallel laufen.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Siehe Unterschied zwischen <em>Batch-Implementierung</em> und <em>Batch</em>, Kapitel <a href="#was-ist-ein-batch">Was ist ein Batch?</a>.
Parallel laufende Batches sind vor allem sinnvoll, wenn sie Ã¼ber einem aufgeteilten Datenbestand arbeiten und ein Batch pro Teil verwendet wird.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Innerhalb einer Verarbeitung wird jedoch stets mit einem Thread gearbeitet.
Multithreading innerhalb eines Batches wird nicht unterstÃ¼tzt.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="der-batchrahmen"><a class="anchor" href="#der-batchrahmen"></a>5. Der Batchrahmen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Der Batchrahmen ist das Framework, in welches sich die Logik eines konkreten Batches einfÃ¼gt.
Der Batchrahmen ruft (anhand einer Konfiguration) diese Logik auf.
Da eine Batch-Anwendung Ã¼ber Spring verwaltet wird, wird die Batchlogik als Spring-Bean konfiguriert, als sogenannte <em>AusfÃ¼hrungsbean</em>.
Diese Bean wiederum ruft die GeschÃ¤ftsanwendungs-Komponenten auf, welche die fachliche Logik enthalten.</p>
</div>
<div class="paragraph">
<p>FÃ¼r die <a href="../../../../glossary/latest/literaturextern/inhalt.html#litextern-vorlageanwendung" class="xref page">Vorlage-Anwendung</a> zeigt <a href="#image-BeanGriffBat">Abbildung 4</a> eine Auswahl der vorhandenen Beans.
Wichtig ist ihre Verteilung auf zwei Anwendungskontexte: Der Batchrahmen und die AusfÃ¼hrungsbeans werden in einem eigenen Kontext konfiguriert.
So mÃ¼ssen wenige Anpassungen vorgenommen werden, um aus der Anwendungskontext-Konfiguration als Webanwendung die Konfiguration fÃ¼r den Anwendungskontext im Batchbetrieb zu erhalten.</p>
</div>
<div id="image-BeanGriffBat" class="imageblock text-center">
<div class="content">
<img src="../_images/detailkonzept-batch/BeanGriffBat.png" alt="BeanGriffBat">
</div>
<div class="title">Abbildung 4. Bean-Zugriffe des Batchrahmens</div>
</div>
<div class="paragraph">
<p>FÃ¼r neue Batch-Implementierungen einer GeschÃ¤ftsanwendung mÃ¼ssen ggf.
GeschÃ¤ftsanwendungs-Komponenten angepasst, AusfÃ¼hrungsbeans erstellt und diese im Batch-Springkontext konfiguriert werden.
Die folgenden Abschnitte liefern die zur Entwicklung dieser Beans und zur Verwendung des Batchrahmens notwendigen Informationen.
Im Einzelnen werden die folgenden Aspekte beschrieben:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Die KonfigurationsmÃ¶glichkeiten des Batchrahmens und der AusfÃ¼hrungsbeans.</p>
</li>
<li>
<p>Das Transaktions-Handling, die Restart-FunktionalitÃ¤t und die Status-Tabellen des Batchrahmens.</p>
</li>
<li>
<p>Die im Batchrahmen enthaltenen ÃœberwachungsmÃ¶glichkeiten.</p>
</li>
<li>
<p>Die Authentifizierung und Autorisierung eines Batch-Benutzers.</p>
</li>
<li>
<p>Das Deployment der Batches einer GeschÃ¤ftsanwendung.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="die-status-und-startarten-des-batchrahmens"><a class="anchor" href="#die-status-und-startarten-des-batchrahmens"></a>5.1. Die Status und Startarten des Batchrahmens</h3>
<div class="paragraph">
<p>Im Folgenden werden die Status beschrieben, in welchen sich ein Batch laut den Batchrahmen-Tabellen befinden kann.
ZusÃ¤tzlich werden, basierend auf diesen Status, die MÃ¶glichkeiten zum Starten eines Batchlaufs beschrieben.
Diese Informationen werden hier vorgestellt und in den folgenden Abschnitten im Zusammenhang mit den Parametern und
Tabellen des Batchrahmens verwendet.</p>
</div>
<div class="paragraph">
<p>Ein Batch befindet sich in einem von vier Status, welche in den Tabellen des Batchrahmens gespeichert werden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>neu</code>: Status eines noch nicht gelaufenen Batches.
Existiert kein Eintrag in der Datenbank, dann wird dieser Status implizit verwendet.
Bricht ein noch nicht gelaufener Batch noch in der Initialisierungsphase ab, dann wird dieser Status explizit in die Datenbank geschrieben.</p>
</li>
<li>
<p><code>laeuft</code>: Der Batch wurde gestartet und lÃ¤uft aktuell.</p>
</li>
<li>
<p><code>abgebrochen</code>: Der Batch ist</p>
<div class="ulist">
<ul>
<li>
<p>mit einem Fehler</p>
</li>
<li>
<p>durch das Signal <code>kill -15</code></p>
</li>
<li>
<p>durch die Ãœberschreitung der konfigurierten maximalen Laufzeit</p>
</li>
<li>
<p>oder weil die Grenze der zu verarbeitenden DatensÃ¤tze erreicht wurde abgebrochen</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>beendet</code>: Der Batch ist erfolgreich beendet worden.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Je nachdem, in welchem Zustand sich der Batch laut den Tabellen gerade befindet, lÃ¤sst er sich nur mit bestimmten Startarten starten.
Welche Startart verwendet wird, muss Ã¼ber Parameter definiert werden.
Folgende Startarten sind mÃ¶glich:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Batch im Status <code>neu</code> oder <code>beendet</code>:</strong></p>
<div class="paragraph">
<p><code>start</code>: Der Batch startet und bearbeitet die Eingabedaten ab dem ersten Datensatz.</p>
</div>
</li>
<li>
<p><strong>Batch im Status <code>laeuft</code>:</strong></p>
<div class="paragraph">
<p><code>ignoriereLauf</code>: Der Batch wird gestartet, als wÃ¤re er erfolgreich beendet worden.</p>
</div>
<div class="paragraph">
<p><code>restart</code>: Der Batch startet neu und Ã¼berliest alle bereits verarbeiteten SÃ¤tze.</p>
</div>
</li>
<li>
<p><strong>Batch im Status <code>abgebrochen</code>:</strong></p>
<div class="paragraph">
<p><code>restart</code>: Der Batch startet neu und Ã¼berliest alle bereits verarbeiteten SÃ¤tze.</p>
</div>
<div class="paragraph">
<p><code>ignoriereRestart</code>: Der Batch startet neu und beginnt die Verarbeitung mit dem ersten Datensatz.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="die-konfiguration-des-batchrahmens"><a class="anchor" href="#die-konfiguration-des-batchrahmens"></a>5.2. Die Konfiguration des Batchrahmens</h3>
<div class="sect3">
<h4 id="konfigurationsdatei-und-kommandozeilen-parameter"><a class="anchor" href="#konfigurationsdatei-und-kommandozeilen-parameter"></a>5.2.1. Konfigurationsdatei und Kommandozeilen-Parameter</h4>
<div class="paragraph">
<p>Die Konfiguration des Batchrahmens wird Ã¼ber zwei Arten durchgefÃ¼hrt: Ã¼ber</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kommandozeilen-Parameter und</p>
</li>
<li>
<p>Konfigurationsdateien.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alle Konfigurationsparameter werden an die AusfÃ¼hrungsbean Ã¼bergeben und kÃ¶nnen genutzt werden, um sie zu konfigurieren.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Bei der Nutzung von Dateien, egal ob fÃ¼r Kommandozeilenparameter oder fÃ¼r Konfigurationsdateien,
mÃ¼ssen die Dateien mit absoluten Pfaden angegeben werden.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_reihenfolge_der_auswertung"><a class="anchor" href="#_reihenfolge_der_auswertung"></a>5.2.1.1. Reihenfolge der Auswertung</h5>
<div class="paragraph">
<p>Konfigurationsparameter werden in der folgenden Reihenfolge im Spring-Kontext angezogen. Gleichnamige Parameter werden in dieser Reihenfolge Ã¼berschrieben.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Konfiguration des Betriebssystems / der JVM</p>
</li>
<li>
<p>Konfigurationsdatei</p>
</li>
<li>
<p>Kommandouzeilen-Parameter</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kommandozeilen_parameter"><a class="anchor" href="#_kommandozeilen_parameter"></a>5.2.2. Kommandozeilen-Parameter</h4>
<div class="sect4">
<h5 id="_namenskonvention"><a class="anchor" href="#_namenskonvention"></a>5.2.2.1. Namenskonvention</h5>
<table id="table-batckonfig-konfigurationsparameter-kommandozeile" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 2. Batches: Konfigurationsparameter Kommandozeile</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Batches: Konfigurationsparameter Kommandozeile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Schema</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-&lt;Parametername&gt; &lt;Parameterwert&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Beispiele</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-laufzeit 10</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_standard_parameter"><a class="anchor" href="#_standard_parameter"></a>5.2.2.2. Standard-Parameter</h5>
<div class="paragraph">
<p>Vom Batchrahmen werden folgende Kommandozeilen-Parameter interpretiert:</p>
</div>
<table id="table-CLIBATCanv" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 3. Kommandozeilen-Parameter des Batchrahmens</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-cfg &lt;Dateiname&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name einer Property-Datei mit KonfigurationseintrÃ¤gen.
Der Dateiname wird relativ zum Klassenpfad interpretiert.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-start</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Starten des Batches und Verarbeitung der Daten ab dem ersten Datensatz.<br>
Batches im Status â€žbeendetâ€œ <em>mÃ¼ssen</em> Ã¼ber â€ž-startâ€œ gestartet werden.<br>
Die gleichzeitige Eingabe von â€ž-startâ€œ und â€ž-restartâ€œ fÃ¼hrt zum Abbruch des Batches.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-restart</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Starten des Batches nach einem Fehler-Abbruch: Ãœberlesen der bereits verarbeiteten DatensÃ¤tze.<br>
Batches im Status â€žAbbruchâ€œ mÃ¼ssen mit â€ž-restartâ€œ gestartet werden oder zusÃ¤tzlich den Parameter -ignoriereRestart enthalten.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ignoriereRestart</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auch bei Fehlern Start akzeptieren, nicht auf Restart beharren.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ignoriereLauf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auch bei Status "laeuft" Start akzeptieren.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-testmodus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Startet den Batch im Testmodus.
Dieser arbeitet analog zum normalen Wirkbetrieb, jedoch werden keine Ã„nderungen an DatenbestÃ¤nden vom Anwendungssystem oder Nachbarsystemen durchgefÃ¼hrt.
Ein detailliertes Konzept ist in Kapitel <a href="#testmodus">Testmodus</a> beschrieben.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-laufzeit &lt;Minuten&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gibt eine maximale Laufzeit in Minuten an.
Wird die angegebene Zeit Ã¼berschritten, wird der aktuelle Datensatz zu Ende bearbeitet.
Der Batch bricht vor der Verarbeitung des nÃ¤chsten Datensatzes mit einem dedizierten Return-Code ab.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_weitere_parameter"><a class="anchor" href="#_weitere_parameter"></a>5.2.2.3. Weitere Parameter</h5>
<div class="paragraph">
<p>Es kÃ¶nnen auch andere Parameter angegeben werden, die der Namenskonvention genÃ¼gen</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_konfigurationsdateien"><a class="anchor" href="#_konfigurationsdateien"></a>5.2.3. Konfigurationsdatei(en)</h4>
<div class="paragraph">
<p>Konfigurationsdateien sind syntaktisch property-Dateien.
Die Konfigurationsdatei mit den unten aufgelisteten Parametern wird als statische Konfiguration im Verzeichnis`resources` abgelegt und
kann daher nicht vom Betrieb angepasst werden.</p>
</div>
<div class="paragraph">
<p>Betriebliche Konfigurationen mÃ¼ssen wie in Kapitel <a href="#betriebliche-konfiguration-der-ausfuehrungsbean">Betriebliche Konfiguration der AusfÃ¼hrungsbean</a> beschriebenen
umgesetzt werden.</p>
</div>
<div class="sect4">
<h5 id="_namenskonvention_2"><a class="anchor" href="#_namenskonvention_2"></a>5.2.3.1. Namenskonvention</h5>
<table id="table-batch-property-files" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 4. Batches: Benennung Konfigurationsdateien</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Batches: Benennung Konfigurationsdateien (unter resources/resources/batch)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Schemata</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;batchname-des-batches&gt;.properties</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Beispiele</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>loeschfrist-pruefen.properties<br>
import-bhknz-liste.properties</code></p></td>
</tr>
</tbody>
</table>
<table id="table-batckonfig-konfigurationsparameter-konfigurationsdatei" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 5. Batches: Konfigurationsparameter Konfigurationsdatei</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Batches: Konfigurationsparameter Konfigurationsdatei</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Schema</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;Parametername&gt;=&lt;Parameterwert&gt;<br>
&lt;Parametername&gt;.&lt;Parametername&gt;=&lt;Parameterwert&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Beispiele</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatchName=LoeschBatch<br>
Loeschfunktion.DatumVon=30.11.2019</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_standard_konfigurationsparameter"><a class="anchor" href="#_standard_konfigurationsparameter"></a>5.2.3.2. Standard-Konfigurationsparameter</h5>
<div class="paragraph">
<p>Die nachfolgenden Parameter sind in der Batchkomponente als Standard definiert und werden der
Konfiguration in der Property-Datei hinzugefÃ¼gt.</p>
</div>
<div class="paragraph">
<p>Aus der Property-Datei werden durch den Batchrahmen folgende Properties gelesen:</p>
</div>
<table id="table-PropBATCanv" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 6. Die Properties des Batchrahmens</caption>
<colgroup>
<col style="width: 55.5555%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batchrahmen.BeanName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name der Batchrahmen-Bean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Anwendung.SpringDateien.&lt;N&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vollqualifizierte Namen der Spring-Konfigurationsklassen der GeschÃ¤ftsanwendung</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batchrahmen.SpringDateien.&lt;N&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vollqualifizierte Namen der Spring-Konfigurationsklassen des Batchrahmens</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batchrahmen.CommitIntervall</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anzahl Satz-Verarbeitungen pro Commit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batchrahmen.ClearIntervall</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anzahl Satz-Verarbeitungen bis zum LÃ¶schen des Hibernate session cache. Dies dient PerfomancegrÃ¼nden und der Vermeidung von out of memory Fehlern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AusfuehrungsBean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name der AusfÃ¼hrungsbean fÃ¼r die Batchlogik</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatchId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID des Batches (ID des Batch-Status-Datensatzes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatchName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name des Batches in der Batch-Statustabelle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batchrahmen.AnzahlZuVerarbeitendeDatensaetze</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Falls nicht die ganze Datei verarbeitet werden soll, sondern nur eine gewisse Anzahl an DatensÃ¤tzen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batchrahmen.Ergebnisdatei</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pfad zur XML-Ergebnisdatei des Batchrahmens (siehe Kapitel <a href="#rueckgabewerte-des-batchrahmens">RÃ¼ckgabewerte des Batchrahmens</a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_weitere_parameter_2"><a class="anchor" href="#_weitere_parameter_2"></a>5.2.3.3. Weitere Parameter</h5>
<div class="paragraph">
<p>Die Property-Datei darf beliebige weitere Properties enthalten, die der Namenskonvention genÃ¼gen.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="betriebliche-konfiguration-der-ausfuehrungsbean"><a class="anchor" href="#betriebliche-konfiguration-der-ausfuehrungsbean"></a>5.2.4. Betriebliche Konfiguration der AusfÃ¼hrungsbean</h4>
<div class="paragraph">
<p>SÃ¤mtliche obigen Parameter mÃ¼ssen vom Betrieb nicht angepasst werden.
Falls im Ausnahmefall die Batch-ID angepasst werden muss, kann dies Ã¼ber den Kommandozeilen-Parameter â€“BatchId &lt;BatchId&gt; geschehen.</p>
</div>
<div class="paragraph">
<p>Falls fÃ¼r die AusfÃ¼hrungsbean eines Batches Konfigurationen notwendig sind, welche durch den Betrieb gepflegt werden mÃ¼ssen, so ist dies auf eine von zwei Arten umzusetzen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Die Konfigurationen kÃ¶nnen der betrieblichen Konfiguration der GeschÃ¤ftsanwendung hinzugefÃ¼gt werden.<br></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Konfiguration der GeschÃ¤ftsanwendung: Die im Ordner <code>config</code> liegenden, durch den Betrieb pflegbaren Konfigurationsdateien.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Die AusfÃ¼hrungsbean kann dann die GeschÃ¤ftsanwendungs-Konfigurationsbean per Dependency Injection erhalten und sich darÃ¼ber konfigurieren.</p>
</div>
<div class="paragraph">
<p>Diese MÃ¶glichkeit ist zu verwenden, falls nur ein Batch fÃ¼r die GeschÃ¤ftsanwendung umgesetzt wird.
Falls mehrere Batches umgesetzt werden, ist sie dann zu verwenden, wenn sich die Konfigurationen fÃ¼r die einzelnen Batches nicht widersprechen (also fÃ¼r verschiedene Batches verschiedene Werte fÃ¼r die gleiche Property erwartet werden).</p>
</div>
</li>
<li>
<p>Die Konfiguration kann in einer neuen Datei abgelegt werden, welche nur fÃ¼r diesen Batch verwendet wird.
Diese Datei kann als Properties-Bean geladen und der AusfÃ¼hrer-Bean per Dependency Injection Ã¼bergeben werden.<br></p>
<div class="paragraph">
<p>Diese MÃ¶glichkeit ist zu verwenden, falls fÃ¼r verschiedene Batches verschiedene Konfigurationsdateien benÃ¶tigt werden.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="die-konfiguration-der-spring-kontexte"><a class="anchor" href="#die-konfiguration-der-spring-kontexte"></a>5.2.5. Die Konfiguration der Spring-Kontexte</h4>
<div class="paragraph">
<p>Wie in Kapitel <a href="#grobe-architektur-des-batchrahmens">Grobe Architektur des Batchrahmens</a> beschrieben, werden fÃ¼r einen Batch zwei Spring-Kontexte erzeugt:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ein Kontext mit den Beans der eigentlichen GeschÃ¤ftsanwendung.</p>
</li>
<li>
<p>Ein Kontext mit der Batchrahmen-Bean, der Batchrahmen JMX-Bean sowie den AusfÃ¼hrungsbeans fÃ¼r die Batches der GeschÃ¤ftsanwendung.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FÃ¼r den Kontext der eigentlichen GeschÃ¤ftsanwendung kÃ¶nnen die Spring-Konfigurationsdateien Ã¼bernommen werden.
In ihnen mÃ¼ssen folgende Anpassungen vorgenommen werden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Beans, die fÃ¼r die Batch-Verarbeitung nicht benÃ¶tigt werden, sollten entfernt werden (Service-Beans, GUI-Beans).</p>
</li>
<li>
<p>Damit die Entity-Klassen des Batchrahmens gefunden werden kÃ¶nnen, muss in der Spring-Konfiguration der Batches ein Entity-Scan hinzugefÃ¼gt werden:</p>
<div class="literalblock">
<div class="content">
<pre>@EntityScan("de.bund.bva.isyfact.batchrahmen.persistence.rahmen")</pre>
</div>
</div>
</li>
<li>
<p>Das Nachrichten-Resource-Bundle fÃ¼r den Batch muss der <code>messageSource</code>-Bean hinzugefÃ¼gt werden.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Um Beans gezielt aus der Spring-Konfiguration der Anwendung fÃ¼r die AusfÃ¼hrung eines Batches auszuschlieÃŸen, kann die
Annotation <code>@ExludeFromBatchContext</code> verwendet werden.
Damit werden mit <code>@Component</code> annotierte Klassen oder <code>@Bean</code>-Methoden in <code>@Configuration</code>-Klassen annotiert (<a href="#listing-excludefrombatchcontext">Listing 1</a>).</p>
</div>
<div id="listing-excludefrombatchcontext" class="listingblock">
<div class="title">Listing 1. Verwendung der Annotation @ExcludeFromBatchContext</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
@ExcludeFromBatchContext
public class BeispielServiceExceptionFassade { ...


@Configuration
public class ServiceConfig {
    @Bean
    @ExcludeFromBatchContext
    public BeispielServiceExceptionFassade() { ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Die Spring-Konfiguration fÃ¼r den Kontext des Batchrahmens muss neu erstellt werden.
HierfÃ¼r werden gesonderte <code>@Configuration</code>-Klassen erstellt.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="die-tabellen-des-batchrahmens"><a class="anchor" href="#die-tabellen-des-batchrahmens"></a>6. Die Tabellen des Batchrahmens</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Der Batchrahmen benÃ¶tigt fÃ¼r seine Checkpoint / Restart FunktionalitÃ¤t die MÃ¶glichkeit, bei jedem Commit den aktuellen Stand des Batches in einer Tabelle zu speichern.
Dies wird Ã¼ber die Tabelle BatchStatus umgesetzt.</p>
</div>
<div id="image-SchemTabBatStat" class="imageblock text-center">
<div class="content">
<img src="../_images/detailkonzept-batch/SchemTabBatStat.png" alt="SchemTabBatStat">
</div>
<div class="title">Abbildung 5. Tabellen-Schema fÃ¼r die Batchrahmen-Tabelle</div>
</div>
<div class="paragraph">
<p>Die Tabelle BatchStatus enthÃ¤lt fÃ¼r jeden Batch eine Zeile.
Ein Batch ist nicht gleichzusetzen mit der Batch-AusfÃ¼hrungsbean.
FÃ¼r eine Bean darf es mehrere Batches geben, welche die Bean fÃ¼r die AusfÃ¼hrung jeweils anders konfigurieren.
FÃ¼r einen Batch werden folgende Informationen verwendet:</p>
</div>
<table id="table-SchemTabBatStat2" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 7. Das Schema der Tabelle BatchStatus</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spalte</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatchId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der SchlÃ¼ssel fÃ¼r den Batch.
Die ID sollte aus einem gemeinsamen PrÃ¤fix fÃ¼r die GeschÃ¤ftsanwendung, gefolgt von einem Suffix fÃ¼r den konkreten Batch, bestehen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatchName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ein kurzer informativer Name des Batches.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatchStatus</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Einer der folgenden Werte:<br>
<strong>laeuft</strong>: Der Batch wurde gestartet und lÃ¤uft aktuell.<br>
<strong>abgebrochen</strong>: Der Batch ist abgebrochen und sollte per <code>RESTART</code> neu gestartet werden.<br>
<strong>beendet</strong>: Der Batch ist erfolgreich beendet worden.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SatznummerLetztesCommit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Anzahl an SÃ¤tzen, welche beim letzten Commit verarbeitet worden sind.
Dies wird fÃ¼r die Umsetzung der Restart-FunktionalitÃ¤t verwendet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SchluesselLetztesCommit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Der Datenbank-SchlÃ¼ssel des Datensatzes, der als letztes vor dem Commit bearbeitet wurde.
Dies wird fÃ¼r die Umsetzung der Restart-FunktionalitÃ¤t verwendet.
Falls der SchlÃ¼ssel ein zusammengesetzter SchlÃ¼ssel ist, mÃ¼ssen sÃ¤mtliche SchlÃ¼sselteile (durch Trennzeichen getrennt) in dieses Feld geschrieben werden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DatumLetzterStart</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Datum des Starts des aktuellen Batch-Laufs (falls der Status â€žlaeuftâ€œ ist) bzw.
des letzten Laufes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DatumLetzterAbbruch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Datum des letzten fehlerhaften Abbruchs des Batches.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DatumLetzterErfolg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Datum des letzten erfolgreichen Abschlusses des Batches.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Die Tabelle liegt im Datenbank-Schema der eigenen GeschÃ¤ftsanwendung.
Es darf keine Ã¼bergreifenden Tabellen oder ein Ã¼bergreifendes Datenbankschema fÃ¼r alle Batches gemÃ¤ÃŸ IsyFact-Architektur geben.</p>
</div>
<div class="sect2">
<h3 id="verwaltung-der-tabelle"><a class="anchor" href="#verwaltung-der-tabelle"></a>6.1. Verwaltung der Tabelle</h3>
<div class="paragraph">
<p>Die Tabelle dient nicht der Steuerung des Batches Ã¼ber den Betrieb, sondern nur der Ablage von Informationen zwischen zwei Batch-LÃ¤ufen.
Die BefÃ¼llung der Tabelle wird deshalb komplett Ã¼ber den Batchrahmen durchgefÃ¼hrt: Es mÃ¼ssen keine DatensÃ¤tze manuell befÃ¼llt werden: Ist ein Datensatz fÃ¼r einen Batch noch nicht vorhanden, wird er angelegt.</p>
</div>
<div class="paragraph">
<p>Ãœblicherweise ist das Locking-Verhalten in GeschÃ¤ftsanwendungen optimistisch: DatensÃ¤tze werden nicht explizit gelockt.
Stattdessen wird Ã¼ber Versions-Attribute zum Commit-Zeitpunkt geprÃ¼ft, ob der Datensatz innerhalb der Transaktion verÃ¤ndert wurde.
FÃ¼r die Tabelle des Batchrahmens wird <em>nicht</em> optimistisch, sondern pessimistisch gelockt.
ZusÃ¤tzlich wird als Hibernate Locking-Strategie <code>LOCK_NOWAIT</code> verwendet: Falls auf einen Datensatz zugegriffen wird, welcher gerade gelockt ist, wird nicht bis zur Freigabe gewartet, sondern eine Exception geworfen.
Die parallele AusfÃ¼hrung zweier Batches mit gleicher Batch-ID ist nicht erlaubt und soll zum Fehler fÃ¼hren.</p>
</div>
</div>
<div class="sect2">
<h3 id="die-transaktionssteuerung"><a class="anchor" href="#die-transaktionssteuerung"></a>6.2. Die Transaktionssteuerung</h3>
<div class="paragraph">
<p>In der Property-Datei des Batchrahmens wird die Commit-Rate fÃ¼r den Batch Ã¼ber eine Property konfiguriert.
Die Transaktionssteuerung fÃ¼r einen Batch arbeitet daraufhin folgendermaÃŸen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Die Klasse <code>BatchLauncher</code> liest die Kommandozeile ein, interpretiert die Parameter und erzeugt alle notwendigen Spring-Kontexte.
Dies geschieht auÃŸerhalb einer Transaktion.
Danach gibt die Klasse die Kontrolle an die Batchrahmen-Bean weiter.</p>
</li>
<li>
<p>Die Batchrahmen-Bean startet eine erste Transaktion.
Sie aktualisiert die Batchrahmen-Tabellen und initialisiert die AusfÃ¼hrungsbean in dieser Transaktion.
Die AusfÃ¼hrungsbean fÃ¼hrt im Rahmen dieser Transaktion das â€žVorlesenâ€œ bis zum letzten Checkpoint sowie ggf. nÃ¶tige Initialisierungen durch.
Die Transaktion wird beendet.
Danach beginnt die Satz-Verarbeitung.</p>
</li>
<li>
<p>FÃ¼r die Satz-Verarbeitung wird eine neue Transaktion gestartet.
Die einzelnen DatensÃ¤tze werden verarbeitet.
Bei Erreichung eines Checkpoints wird die Status-Tabelle aktualisiert, die Transaktion abgeschlossen (Commit) und eine neue gestartet.</p>
</li>
<li>
<p>Sobald der letzte Datensatz verarbeitet wurde, wird in einer letzten Transaktion die Status-Tabelle aktualisiert, auf der AusfÃ¼hrungsbean eine Shutdown-Methode aufgerufen und die Transaktion abgeschlossen.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Das Verhalten in FehlerfÃ¤llen ist zu jedem Zeitpunkt wÃ¤hrend der Verarbeitung gleich: Der Fehler wird geloggt und die Transaktion zurÃ¼ckgerollt.
Danach wird versucht, eine neue Transaktion zu starten, um die Status-Tabelle zu aktualisieren: Der Status wird auf <code>abgebrochen</code> gesetzt und die Spalte <code>DatumLetzterAbbruch</code> auf den aktuellen Zeitpunkt.
Daraufhin wird versucht, diese Transaktion abzuschlieÃŸen.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warnung"></i>
</td>
<td class="content">
SchlÃ¤gt diese Transaktion fehl, kann der Batchrahmen den Abbruch nicht persistent speichern.
Der nÃ¤chste Lauf muss dann mit dem Parameter <code>-ignoriereLauf</code> gestartet werden.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="die-restart-funktionalitaet"><a class="anchor" href="#die-restart-funktionalitaet"></a>6.3. Die Restart FunktionalitÃ¤t</h3>
<div class="paragraph">
<p>Falls ein Batch durch einen Fehler oder durch das Erreichen der Anzahl zu verarbeitender DatensÃ¤tze abgebrochen ist, muss ein Restart fÃ¼r ihn durchgefÃ¼hrt werden.
In diesem Fall mÃ¼ssen alle bereits verarbeiteten DatensÃ¤tze Ã¼bersprungen werden.
Ebenso wird die WiederanlauffÃ¤higkeit nach manuellem Terminieren durch das Signal <code>kill -15</code> sichergestellt.</p>
</div>
<div class="sect3">
<h4 id="die-konfiguration-im-restart-fall"><a class="anchor" href="#die-konfiguration-im-restart-fall"></a>6.3.1. Die Konfiguration im Restart-Fall</h4>
<div class="paragraph">
<p>Im Restart-Fall wird nicht Ã¼berprÃ¼ft, dass die Ã¼bergebenen Parameter denen entsprechen, die im ursprÃ¼nglichen Lauf Ã¼bergeben wurden.
Es muss daher bei einem Restart manuell darauf geachtet werden, dass die gleichen Parameter Ã¼bergeben werden.</p>
</div>
</div>
<div class="sect3">
<h4 id="beenden-eines-laufs-mit-kill--15-und-wiederanlauf"><a class="anchor" href="#beenden-eines-laufs-mit-kill--15-und-wiederanlauf"></a>6.3.2. Beenden eines Laufs mit <code>kill -15</code> und Wiederanlauf</h4>
<div class="paragraph">
<p>Durch Senden des Signals <code>kill -15</code> kann ein aktiver Batchlauf beendet werden.
Beim Empfang des Signals wird der aktuelle Datensatz zu Ende bearbeitet und der Batch terminiert im wohldefinierten Zustand.
In der Statustabelle ist dann der Status â€žabgebrochenâ€œ vermerkt und der Batchlauf kann mit dem Parameter â€ž-restartâ€œ wieder aufgesetzt werden.</p>
</div>
</div>
<div class="sect3">
<h4 id="wiederanlauf-nach-abbruch-durch-die-ueberschreitung-der-maximalen-laufzeit"><a class="anchor" href="#wiederanlauf-nach-abbruch-durch-die-ueberschreitung-der-maximalen-laufzeit"></a>6.3.3. Wiederanlauf nach Abbruch durch die Ãœberschreitung der maximalen Laufzeit</h4>
<div class="paragraph">
<p>Falls der Batch mit dem â€žlaufzeitâ€œ-Parameter gestartet wurde, wird nach Ãœberschreitung der angegebenen maximalen Laufzeit der aktuelle Datensatz zu Ende bearbeitet und der Batch terminiert im wohldefinierten Zustand.
In der Statustabelle ist dann der Status â€žabgebrochenâ€œ vermerkt und der Batchlauf kann mit dem Parameter â€ž-restartâ€œ wieder aufgesetzt werden.</p>
</div>
</div>
<div class="sect3">
<h4 id="wiederanlauf-nach-abbruch-durch-kill--9"><a class="anchor" href="#wiederanlauf-nach-abbruch-durch-kill--9"></a>6.3.4. Wiederanlauf nach Abbruch durch <code>kill -9</code></h4>
<div class="paragraph">
<p>Durch Senden des Signals <code>kill -9</code> wird der aktive Batchprozess von Betriebssystemseite beendet.
Dabei wird der Java-Prozess direkt entfernt ohne die MÃ¶glichkeit, den Batchrahmen definiert zu terminieren.
Dies ist daher nur in Ausnahmesituationen vom Betrieb durchzufÃ¼hren.
Da der Batchrahmen in dieser Situation kein Status-Update mehr schreiben kann, befindet sich der Eintrag â€žlÃ¤uftâ€œ in der Statustabelle.
Ein Wiederanlauf in dieser Situation ist mit dem Parameter â€ž-restartâ€œ mÃ¶glich.</p>
</div>
</div>
<div class="sect3">
<h4 id="das-vorlesen-durch-die-ausfuehrungsbean"><a class="anchor" href="#das-vorlesen-durch-die-ausfuehrungsbean"></a>6.3.5. Das Vorlesen durch die AusfÃ¼hrungsbean</h4>
<div class="paragraph">
<p>Um den Batch nach einem Fehler zum nÃ¤chsten zu bearbeiteten Datensatz â€žvorlesenâ€œ zu lassen, muss dieser Datensatz identifiziert werden.
Dies geschieht zum einen durch den Batchrahmen selbst, welcher die Anzahl der bereits verarbeiteten DatensÃ¤tze speichert.
Bei auf Datenbank-Queries basierenden Batches kann diese Anzahl jedoch ggf.
nicht verwendet werden, da sie sich im Laufe der Zeit Ã¤ndert.
Hier ist es notwendig, die zu verarbeitenden SÃ¤tze nach ihrem SchlÃ¼ssel zu sortieren und den als letztes bearbeiteten SchlÃ¼ssel zu speichern.</p>
</div>
<div class="paragraph">
<p>Die Batchrahmen Status-Tabelle enthÃ¤lt deshalb zwei Felder: Ein Feld fÃ¼r die Anzahl verarbeiteter SÃ¤tze und ein Feld fÃ¼r den SchlÃ¼ssel des letzten verarbeiteten Datensatzes.
Dieser SchlÃ¼ssel wird von der AusfÃ¼hrungsbean nach der Verarbeitung eines Satzes zurÃ¼ckgegeben.</p>
</div>
<div class="paragraph">
<p>Bei einem Restart wird der AusfÃ¼hrungsbean in der Initialisierungsmethode Ã¼bermittelt, ob es sich um einen Restart handelt und welche Werte fÃ¼r den SchlÃ¼ssel und die Satznummer in der Datenbank stehen.
Der Bean ist es Ã¼berlassen, das Vorlesen effizient durchzufÃ¼hren (etwa durch die Aufnahme des SchlÃ¼ssels in das Selektionskriterium einer Query).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="die-ueberwachungs-funktionalitaet"><a class="anchor" href="#die-ueberwachungs-funktionalitaet"></a>6.4. Die Ãœberwachungs-FunktionalitÃ¤t</h3>
<div class="paragraph">
<p>Die Verarbeitung eines Batches soll Ã¼berwacht und nachverfolgt werden kÃ¶nnen.
FÃ¼r die Nachverfolgung kÃ¶nnen durch die Verarbeitungsbean zu verschiedenen Zeitpunkten Log-, Statistik- oder Protokoll-EintrÃ¤ge erstellt werden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zu Beginn des Batches, wÃ¤hrend der Initialisierung der AusfÃ¼hrungsbean.</p>
</li>
<li>
<p>Nach dem Schreiben jedes Checkpoints.</p>
</li>
<li>
<p>Bei der erfolgreichen Beendigung des Batches.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jeder Log-Eintrag eines Batches, insbesondere die Aufrufe der Fachkomponenten, enthÃ¤lt pro Satz eine eindeutige Korrelations-ID. Damit kÃ¶nnen Log-EintrÃ¤ge nicht nur einem Batchlauf, sondern den einzelnen SÃ¤tzen eindeutig zugeordnet werden.</p>
</div>
<div class="paragraph">
<p>FÃ¼r die Ãœberwachung wird durch den Batchrahmen eine JMX-Bean bereitgestellt. Ãœber folgende Konfiguration wird ein JMX Agent erzeugt, welcher die Bean nach auÃŸen zugreifbar macht:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  -Dcom.sun.management.jmxremote
  -Dcom.sun.management.jmxremote.port=&lt;PortNummer&gt;
  -Dcom.sun.management.jmxremote.ssl=false
  -Dcom.sun.management.jmxremote.authenticate=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ãœber die Java Management Console kann man danach auf die Daten zugreifen:</p>
</div>
<div id="image-JMXOverBat" class="imageblock text-center">
<div class="content">
<img src="../_images/detailkonzept-batch/JMXOverBat.png" alt="JMXOverBat">
</div>
<div class="title">Abbildung 6. Die JMX Ãœberwachung eines Batches</div>
</div>
<div class="paragraph">
<p>Bereitgestellt werden folgende Informationen:</p>
</div>
<table id="table-JMXAttr" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 8. JMX-Attribute</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SaetzeGesamt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Gesamtanzahl der zu bearbeitenden SÃ¤tze. Falls diese nicht bekannt ist: -1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SaetzeVerarbeitet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Anzahl bereits verarbeiteter SÃ¤tze.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SchluesselLetzterSatz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SchlÃ¼ssel des letzten verarbeiteten Satzes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ZeitSeitLetztemSatz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zeitraum in Millisekunden, der bereits fÃ¼r den aktuellen Satz benÃ¶tigt wurde.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatchId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die ID des aktuellen Batches</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatchName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name des aktuellen Batches.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Zur ErhÃ¶hung der Sicherheit in der Betriebsumgebung muss eine Absicherung der RMI-Schnittstelle fÃ¼r JMX per Benutzername und Passwort erfolgen (siehe JVM-Parameter oben). Hierzu sind die JMX-Benutzer und PasswÃ¶rter entweder direkt in der Datei</p>
</div>
<table class="tableblock frame-none grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JRE_HOME/lib/management/jmxremote.password</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>zu konfigurieren, oder der Ort dieser Datei ist Ã¼ber den JVM-Parameter</p>
</div>
<table class="tableblock frame-none grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>com.sun.management.jmxremote.password.file</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>anzugeben.
Die Datei benÃ¶tigt einen Eintrag fÃ¼r die Rolle controlRole oder fÃ¼r eine beliebige Rolle, fÃ¼r welche in
Datei <code>JRE_HOME/lib/management/jmxremote.access</code> readwrite-Zugriff erlaubt ist.</p>
</div>
</div>
<div class="sect2">
<h3 id="authentifizierung-und-autorisierung"><a class="anchor" href="#authentifizierung-und-autorisierung"></a>6.5. Authentifizierung und Autorisierung</h3>
<div class="paragraph">
<p>Ein Batch wird innerhalb der Plattform gestartet.
Dazu verwendet der Batch die Benutzerkennung eines technischen Benutzers â€žinternes Systemâ€œ, die in seiner Startkonfiguration (als Konfigurationsdatei) hinterlegt und im Benutzerverzeichnis vorhanden ist.</p>
</div>
<div class="paragraph">
<p>Der Batchrahmen nutzt die T-Komponente Sicherheit (siehe <a href="../../isy-sicherheit/nutzungsvorgaben/master.html#einleitung" class="xref page">Nutzungsvorgaben Sicherheit</a>), um den anfragenden Benutzer Ã¼ber den IAM-Service der Plattform zu authentifizieren.
Das IAM-Service authentifiziert den Benutzer anhand der angegebenen Benutzerkennung und des Passwortes, registriert alle Informationen zum Benutzer in der T-Komponente AufrufKontextVerwalter und schlieÃŸt die Session des Benutzers im IAM-System.</p>
</div>
<div class="paragraph">
<p>Im Zuge des Batchlaufs kÃ¶nnen nun Ã¼ber die T-Komponente Sicherheit BerechtigungsprÃ¼fungen (z.B. im Anwendungskern) stattfinden.</p>
</div>
<div class="paragraph">
<p>Der Batchrahmen fordert vom BatchAusfÃ¼hrungsBean die Implementierung der Methode: getAuthenticationCredentials(), in der dem Batchrahmen bekannt gegeben wird, mit welchem Benutzer der Batch laufen soll.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">@Override
public BatchAuthenticationCredentials getAuthenticationCredentials(
                  BatchKonfiguration konfiguration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Folgende Informationen zum Benutzer sind anzugeben</p>
</div>
<table id="table-CharBatUse" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 9. Die Eigenschaften des Batchbenutzers</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bhknz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das BehÃ¶rden- oder Organisationskennzeichen, der BehÃ¶rde oder Organisation, der der Benutzer angehÃ¶rt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Benutzer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Kennung des technischen Benutzers (internes System)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Passwort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Das Kennwort des Benutzers</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In der Regel wird der Benutzer aus der betrieblichen Konfiguration der Anwendung oder alternativ aus den Aufrufparametern beim Batchstart gelesen.</p>
</div>
<div class="paragraph">
<p>In AusnahmefÃ¤llen ist es auch mÃ¶glich, einen Batch zu implementieren, der ohne Benutzer laufen soll.
Dies ist nur mÃ¶glich, wenn bei Aufrufen des Anwendungskerns keine AutorisierungsprÃ¼fungen stattfinden und auch keine Nachbarsystemschnittstellen aufgerufen werden.
Soll der Batch ohne Benutzer laufen, so ist in der Methode <code>null</code> zurÃ¼ckzugeben.</p>
</div>
<div class="paragraph">
<p>EnthÃ¤lt eine Anwendung mehrere Batches, so enthÃ¤lt sie auch mehrere BatchAusfÃ¼hrungsBeans und kann jeden Batch mit einem
eigenen Benutzer ausstatten.</p>
</div>
</div>
<div class="sect2">
<h3 id="das-deployment-eines-batches"><a class="anchor" href="#das-deployment-eines-batches"></a>6.6. Das Deployment eines Batches</h3>
<div class="paragraph">
<p>Die Batches werden nicht einzeln deployed.
Stattdessen wird ein Paket angeboten, welches sÃ¤mtliche Batches der GeschÃ¤ftsanwendung enthÃ¤lt.</p>
</div>
<div class="paragraph">
<p>Das erstellte Paket enthÃ¤lt den Code des Batchrahmens sowie den Code der eigentlichen GeschÃ¤ftsanwendung inklusive der Batch-AusfÃ¼hrungsklassen und der benÃ¶tigten nicht-betrieblichen Batch-Konfigurationsdateien.
FÃ¼r jeden Batch wird ein Shellskript zum Start bereitgestellt.</p>
</div>
<div class="paragraph">
<p>FÃ¼r die Shellskripte existieren keine Vorgaben.
Falls vor der AusfÃ¼hrung des Batches Vorbedingungen gelten mÃ¼ssen (etwa Dateien in Verzeichnissen vorliegen sollen), so kÃ¶nnen sie in diesen Skripten geprÃ¼ft werden.
Beispiele fÃ¼r Aufruf-Skripte von Batches befinden sich in der Bibliothek <code>isy-batchrahmen</code>, im Verzeichnis <code>src/main/skripte/bin</code></p>
</div>
<div class="paragraph">
<p>Eine sinnvolle Aufteilung bei den Shellskripten ist es, ein technisches Startskript zu erstellen, was von den eigentlichen Batch-Shellskripten zum Aufruf genutzt wird.
Beispiel fÃ¼r ein solches Startskript befinden sich in der Bibliothek <code>isy-batchrahmen</code>, in der Datei <code>src/main/skripte/bin/batch-ausfuehren.sh</code></p>
</div>
<div class="paragraph">
<p>Dieses Startskript soll in der Batch-Anwendung unter <code>&lt;batch-projekt&gt;/src/main/resources/bin</code> Ã¼bernommen und mit der richtigen Java-Version versehen werden.</p>
</div>
<div class="paragraph">
<p>Ein beispielhaftes Shellskript zum Aufruf eines Batches kann dieses Skript dann nutzen und folgendermaÃŸen aussehen:</p>
</div>
<div id="listing-BSPStartBAT" class="listingblock">
<div class="title">Listing 2. Beispielhaftes Startskript fÃ¼r einen Batch</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash
#
# Parameter fÃ¼r den Erinnerung-Batch
#
# -Testmodus &lt;true|false&gt; Flag ob nur simuliert wird oder nicht (optionaler Parameter)
#

BATCHDIR=`dirname $0`
$BATCHDIR/batch-ausfuehren.sh -start -cfg /resources/batch/batch-erinnerung-config.properties -Batchrahmen.Ergebnisdatei /tmp/erinnerung_out.xml $1 $2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bei der betrieblichen Konfiguration wird nicht zwischen dem Deployment als Web-Anwendung und dem Deployment als Batch unterschieden: Es werden jeweils dieselben betrieblichen Konfigurationsdateien verwendet.
Damit der Betrieb Anpassungen dieser Dateien nicht zweimal durchfÃ¼hren muss, wird die betriebliche Konfiguration mit der Web-Anwendung deployed.
Vor dem Deployment des Batch-Pakets muss die Webanwendung deployed sein.
Falls der Batch nicht auf dem Server der Webanwendung lÃ¤uft, muss die Konfigurationsdatei der Webanwendung vor der Installation des Batches auch auf diesem Server verfÃ¼gbar gemacht (z.B. gemountet oder kopiert) werden.
Beim Deployment des Batch-Pakets werden Ã¼ber symbolische Links diese betriebliche Konfigurationsdatei referenziert.</p>
</div>
</div>
<div class="sect2">
<h3 id="rueckgabewerte-des-batchrahmens"><a class="anchor" href="#rueckgabewerte-des-batchrahmens"></a>6.7. RÃ¼ckgabewerte des Batchrahmens</h3>
<div class="paragraph">
<p>Der Batchrahmen endet mit einem Returncode und erzeugt optional zusÃ¤tzlich noch ein ausfÃ¼hrliches Verarbeitungsergebnis in Form einer Ergebnisdatei im XML-Format.
Die Ergebnisdatei ist eine <strong>fachliche Datei</strong>, sie enthÃ¤lt keine betrieblichen Informationen.
Alle betrieblichen Informationen Ã¼ber AusfÃ¼hrung des Batches werden in die Logdatei geschrieben, so dass der Betrieb nur diese Datei betrachten muss.
Es gibt keine weiteren betriebsrelevanten Dateien neben der Logdatei.</p>
</div>
<div class="paragraph">
<p>Der Pfad der Ergebnisdatei wird Ã¼ber einen Konfigurationsparameter des Batches festgelegt (siehe
Kapitel <a href="#konfigurationsdatei-und-kommandozeilen-parameter">Konfigurationsdatei und Kommandozeilen-Parameter</a>). Ist dieser Parameter nicht vorhanden, so wird auch keine Ergebnisdatei geschrieben.
Die Ergebnisdatei hat den folgenden Aufbau:</p>
</div>
<table id="table-FormAusDat" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 10. Format der Ergebnisdatei</caption>
<colgroup>
<col style="width: 30.7692%;">
<col style="width: 15.3846%;">
<col style="width: 7.6923%;">
<col style="width: 46.1539%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">XML-Pfad</th>
<th class="tableblock halign-left valign-top">Attribut</th>
<th class="tableblock halign-left valign-top">Typ</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root-Tag des Batch-Ergebnisses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Datum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datum des Starts des Batchlaufs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Uhrzeit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uhrzeit des Starts des Batchlaufs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatchID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Batch-ID des Batchlaufs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Parameter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Die Parameter des Batchlaufs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Meldungen</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Liste von Meldungen (Fehler, Warnungen oder Informationen)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Meldungen / Meldung</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID des Eintrags (z.B. Fehlernummer)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Meldungen / Meldung</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Typ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Typ des Eintrags: F, W, I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Meldungen / Meldung</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text des Eintrags, z.B. Fehlertext</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Meldungen / Meldung</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Satz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Der fachliche SchlÃ¼ssel des Hauptsatzes, dessen Verarbeitung diese Meldung verursacht hat.
Es ist zu beachten, dass ein technischer SchlÃ¼ssel an dieser Stelle nicht ausreichend ist, da der Fachbereich und der Betrieb
mit diesem technischen SchlÃ¼ssel nichts anfangen kÃ¶nnen.</p>
</div>
<div class="paragraph">
<p>Falls es nicht mÃ¶glich ist den fachlichen SchlÃ¼ssel des Hauptsatzes an dieser Stelle zu ermitteln bzw.
wenn dies nur auf Kosten der Laufzeit mÃ¶glich ist, dann ist mit dem Fachbereich und dem Betrieb frÃ¼hzeitig zu klÃ¤ren,
ob an dieser Stelle ein anderer SchlÃ¼ssel ausgegeben werden kann.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Statistik</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Liste von statistischen Daten die wÃ¤hrend des Batchlaufs ermittelt wurden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Statistik / Statistik-Eintrag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID des Statistik-Eintrags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Statistik / Statistik-Eintrag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Klartext des Eintrags, z.Â B. â€žAnzahl gelÃ¶schter DatensÃ¤tzeâ€œ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Statistik / Statistik-Eintrag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Wert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Statistischer Wert, z.Â B. Anzahl der gelÃ¶schten DatensÃ¤tze</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Ende</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Datum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datum des Ende des Batchlaufs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Ende</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Uhrzeit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uhrzeit des Ende des Batchlaufs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Return-Code</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return-Code der Batch-Verarbeitung</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batch-Ergebnis / Return-Code</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Den Return-Code zugeordneter Text</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Beispiel fÃ¼r ein Batchprotokoll:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Batch-Ergebnis&gt;
&lt;Start BatchID="terminfindungLoeschBatch" Datum="2017-01-30" Uhrzeit="09:33:53" Parameter="-start -cfg /resources/batch/batch-loeschen-config.properties -Batchrahmen.Ergebnisdatei loeschen-batch_out.xml"/&gt;
&lt;Meldungen&gt;
&lt;Meldung ID="COMMIT" Typ="I" Text="Checkpunkt geschrieben."/&gt;
&lt;Meldung ID="ENDE" Typ="I" Text="Batch beendet."/&gt;
&lt;/Meldungen&gt;
&lt;Statistik&gt;
&lt;Statistik-Eintrag ID="ANZAHL_GELOESCHT" Text="Anzahl gelÃ¶schter Terminfindungen" Wert="5"/&gt;
&lt;/Statistik&gt;
&lt;Ende Datum="2017-01-30" Uhrzeit="09:33:58"/&gt;
&lt;Return-Code RC="0" Text="Verarbeitung ohne Fehler durchgefÃ¼hrt."/&gt;
&lt;/Batch-Ergebnis&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Zur Auswertung der Ergebnisdatei kÃ¶nnen XSLT-Stylesheets verwendet werden, die die Ergebnisdatei in eine Textdatei bzw.
in HTML umwandeln.
Es handelt sich hierbei um eine fachliche Transformation der Daten mit dem Ziel, diese fÃ¼r den Fachbereich zu filtern,
zu aggregieren oder in einem bestimmten Format zu Weiterverarbeitung bereitzustellen.</p>
</div>
<div class="paragraph">
<p>Wenn die Verarbeitung erfolgreich beendet wurde, endet der Batchrahmen mit dem Return-Code 0. Er endet mit einem anderen
Return-Code, falls der Batch mit einem Fehler beendet wurde oder gar nicht gestartet werden konnte.
Bei Fehlern in den â€žAusfÃ¼hrungsbeansâ€œ kann der zurÃ¼ckzugebende Return-Code Ã¼ber die aufgetretenen Exceptions bestimmt
werden (siehe Kapitel <a href="#informationen-zum-batch-benutzer-bereitstellen">Informationen zum Batch-Benutzer bereitstellen</a>).</p>
</div>
<div class="paragraph">
<p>Pro Batch mÃ¼ssen die mÃ¶glichen RÃ¼ckgabewerte definiert werden.
Die folgenden Werte sind reserviert und mÃ¼ssen von jedem Batch zurÃ¼ckgegeben werden, wenn das entsprechende
Ereignis eingetreten ist:</p>
</div>
<table id="table-GenRetCodeBatCanv" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 11. Allgemeine Return-Codes des Batchrahmens</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Return-Code</th>
<th class="tableblock halign-left valign-top">Bedeutung</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verarbeitung ohne Fehler durchgefÃ¼hrt</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verarbeitung mit Fehlern durchgefÃ¼hrt</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verarbeitung mit Fehlern abgebrochen</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batch konnte wegen Fehlern in den Aufrufparametern nicht gestartet werden</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batch konnte wegen Fehlern in der Batch-Konfiguration nicht gestartet werden</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">143</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batch wurde vom Benutzer abgebrochen.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Batch wurde durch die Ãœberschreitung der konfigurierten maximalen Laufzeit abgebrochen.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="testmodus"><a class="anchor" href="#testmodus"></a>6.8. Testmodus</h3>
<div class="paragraph">
<p>Der Batch im Testmodus arbeitet analog zum normalen Wirkbetrieb, jedoch werden keine Ã„nderungen an DatenbestÃ¤nden vom Anwendungssystem oder Nachbarsystemen durchgefÃ¼hrt.
Der Testmodus ist fÃ¼r den Betrieb wichtig, um AbschÃ¤tzungen der Laufzeit durchfÃ¼hren zu kÃ¶nnen und somit den Batchbetrieb planen kÃ¶nnen.
Weiter ist der Testlauf fÃ¼r BereinigungslÃ¤ufe wichtig, da so der Fachbereich sehen kann, welche Ã„nderungen durch den Bereinigungslauf ausgefÃ¼hrt werden wÃ¼rden.</p>
</div>
<div class="paragraph">
<p>In diesem Kapitel werden Architekturmuster zur Umsetzung des Testmodus beschrieben:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Der Batch arbeitet wie im Wirkbetrieb und statt der Commits findet immer ein Datenbank-Rollback statt (siehe
Kapitel <a href="#testmodus-mit-rollback">Testmodus mit Rollback</a>).</p>
</li>
<li>
<p>Die Batch-Logik wird ausgefÃ¼hrt, jedoch finden keine Schreiboperationen in der Datenbank oder Aufrufe von
Nachbarsystemen statt, welche Ã„nderungen in deren Datenbestand zur Folge hÃ¤tten (siehe
Kapitel <a href="#testmodus-ohne-schreiboperationen">Testmodus ohne Schreiboperationen</a>).</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="testmodus-mit-rollback"><a class="anchor" href="#testmodus-mit-rollback"></a>6.8.1. Testmodus mit Rollback</h4>
<div class="paragraph">
<p>Dieses Muster sieht vor, dass bei der Batchverarbeitung statt eines Commits ein Rollback ausgefÃ¼hrt wird, so dass die Ã„nderungen, die durch den Batch erzeugt werden, nicht in die Datenbank geschrieben werden.
Das Muster ist fÃ¼r datenbankorientierte Batches gut geeignet, die keine Ã„nderungen an Nachbarsystemen erfordern.</p>
</div>
<div class="paragraph">
<p>Einige Batches vermerken ihren Arbeitsfortschritt in der Datenbank.
Damit der Batch trotz Rollback nicht in eine Endlosschleife gerÃ¤t, darf diese Ã„nderung nicht zurÃ¼ckgerollt werden.
Dies kann wie folgt umgesetzt werden:</p>
</div>
<div class="paragraph">
<p>Der Batch schreibt zu Beginn die IDs aller zu verarbeitenden SÃ¤tze in eine gesonderte â€žTaskâ€œ-Tabelle.
In jedem Schritt ermittelt der Batch einen Satz aus der Task-Tabelle, lÃ¶scht diesen und verarbeitet den zugehÃ¶rigen Datensatz.
Im Testmodus wird das LÃ¶schen des Tasks in einer separaten Transaktion durchgefÃ¼hrt und so nicht zurÃ¼ckgerollt.</p>
</div>
<div class="paragraph">
<p>Folgendes Code-Beispiel demonstriert dieses Muster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public VerarbeitungsErgebnis verarbeiteSatz() throws BatchAusfuehrungsException {
  MeinBatchTask task = meinBatchTaskDao.leseEintrag();
  meinBatchTaskDao.loesche(task);

  // Wenn Testmodus, neue Transaktion starten
  TransactionStatus txStatus = null;
  if (testmodus) {
      txStatus = transactionManager.getTransaction(new DefaultTransactionDefinition(TransactionDefinition.PROPAGATION_REQUIRES_NEW));
      txStatus.setRollbackOnly();
  }

  fristenkontrolle.pruefeFrist(task.getSatznummer());

  // Wenn Testmodus, Transaktion zurÃ¼cksetzen
  if (testmodus) {
      transactionManager.rollback(txStatus);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Die Umsetzung des Testmodus mit einem Datenbank-Rollback eignet sich vor allem zur ÃœberprÃ¼fung der fehlerfreien DurchfÃ¼hrung
und bei der Bestimmung der Laufzeit eines Batches.
ZusÃ¤tzlich ist bei einer entsprechenden Protokollierung nachvollziehbar, welche DatensÃ¤tze der Batch verarbeitet hat.</p>
</div>
</div>
<div class="sect3">
<h4 id="testmodus-ohne-schreiboperationen"><a class="anchor" href="#testmodus-ohne-schreiboperationen"></a>6.8.2. Testmodus ohne Schreiboperationen</h4>
<div class="paragraph">
<p>Ein weiteres Konzept fÃ¼r die Umsetzung des Testmodus sieht vor, dass Ã¤ndernde Operationen in der Datenbank unterbunden werden. Ã„nderungen in der Datenbank oder in Nachbarsystemen werden durch entsprechende If-Abfragen abgefangen.</p>
</div>
<div class="paragraph">
<p>Dieses Muster ist dann einzusetzen, wenn die Realisierung durch einen Rollback nicht mÃ¶glich oder angemessen ist.
Durch Tests muss sichergestellt werden, dass nicht trotz Testmodus versehentlich Ã„nderungen durchgefÃ¼hrt werden.</p>
</div>
<div class="paragraph">
<p>Das Muster ist geeignet, um im Testmodus durch die Auswertung der Batch-Protokolle und Logs die Auswirkungen bzw.
durchgefÃ¼hrten Ã„nderungen eines Batches vorab zu Ã¼berprÃ¼fen.
Es ist nicht geeignet zur Bestimmung der Laufzeit oder fÃ¼r die vollstÃ¤ndige Sicherstellung der fehlerfreien BatchausfÃ¼hrung, da Fehler bei Schreiboperationen in die Datenbank oder dem Aufruf von Nachbarsystemen nicht auftreten kÃ¶nnen.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="die-ausfuehrungsbeans"><a class="anchor" href="#die-ausfuehrungsbeans"></a>7. Die AusfÃ¼hrungsbeans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Im vorangegangenen Kapitel wurden die Eigenschaften des Batchrahmens erlÃ¤utert.
Dieser existiert bereits und muss verwendet werden, indem AusfÃ¼hrungsbeans dafÃ¼r entwickelt werden.
In diesem Kapitel werden Vorgaben fÃ¼r die AusfÃ¼hrungsbeans definiert.</p>
</div>
<div class="sect2">
<h3 id="_namenskonvention_3"><a class="anchor" href="#_namenskonvention_3"></a>7.1. Namenskonvention</h3>
<div class="paragraph">
<p>AusfÃ¼hrungsbeans folgend folegender Namenskonvention:</p>
</div>
<div class="paragraph">
<p>Analog zu den AnwendungsfÃ¤llen werden Batchklassen mit dem PrÃ¤fix <code>Bat</code> gekennzeichnet.</p>
</div>
<table id="table-batclass2" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 12. Batches: Klassen</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Batches: Klassen</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Schema</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bat&lt;Batchname&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Beispiele</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BatLoeschfristPruefen<br>
BatSendenAllerInformationen</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="keine-transaktionssteuerung-in-einer-ausfuehrungsbean"><a class="anchor" href="#keine-transaktionssteuerung-in-einer-ausfuehrungsbean"></a>7.2. Keine Transaktionssteuerung in einer AusfÃ¼hrungsbean</h3>
<div class="paragraph">
<p>Eine AusfÃ¼hrungsbean darf keine Transaktionen starten oder beenden.
SÃ¤mtliche vom Batchrahmen aufgerufenen Operationen (Operationen von Interface <code>BatchAusfuehrungsBean</code>) werden innerhalb einer Transaktion aufgerufen.
Die AusfÃ¼hrungsbean muss sich hiermit nicht befassen.</p>
</div>
</div>
<div class="sect2">
<h3 id="logging-protokollierung-und-statistik-aufrufe-implementieren"><a class="anchor" href="#logging-protokollierung-und-statistik-aufrufe-implementieren"></a>7.3. Logging, Protokollierung und Statistik-Aufrufe implementieren</h3>
<div class="paragraph">
<p>Der Batchrahmen fÃ¼hrt Logging nur im Fehlerfall durch.
Die restlichen Informationen mÃ¼ssen durch die AusfÃ¼hrungsbean geloggt, protokolliert oder einer Statistik-Komponente Ã¼bergeben.</p>
</div>
<div class="paragraph">
<p>Dazu wird die AusfÃ¼hrungsbean bei allen wichtigen Ereignissen aufgerufen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Beim Start des Batches</p>
</li>
<li>
<p>Beim Schreiben eines Checkpoints</p>
</li>
<li>
<p>Beim Beenden des Batches</p>
</li>
<li>
<p>Bei der Verarbeitung eines Satzes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jeder Batch erhÃ¤lt eine eigene Korrelations-ID.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warnung"></i>
</td>
<td class="content">
In Ã¤lteren Versionen des Batchrahmens handelte es sich bei der Korrelations-ID fÃ¼r Batches um die ID des Batches.
Mittlerweile wurde dies durch eine UUID ersetzt.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ZusÃ¤tzlich erhÃ¤lt jeder zu verarbeitende Satz auch eine eigene Korrelations-ID, welche an die Korrelations-ID des Batches angehÃ¤ngt wird. Die entstehende Korrelations-ID Kette wird dann dem Aufruf-Kontext hinzugefÃ¼gt.</p>
</div>
</div>
<div class="sect2">
<h3 id="fachliche-logik-in-den-komponenten-der-geschaeftsanwendung-implementieren"><a class="anchor" href="#fachliche-logik-in-den-komponenten-der-geschaeftsanwendung-implementieren"></a>7.4. Fachliche Logik in den Komponenten der GeschÃ¤ftsanwendung implementieren</h3>
<div class="paragraph">
<p>Falls fÃ¼r die Verarbeitung im Batch Fachlogik benÃ¶tigt wird, welche fÃ¼r die Webanwendung nicht benÃ¶tigt wird, ist diese trotzdem den GeschÃ¤ftsnwendungskomponenten hinzuzufÃ¼gen.
Die AusfÃ¼hrungsbean erhÃ¤lt die Referenzen auf die Komponenten Ã¼ber Dependency Injection und ruft die Fachlogik dort auf.</p>
</div>
<div class="paragraph">
<p>Auch wenn in SonderfÃ¤llen Datenbank-Aufrufe direkt durch die AusfÃ¼hrungsbean ausgefÃ¼hrt werden mÃ¼ssen, ist die sonstige fachliche Logik an die Fachkomponenten der GeschÃ¤ftsanwendung zu delegieren.</p>
</div>
</div>
<div class="sect2">
<h3 id="plausibilitaetspruefung-in-der-initialisierung"><a class="anchor" href="#plausibilitaetspruefung-in-der-initialisierung"></a>7.5. PlausibilitÃ¤tsprÃ¼fung in der Initialisierung</h3>
<div class="paragraph">
<p>Im Rahmen der Initialisierung hat die AusfÃ¼hrungsbean unter anderem die Aufgabe, die Konsistenz und Korrektheit der Eingabedaten zu prÃ¼fen.
Dies kann beispielsweise ein erstes Durchlaufen der zu verarbeitenden Datei beinhalten.
Werden hierbei Fehler erkannt, muss ein entsprechender Fehler geworfen werden.</p>
</div>
</div>
<div class="sect2">
<h3 id="in-initialisierung-schluessel-lesen-satz-verarbeitung-ueber-lookups"><a class="anchor" href="#in-initialisierung-schluessel-lesen-satz-verarbeitung-ueber-lookups"></a>7.6. In Initialisierung SchlÃ¼ssel lesen, Satz-Verarbeitung Ã¼ber Lookups</h3>
<div class="paragraph">
<p>Falls die zu verarbeitenden SÃ¤tze eines Batches das Ergebnis einer Datenbank-Query sind, ist folgendermaÃŸen vorzugehen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In Rahmen der Initialisierung ist die Query Ã¼ber eine Fachkomponente abzusetzen.
Diese Query soll die (fachlichen) SchlÃ¼ssel von EntitÃ¤ten, nicht die EntitÃ¤ten selbst auslesen.</p>
</li>
<li>
<p>Die zurÃ¼ckgegebenen SchlÃ¼ssel sind in einer Liste zu speichern und die Query ist zu schlieÃŸen.</p>
</li>
<li>
<p>Beim Aufruf fÃ¼r eine Satzverarbeitung ist die EntitÃ¤t Ã¼ber ihren SchlÃ¼ssel aus der Datenbank auszulesen und die Verarbeitung durchzufÃ¼hren.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dies bietet gegenÃ¼ber dem Auslesen von EntitÃ¤ten in der Query folgende Vorteile:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WÃ¼rden EntitÃ¤ten ausgelesen, wÃ¤ren diese nach einem Commit wÃ¤hrend der Verarbeitung nicht mehr mit einer Transaktion
verbunden.<br>
Hibernate liest EntitÃ¤ten bereits bei der <code>hasNext()</code>-Abfrage eines Resultset-Iterators ab.
So kommt es bei Checkpoints zwangslÃ¤ufig zu toten EntitÃ¤ten.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Hinweis"></i>
</td>
<td class="content">
Falls (in einem ungewÃ¶hnlichen Sonderfall) mit <code>ResultSet</code>-Iteratoren gearbeitet werden muss, so sollte mit einem Hibernate
<code>ScrollableResult</code> gearbeitet werden. Siehe Hibernate-Referenzdokumentation.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Durch das Ablegen der SchlÃ¼ssel in einer Liste ist die Gesamtanzahl der DatensÃ¤tze bekannt.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="informationen-zum-batch-benutzer-bereitstellen"><a class="anchor" href="#informationen-zum-batch-benutzer-bereitstellen"></a>7.7. Informationen zum Batch-Benutzer bereitstellen</h3>
<div class="paragraph">
<p>Batches mÃ¼ssen beim Start einen Benutzer authentifizieren und autorisieren, bevor der fachliche Teil der Batchverarbeitung starten kann.
Der Batchrahmen fordert von der AusfÃ¼hrungsbean die Bereitstellung der Informationen zum Benutzer, um diesen Ã¼ber die T-Komponente Sicherheit zu authentifizieren.
Dazu ist fÃ¼r das AusfÃ¼hrungsbean die Methode <code>getAuthenticationCredentials()</code> umzusetzen.</p>
</div>
</div>
<div class="sect2">
<h3 id="fehlerbehandlung-in-ausfuehrungsbeans-durchfuehren"><a class="anchor" href="#fehlerbehandlung-in-ausfuehrungsbeans-durchfuehren"></a>7.8. Fehlerbehandlung in AusfÃ¼hrungsbeans durchfÃ¼hren</h3>
<div class="paragraph">
<p>Die Batches sind mÃ¶glichst robust zu konstruieren: Falls auf ein fachliches Problem in der AusfÃ¼hrungsbean reagiert werden kann, sollte dies getan werden.</p>
</div>
<div class="paragraph">
<p>Der Batchrahmen unterstÃ¼tzt beispielsweise <em>nicht</em> das Auslassen von DatensÃ¤tzen im Fehlerfall (etwa fÃ¼r eine Verarbeitung im nÃ¤chsten Batch). Falls dies umgesetzt werden soll, ist eine entsprechende Verarbeitung in der AusfÃ¼hrungsbean zu implementieren.</p>
</div>
<div class="paragraph">
<p>Wenn eine AusfÃ¼hrungsbean einen Fehler wirft, so muss dies eine â€žBeanAusfuehrungsExceptionâ€œ oder ein davon erbender Fehler sein.
In diesen Exceptions ist es mÃ¶glich, den Return-Code des Batches zu definieren.
Die Return-Codes sind fÃ¼r den konkreten Batch zu konfigurieren und mÃ¼ssen den Vorgaben in
Abschnitt <a href="#rueckgabewerte-des-batchrahmens">RÃ¼ckgabewerte des Batchrahmens</a> entsprechen.</p>
</div>
<div class="paragraph">
<p>Wichtig ist, dass ein Batch bei einem Fehler, den der Batch nicht behandeln kann, abbricht und nicht endlos weiter lÃ¤uft.
Dieses Vorgehen ermÃ¶glicht es dem Betrieb, die Ursache des Fehlers zu korrigieren und den Batch neu zu starten.</p>
</div>
</div>
<div class="sect2">
<h3 id="beispiele-satzverarbeitung"><a class="anchor" href="#beispiele-satzverarbeitung"></a>7.9. Beispiele Satzverarbeitung</h3>
<div class="paragraph">
<p>AbschlieÃŸend ist in die beispielhafte Satzverarbeitung in einer Batch-AusfÃ¼hrungsbean zu sehen Die gezeigte Satzverarbeitung setzt den Testmodus um, die Anwendungslogik ist weiterhin im Anwendungskern umgesetzt und sie Ã¼bernimmt Logging, Protokollierung und Statistik-ZÃ¤hlung.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public VerarbeitungsErgebnis verarbeiteSatz() throws BatchAusfuehrungsException {
  // Hole nÃ¤chsten Task, wenn vorhanden.
  if (CollectionUtils._isEmpty_(vorgangsIds)) {
  return new VerarbeitungsErgebnis(null, true);
  }
  int vorgangsId = vorgangsIds.remove(vorgangsIds.size() - 1);

  // Wenn Testmodus, neue Transaktion starten
  TransactionStatus txStatus = pruefeStartSimulation();

  // Laden des Vorgangs und Aufruf der AWK Komponente
  // zum Versenden der Mitteilung
  VorgangRo vorgang =
  vorgangsverwaltung.leseVorgang(vorgangsId);
  Antragsnummer antragsnummer = vorgang.getAntragsnummer();
  log.debug("Versende Erinnerung zur Anfrage fÃ¼r Antragsnummer: " + antragsnummer + ".");

  // Versende Erinnerung
  try {
    xxxBeteiligung.versendeErinnerungsnachricht(antragsnummer, vorgangsId);
    getBatchProtokoll().ergaenzeMeldung(
    new VerarbeitungsMeldung(String._valueOf_(vorgangsId), antragsnummer.toString(), MeldungTyp._INFO_, "Antragsnummer: " + antragsnummer));
    statistikErinnerungVersendet.erhoeheWert();
  } catch (AkteGesperrtException e) {
  getBatchProtokoll().ergaenzeMeldung(
  new VerarbeitungsMeldung(String._valueOf_(vorgangsId), antragsnummer.toString(),
  MeldungTyp._WARNUNG_, e.getFehlertext()));
  }

  // Wenn Testmodus, Transaktion zurÃ¼cksetzen
  pruefeEndeSimulation(txStatus);
  return new VerarbeitungsErgebnis(String._valueOf_(vorgangsId), false);
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="sonderfall-blockloeschung"><a class="anchor" href="#sonderfall-blockloeschung"></a>7.9.1. Sonderfall BlocklÃ¶schung</h4>
<div class="paragraph">
<p>Es ist nicht zwingend erforderlich, dass in einem Satz nur eine einzelne Aktion (bspw.
LÃ¶schung) durchgefÃ¼hrt wird. Bei groÃŸen Datenmengen kann es durchaus Sinn sinnvoll sein, pro Satz eine bestimmte Anzahl DatensÃ¤tze auf einmal zu verarbeiten, wie im folgenden Codebeispiel zu sehen ist.
Die Variable <code>blockgroesse</code> ist dabei konfigurativ zu setzen.</p>
</div>
<div class="paragraph">
<p>Wichtig ist in so einem Sonderfall, dass das Commit-Intervall des Batches entsprechend niedrig eingestellt ist
(siehe Kapitel <a href="#konfigurationsdatei-und-kommandozeilen-parameter">Konfigurationsdatei und Kommandozeilen-Parameter</a>), da ansonsten
(<em>BlockgrÃ¶ÃŸe</em> * <em>Commit-Intervall</em>) viele DatensÃ¤tze mit einer Transaktion verarbeitet werden.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public VerarbeitungsErgebnis verarbeiteSatz() throws BatchAusfuehrungsException {
  log.debug("LÃ¶sche Nachrichten Ã¤lter als " + fristdatum + " (BlockgrÃ¶ÃŸe " + blockgroesse + ").");

  // Wenn Testmodus, neue Transaktion starten
  TransactionStatus txStatus = pruefeStartSimulation();
  int anzahlGeloeschterEintraege = nachrichtenverwaltung.loescheNachrichtenOhneAkte(fristdatum, blockgroesse);
  log.debug(anzahlGeloeschterEintraege + " Nachrichten gelÃ¶scht.");
  geloeschteNachrichtenStatistik.setWert(geloeschteNachrichtenStatistik.getWert() + anzahlGeloeschterEintraege);

  // Wenn Testmodus, Transaktion zurÃ¼cksetzen
  pruefeEndeSimulation(txStatus);
  return new VerarbeitungsErgebnis(null, anzahlGeloeschterEintraege &lt; blockgroesse);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sonderfall-eigenstaendige-transaktionssteuerung"><a class="anchor" href="#sonderfall-eigenstaendige-transaktionssteuerung"></a>7.9.2. Sonderfall eigenstÃ¤ndige Transaktionssteuerung</h4>
<div class="paragraph">
<p>Unter bestimmten UmstÃ¤nden kann es notwendig sein, die Transaktionssteuerung des Batchrahmens zu umgehen.
Dies ist beispielsweise der Fall, wenn ein im Datenzugriff auftretender Fehler aus der Datenbank ignoriert werden soll.
Das Auftreten einer solchen Exception fÃ¼hrt dazu, dass die Transaktion nur noch zurÃ¼ckgerollt werden kann, selbst wenn die Exception gefangen und ignoriert wird.</p>
</div>
<div class="paragraph">
<p>Um dieser Problematik zu begegnen, kann in der Satzverarbeitung selbst die Transaktionsklammer nur fÃ¼r einen Satz geÃ¶ffnet und nach der Verarbeitung entweder commited oder zurÃ¼ckgerollt werden.</p>
</div>
<div class="paragraph">
<p>In diesem Fall sollte der Commit-Intervall des Batchrahmens entsprechend hoch konfiguriert werden, um unnÃ¶tige Commits zu vermeiden, auch wenn in dieser Transaktion nichts passiert.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ausnahmeregelungen"><a class="anchor" href="#ausnahmeregelungen"></a>8. Ausnahmeregelungen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In bestimmten Situationen, z.Â B. bei der Verarbeitung extrem groÃŸer Datenmengen, kann der Fall auftreten, dass die Implementierung eines Batchschritts in Java nicht sinnvoll ist.
In solchen FÃ¤llen muss dann eine SonderlÃ¶sung, wie z.Â B. ein SQL-Skript oder ein Shell-Skript, gefunden werden. Shell-Skripte sind in dem folgenden Kapitel <a href="#shell-batches">Shell-Batches</a> beschrieben.</p>
</div>
<div class="paragraph">
<p>Die Entscheidung, ob in einem solchen Einzelfall eine SonderlÃ¶sung gewÃ¤hlt werden kann, muss zwingend in einer Architekturentscheidung erfolgen.
Eine solche Abweichung von der Referenzarchitektur muss im Systementwurf in der Liste der Abweichungen aufgefÃ¼hrt und begrÃ¼ndet werden.
Dabei muss die AbwÃ¤gung getroffen werden zwischen der Einhaltung der nicht-funktionalen Anforderungen und der Verringerung der Wartbarkeit durch mehrfach implementierte FunktionalitÃ¤t.</p>
</div>
<div class="paragraph">
<p>Wichtig ist, dass die einheitliche AuÃŸenschnittstelle der Batchschritte erhalten bleibt, d.Â h. anhand der Ã¼bergebenen Parameter, RÃ¼ckgabewerte, geloggten Daten darf fÃ¼r den Nutzer des Batchschritts nicht erkennbar sein, dass dieser in einer anderen Technologie umgesetzt ist.</p>
</div>
<div class="paragraph">
<p>Die Dokumentation der abweichenden Batchimplementierung erfolgt im Systementwurf und wird daraus in die Systemdokumentation Ã¼bernommen.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shell-batches"><a class="anchor" href="#shell-batches"></a>9. Shell-Batches</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="was-ist-ein-shell-batch"><a class="anchor" href="#was-ist-ein-shell-batch"></a>9.1. Was ist ein Shell-Batch?</h3>
<div class="paragraph">
<p>Als Shell-Batch wird ein Shell-Skript bezeichnet, das Stapelverarbeitungsbefehle ausfÃ¼hrt, die direkt in diesem Skript definiert sind.
Damit fallen sie unter die Ausnahmeregelungen des vorherigen Kapitels <a href="#ausnahmeregelungen">Ausnahmeregelungen</a>.
RegulÃ¤re Batches werden meist ebenfalls Ã¼ber ein Shell-Skript gestartet, ihre Logik ist aber in Java programmiert.
Das Skript startet also nur das zugehÃ¶rige Programm.</p>
</div>
<div class="paragraph">
<p>Der Vorteil von Shell-Batches ist, dass sie etwas schlanker sind und daher auch schneller entwickelt werden kÃ¶nnen.
Komplexe fachliche Logik sollte aber immer als dediziertes Batchprogramm umgesetzt werden, da diese auf lange Sicht besser wartbar sind.</p>
</div>
<div class="paragraph">
<p>Ein Beispiel fÃ¼r Shell-Batches sind einmalige SQL-Migrationen.
Das Shell-Skript baut dabei eine Verbindung mit dem Datenbank-Server auf und fÃ¼hrt eine SQL-Datei aus.</p>
</div>
<div class="paragraph">
<p>Es gibt aber auch Systeme die im regulÃ¤ren Wirkbetrieb regelmÃ¤ÃŸig Shell-Batches ausfÃ¼hren; bspw. um DatenbankabzÃ¼ge fÃ¼r statistische Auswertungen zu erstellen.</p>
</div>
</div>
<div class="sect2">
<h3 id="aufbau-von-shell-batches"><a class="anchor" href="#aufbau-von-shell-batches"></a>9.2. Aufbau von Shell-Batches</h3>
<div class="paragraph">
<p>Ein Shell-Batch besteht aus einem SH-Skript und ggf.
weiteren Dateien:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Property-Datei fÃ¼r Konfigurationen, wie bspw. die zu verwendende Datenbankverbindung</p>
</li>
<li>
<p>SQL-Skripte, die vom SH-Skript ausgefÃ¼hrt werden</p>
</li>
<li>
<p>weitere SH-Skripte die, die vom SH-Skript ausgefÃ¼hrt werden</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_namenskonvemtion"><a class="anchor" href="#_namenskonvemtion"></a>9.2.1. Namenskonvemtion</h4>
<div class="paragraph">
<p>Ein Shell-Skript muss folgender Namenskonvention folgen:</p>
</div>
<table id="table-shellskript" class="tableblock frame-all grid-all stretch">
<caption class="title">Tabelle 13. Batches: Shellskript</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Batches: Shellskript</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Schemata</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;batchname-des-batches&gt;.sh</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Beispiele</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>loeschfrist-pruefen.sh<br>
import-bhknz-liste.sh</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Die Dateien sollten entweder in einen eigenen Ordner unter <code>/opt</code> abgelegt werden oder â€“ falls der Batch Teil eines bestehenden Batch-Projekts ist â€“ in den vorhandenen Batch-Ordner des Systems deployed werden.</p>
</div>
<div class="paragraph">
<p>In letzterem Fall sollte das Deployment Ã¼ber das RPM des Batch-Projekts erfolgen.
Andernfalls ist â€“ insbesondere bei nur einmaligen Migrationsbatches â€“ ein manuelles Deployment mÃ¶glich.</p>
</div>
<div class="paragraph">
<p>Die SH-Skripte mÃ¼ssen immer nach dem folgenden Schema aufgebaut werden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Beschreibungskommentar mit Parametern und RÃ¼ckgabewerten</p>
</li>
<li>
<p>Automatisches Ermitteln des Homeverzeichnisses des Batches</p>
</li>
<li>
<p>Einlesen der Ãœbergabe-Parameter</p>
</li>
<li>
<p>Einlesen notwendiger Properties aus den Konfigurationsdateien</p>
</li>
<li>
<p>AusfÃ¼hren der eigentlichen Batchlogik</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Der Batch gibt zudem die Startzeit, Endezeit und Laufzeit aus.</p>
</div>
<div class="paragraph">
<p>Es mÃ¼ssen dokumentierte Returncodes fÃ¼r erwartete FehlerfÃ¤lle verwendet werden, um die Fehleranalyse zu vereinfachen.</p>
</div>
<div class="paragraph">
<p>Folgende Rahmenbedingungen sind bei der Umsetzung einzuhalten:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Das Homeverzeichnis (in dem das SH-Skript liegt) wird automatisiert ermittelt und wird nicht als Parameter Ã¼bergeben.</p>
</li>
<li>
<p>Das Logverzeichnis muss ein optionaler Parameter sein (und damit als letzter Eingabeparameter definiert sein).
Bei Nichtangabe wird der Standard-Logpfad unter <code>&lt;HOMEVEREICHNIS&gt;/log/</code> verwendet.</p>
</li>
<li>
<p>Datenbankverbindungsangaben mÃ¼ssen in einer Konfigurationsdatei (<code>&lt;HOMEVERZEICHNIS&gt;/etc/jpa.properties</code>) stehen und dÃ¼rfen nicht als Parameter Ã¼bergeben werden.</p>
</li>
<li>
<p>SQL-Skripte, die vom SH-Skript verwendet werden mÃ¼ssen im Verzeichnis <code>&lt;HOMEVERZEICHNIS&gt;/sql/</code> abgelegt werden.</p>
</li>
<li>
<p>Weitere SH-Skripte, die vom Hauptskript aufgerufen werden, mÃ¼ssen unter <code>&lt;HOMEVERZEICHNIS&gt;/sh/</code> abgelegt werden.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Im Folgenden ist ein Beispiel-Template eines Shell-Batches angegeben:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash
#===========================================================
# Beispiel Shellbatch
#
# Vorbedingungen
# - Leeres Datenbank Schema angelegt
#
# Parameter
# - Optional: Verzeichnis, in dem die Log-Dateien abgelegt werden
#
# RÃ¼ckgabewerte:
# - 0 = Erfolg
# - 10 = Keine OracleConnection angegeben (jpa.properties existiert nicht oder enthÃ¤lt den SchlÃ¼ssel database.connection nicht)
# - 20 = Fehler beim AusfÃ¼hren von Schritt 1 (01_tabelle-erstellen.sql)
# - 30 = Fehler beim AusfÃ¼hren von Schritt 2 (02_tabelle-loeschen.sql)
#
# Version: $Id: shellbatch.sh &lt;revision&gt; &lt;datum&gt; &lt;user&gt; $
#
#===========================================================

#Zeit zu Beginn ermitteln +
start=`date +%s`

# Homeverzeichnis ermitteln
HomeVerzeichnis=$(cd -P -- "$(dirname -- "$0")" &amp;&amp; pwd -P)

# Parameter prÃ¼fen
if [ -z "$1" ] ; then
  LogVerzeichnis=$\{HomeVerzeichnis}/log/
else
  LogVerzeichnis=$1
Fi

# Auslesen der Oracle-Datenbankverbindung aus einer Konfigurationsdatei (jpa.properties).
PROPERTY_FILE="$\{HomeVerzeichnis}/etc/jpa.properties"
PROP_KEY="database.connection"

# Alles nach dem ersten "=" wird gematched (inklusive Leerzeichen)
OracleConnection=`cat $PROPERTY_FILE | grep "$PROP_KEY" | sed 's/[^=]*=\(.*\)/\1/'`
if [ -z "$OracleConnection" ] ; then
  echo "+++ OracleConnection konnte nicht ermittelt werden. Existiert die jpa.properties Datei und ist der richtige SchlÃ¼ssel enthalten? Abbruch!"
  exit 10
fi

# Startmeldung
echo "# "$(basename $0)" um "$(date +%Y-%m-%d-%T)" gestartet"
RC=0

# Batchschritte
# 1. AusfÃ¼hren eines SQL-Skripts mit SQL-Plus
if [ $\{RC} = "0" ]; then
  echo "# Fuehre 01_tabelle-erstellen.sql aus ..."
  LogDatei=$\{LogVerzeichnis}/shellbatch_$(date +%Y-%m-%d_%H-%M-%S).log
  cd $\{HomeVerzeichnis}/sql
  sqlplus "$\{OracleConnection}" @01_tabelle-erstellen.sql | tee $\{LogDatei}
  res=$?
  AnzahlFehler=$(egrep -c "SP2\-[0-9]\{4}\:|ORA\-[0-9]\{5}\:" $\{LogDatei})
  if [ $\{AnzahlFehler} -ne 0 ]; then
    echo "+++ "$\{AnzahlFehler}" Fehler in Schritt 01, RC="$\{res}"!"
    RC=20
  fi
fi

# 2. AusfÃ¼hren eines weiteren SQL-Skripts mit SQL-Plus
if [ $\{RC} = "0" ]; then
  echo "# Fuehre 02_tabelle-loeschen.sql aus ..."
  LogDatei=$\{LogVerzeichnis}/shellbatch_$(date +%Y-%m-%d_%H-%M-%S).log
  cd $\{HomeVerzeichnis}/sql
  sqlplus "$\{OracleConnection}" @02_tabelle-loeschen.sql | tee $\{LogDatei}
  res=$?
  AnzahlFehler=$(egrep -c "SP2\-[0-9]\{4}\:|ORA\-[0-9]\{5}\:" $\{LogDatei})
  if [ $\{AnzahlFehler} -ne 0 ]; then
    echo "+++ "$\{AnzahlFehler}" Fehler in Schritt 02, RC="$\{res}"!"
    RC=30
  fi
fi

end=`date +%s`
# Ende-Meldung
echo "Shell-Batch wurde erfolgreich beendet. - Laufzeit" $(($end - $start)) "Sekunden"
echo "# "$(basename $0)" um "$(date +%Y-%m-%d-%T)" mit RC="$\{RC}" beendet"
exit $\{RC}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Eine funktionsfÃ¤hige Version dieses Beispiels ist im isy-batchrahmen
unter <code>src/main/skripte/shellbatch_template/</code> eingecheckt.
Um dieses ausfÃ¼hren zu kÃ¶nnen, muss eine funktionierende Datenbankverbindung auf ein leeres Schema in der jpa.properties Datei angegeben werden.</p>
</div>
<div class="paragraph">
<p>Details zu dem Datenzugriff, welcher in diesem Beispiel aufgefÃ¼hrt ist, oder alternative Datenzugriffe, befinden sich in dem Dokument <a href="#DetailkonzeptKomponenteDatenzugriff">[DetailkonzeptKomponenteDatenzugriff]</a>.</p>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<div class="divFooter"></div>

<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/isyfact.js"></script>
  </body>
</html>
